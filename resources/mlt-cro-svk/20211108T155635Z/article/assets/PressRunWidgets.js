/**
 *   PressRunWidgets v1.12.6
 * Â© Quark AppStudio ~ 2020-11-27
 */
function PathAnimator(a,b){a&&(this.len=this.updatePath(a),this.timer=null,this.settings={duration:b.duration,step:b.step,reverse:!!b.reverse,startPercent:b.startPercent||0,onDone:b.onDone||function(){},easing:b.easing,fps:b.fps})}function highlightAll(a){radio(PR.Event.HIGHLIGHT_ALL).broadcast(a)}function unhighlightAll(){radio(PR.Event.UNHIGHLIGHT_ALL).broadcast()}function onPlayerStateChange(a){a.data===window.YT.PlayerState.ENDED||a.data===window.YT.PlayerState.PAUSED?PR.Core.onAppNotifyDesktop("videoState://stopped"):a.data===window.YT.PlayerState.PLAYING&&PR.Core.onAppNotifyDesktop("videoState://started")}function registerYoutubeEvents(a){if(a){var b=new window.YT.Player(a,{events:{onStateChange:onPlayerStateChange}});PR.Core.activeWidgets.forEach(function(c){"IFRAME"===c.widget&&a===c.ytPlayerId&&(c.videoPlayer=b)})}}function onYouTubeIframeAPIReady(){for(var a=document.querySelectorAll(".html5widget"),b=0;b<a.length;b+=1){var c=a[b].id;void 0!==c&&-1!==c.indexOf("html5YoutubeWidget")&&registerYoutubeEvents(c)}}var IScroll=function(a,b,c){function d(a,d){this.wrapper="string"==typeof a?b.querySelector(a):a,this.scroller=this.wrapper.children[0],this.scrollerStyle=this.scroller.style,this.options={zoomMin:1,zoomMax:4,startZoom:1,zoomBounce:!0,resizeIndicator:!0,mouseWheelSpeed:20,snapThreshold:.334,startX:0,startY:0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!0,bounceTime:600,bounceEasing:"",preventDefault:!0,HWCompositing:!0,useTransition:!0,useTransform:!0};for(var e in d)this.options[e]=d[e];this.translateZ=this.options.HWCompositing&&h.hasPerspective?" translateZ(0)":"",this.options.useTransition=h.hasTransition&&this.options.useTransition,this.options.useTransform=h.hasTransform&&this.options.useTransform,this.options.eventPassthrough=this.options.eventPassthrough===!0?"vertical":this.options.eventPassthrough,this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault,this.options.scrollY="vertical"==this.options.eventPassthrough?!1:this.options.scrollY,this.options.scrollX="horizontal"==this.options.eventPassthrough?!1:this.options.scrollX,this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough,this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold,this.options.bounceEasing="string"==typeof this.options.bounceEasing?h.ease[this.options.bounceEasing]||h.ease.circular:this.options.bounceEasing,this.options.resizePolling=void 0===this.options.resizePolling?60:this.options.resizePolling,this.options.tap===!0&&(this.options.tap="tap"),this.options.invertWheelDirection=this.options.invertWheelDirection?-1:1,3==this.options.probeType&&(this.options.useTransition=!1),this.x=0,this.y=0,this.directionX=0,this.directionY=0,this._events={},this.scale=c.min(c.max(this.options.startZoom,this.options.zoomMin),this.options.zoomMax),this._init(),this.refresh(),this.scrollTo(this.options.startX,this.options.startY),this.enable(),this._pointers=[]}function e(a,c,d){var e=b.createElement("div"),f=b.createElement("div");return d===!0&&(e.style.cssText="position:absolute;z-index:auto",f.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px"),f.className="iScrollIndicator","h"==a?(d===!0&&(e.style.cssText+=";height:7px;left:2px;right:2px;bottom:0",f.style.height="100%"),e.className="iScrollHorizontalScrollbar"):(d===!0&&(e.style.cssText+=";width:7px;bottom:2px;top:2px;right:1px",f.style.width="100%"),e.className="iScrollVerticalScrollbar"),c||(e.style.pointerEvents="none"),e.appendChild(f),e}function f(c,d){this.wrapper="string"==typeof d.el?b.querySelector(d.el):d.el,this.indicator=this.wrapper.children[0],this.indicatorStyle=this.indicator.style,this.scroller=c,this.options={listenX:!0,listenY:!0,interactive:!1,resize:!0,defaultScrollbars:!1,speedRatioX:0,speedRatioY:0};for(var e in d)this.options[e]=d[e];this.sizeRatioX=1,this.sizeRatioY=1,this.maxPosX=0,this.maxPosY=0,this.options.interactive&&(h.addEvent(this.indicator,"touchstart",this),h.addEvent(this.indicator,"MSPointerDown",this),h.addEvent(this.indicator,"pointerdown",this),h.addEvent(this.indicator,"mousedown",this),h.addEvent(a,"touchend",this),h.addEvent(a,"MSPointerUp",this),h.addEvent(a,"pointerup",this),h.addEvent(a,"mouseup",this))}var g=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b){a.setTimeout(b,1e3/60)},h=function(){function d(a){return g===!1?!1:""===g?a:g+a.charAt(0).toUpperCase()+a.substr(1)}var e={},f=b.createElement("div").style,g=function(){for(var a,b=["t","webkitT","MozT","msT","OT"],c=0,d=b.length;d>c;c++)if(a=b[c]+"ransform",a in f)return b[c].substr(0,b[c].length-1);return!1}(),h=function(){var b=!1;try{var c=Object.defineProperty({},"passive",{get:function(){b=!0}});a.addEventListener("test",c,c),a.removeEventListener("test",c,c)}catch(d){b=!1}return b}();e.getTime=Date.now||function(){return(new Date).getTime()},e.extend=function(a,b){for(var c in b)a[c]=b[c]},e.addEvent=function(a,b,c,d){a.addEventListener(b,c,h?{passive:!1,capture:!!d}:!!d)},e.removeEvent=function(a,b,c,d){a.removeEventListener(b,c,h?{passive:!1,capture:!!d}:!!d)},e.momentum=function(a,b,d,e,f){var g,h,i=a-b,j=c.abs(i)/d,k=6e-4;return g=a+j*j/(2*k)*(0>i?-1:1),h=j/k,e>g?(g=f?e-f/2.5*(j/8):e,i=c.abs(g-a),h=i/j):g>0&&(g=f?f/2.5*(j/8):0,i=c.abs(a)+g,h=i/j),{destination:c.round(g),duration:h}};var i=d("transform");return e.extend(e,{hasTransform:i!==!1,hasPerspective:d("perspective")in f,hasTouch:"ontouchstart"in a,hasPointer:navigator.msPointerEnabled,hasTransition:d("transition")in f}),e.isAndroidBrowser=/Android/.test(a.navigator.appVersion)&&/Version\/\d/.test(a.navigator.appVersion),e.extend(e.style={},{transform:i,transitionTimingFunction:d("transitionTimingFunction"),transitionDuration:d("transitionDuration"),transformOrigin:d("transformOrigin")}),e.hasClass=function(a,b){var c=new RegExp("(^|\\s)"+b+"(\\s|$)");return c.test(a.className)},e.addClass=function(a,b){if(!e.hasClass(a,b)){var c=a.className.split(" ");c.push(b+" "),a.className=c.join(" ")}},e.removeClass=function(a,b){if(e.hasClass(a,b)){var c=new RegExp("(^|\\s)"+b+"(\\s|$)","g");a.className=a.className.replace(c,"")}},e.offset=function(a){for(var b=-a.offsetLeft,c=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,c-=a.offsetTop;return{left:b,top:c}},e.extend(e.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3,pointerdown:3,pointermove:3,pointerup:3}),e.extend(e.ease={},{quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(a){return a*(2-a)}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",fn:function(a){return c.sqrt(1- --a*a)}},back:{style:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fn:function(a){var b=4;return(a-=1)*a*((b+1)*a+b)+1}},bounce:{style:"",fn:function(a){return(a/=1)<1/2.75?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375}},elastic:{style:"",fn:function(a){var b=.22,d=.4;return 0===a?0:1==a?1:d*c.pow(2,-10*a)*c.sin((a-b/4)*(2*c.PI)/b)+1}}}),e.tap=function(a,c){var d=b.createEvent("Event");d.initEvent(c,!0,!0),d.pageX=a.pageX,d.pageY=a.pageY,a.target.dispatchEvent(d)},e.click=function(a){var c,d=a.target;"SELECT"!=d.tagName&&"INPUT"!=d.tagName&&"TEXTAREA"!=d.tagName&&(c=b.createEvent("MouseEvents"),c.initMouseEvent("click",!0,!0,a.view,1,d.screenX,d.screenY,d.clientX,d.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null),c._constructed=!0,d.dispatchEvent(c))},e}();return d.prototype={version:"5.0.4",_init:function(){this._initEvents(),this.options.zoom&&this._initZoom(),(this.options.scrollbars||this.options.indicators)&&this._initIndicators(),this.options.mouseWheel&&this._initWheel(),this.options.snap&&this._initSnap(),this.options.keyBindings&&this._initKeys()},destroy:function(){this._initEvents(!0),this._execEvent("destroy")},_transitionEnd:function(a){a.target==this.scroller&&(this._transitionTime(0),this.resetPosition(this.options.bounceTime)||this._execEvent("scrollEnd"))},_start:function(a){if((1==h.eventType[a.type]||0===a.button)&&this.enabled&&(!this.initiated||h.eventType[a.type]===this.initiated)){this.options.preventDefault&&!h.isAndroidBrowser&&a.preventDefault();var b,d=a.touches?a.touches[0]:a;this.initiated=h.eventType[a.type],this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,this._transitionTime(),this.isAnimating=!1,this.startTime=h.getTime(),this.options.useTransition&&this.isInTransition&&(b=this.getComputedPosition(),this._translate(c.round(b.x),c.round(b.y)),this.isInTransition=!1),this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=d.pageX,this.pointY=d.pageY,this._execEvent("scrollStart")}},_move:function(a){if(this.enabled&&h.eventType[a.type]===this.initiated){this.options.preventDefault&&a.preventDefault();var b,d,e,f,g=a.touches?a.touches[0]:a,i=this.hasHorizontalScroll?g.pageX-this.pointX:0,j=this.hasVerticalScroll?g.pageY-this.pointY:0,k=h.getTime();if(this.pointX=g.pageX,this.pointY=g.pageY,this.distX+=i,this.distY+=j,e=c.abs(this.distX),f=c.abs(this.distY),this._preventPageScroll(this.distX,this.distY)&&a.preventDefault(),!(k-this.endTime>300&&10>e&&10>f)){if(this.directionLocked||this.options.freeScroll||(e>f+this.options.directionLockThreshold?this.directionLocked="h":f>=e+this.options.directionLockThreshold?this.directionLocked="v":this.directionLocked="n"),"h"==this.directionLocked){if("vertical"==this.options.eventPassthrough)a.preventDefault();else if("horizontal"==this.options.eventPassthrough)return void(this.initiated=!1);j=0}else if("v"==this.directionLocked){if("horizontal"==this.options.eventPassthrough)a.preventDefault();else if("vertical"==this.options.eventPassthrough)return void(this.initiated=!1);i=0}b=this.x+i,d=this.y+j,(b>0||b<this.maxScrollX)&&(b=this.options.bounce?this.x+i/3:b>0?0:this.maxScrollX),(d>0||d<this.maxScrollY)&&(d=this.options.bounce?this.y+j/3:d>0?0:this.maxScrollY),this.directionX=i>0?-1:0>i?1:0,this.directionY=j>0?-1:0>j?1:0,this.moved=!0,this._translate(b,d),k-this.startTime>300&&(this.startTime=k,this.startX=this.x,this.startY=this.y,1==this.options.probeType&&this._execEvent("scroll")),this.options.probeType>1&&this._execEvent("scroll")}}},_end:function(a){if(this.enabled&&h.eventType[a.type]===this.initiated){this.options.preventDefault&&a.preventDefault();var b,d,e=(a.changedTouches?a.changedTouches[0]:a,h.getTime()-this.startTime),f=c.round(this.x),g=c.round(this.y),i=c.abs(f-this.startX),j=c.abs(g-this.startY),k=0,l="";if(this._preventPageScroll(f-this.startX,g-this.startY)&&a.preventDefault(),this.scrollTo(f,g),this.isInTransition=0,this.initiated=0,this.endTime=h.getTime(),!this.resetPosition(this.options.bounceTime)){if(!this.moved)return this.options.tap&&h.tap(a,this.options.tap),void(this.options.click&&h.click(a));if(this._events.flick&&200>e&&100>i&&100>j)return void this._execEvent("flick");if(this.options.momentum&&300>e&&(b=this.hasHorizontalScroll?h.momentum(this.x,this.startX,e,this.maxScrollX,this.options.bounce?this.wrapperWidth:0):{destination:f,duration:0},d=this.hasVerticalScroll?h.momentum(this.y,this.startY,e,this.maxScrollY,this.options.bounce?this.wrapperHeight:0):{destination:g,duration:0},f=b.destination,g=d.destination,k=c.max(b.duration,d.duration),this.isInTransition=1),this.options.snap){var m=this._nearestSnap(f,g);this.currentPage=m,f=m.x,g=m.y,k=this.options.snapSpeed||c.max(c.max(c.min(i,1e3),c.min(i,1e3)),300),this.directionX=0,this.directionY=0,l=this.options.bounceEasing}return f!=this.x||g!=this.y?((f>0||f<this.maxScrollX||g>0||g<this.maxScrollY)&&(l=h.ease.quadratic),void this.scrollTo(f,g,k,l)):void this._execEvent("scrollEnd")}}},_preventPageScroll:function(a,b){var d=this.maxScrollX===this.startX&&0>a||a>0&&0===this.startX,e=this.maxScrollY===this.startY&&0>b||b>0&&0===this.startY;return this.hasHorizontalScroll^this.hasVerticalScroll&&(!d&&this.hasHorizontalScroll&&c.abs(a)>5||!e&&this.hasVerticalScroll&&c.abs(b)>5)?!0:!1},_resize:function(){var a=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){a.refresh()},this.options.resizePolling)},resetPosition:function(a){var b=this.x,c=this.y;return a=a||0,!this.hasHorizontalScroll||this.x>0?b=0:this.x<this.maxScrollX&&(b=this.maxScrollX),!this.hasVerticalScroll||this.y>0?c=0:this.y<this.maxScrollY&&(c=this.maxScrollY),b==this.x&&c==this.y?!1:(this.currentPage=this._nearestSnap(b,c),this.scrollTo(b,c,a,this.options.bounceEasing),!0)},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},refresh:function(){this.wrapper.offsetHeight;if(this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.scrollerWidth=c.round(this.scroller.offsetWidth*this.scale),this.scrollerHeight=c.round(this.scroller.offsetHeight*this.scale),this.maxScrollX=this.wrapperWidth-this.scrollerWidth,this.maxScrollY=this.wrapperHeight-this.scrollerHeight,this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0,this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0,this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth),this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight),this.endTime=0,this.directionX=0,this.directionY=0,this.wrapperOffset=h.offset(this.wrapper),this._execEvent("refresh"),this.resetPosition(),this.options.snap){var a=this._nearestSnap(this.x,this.y);if(this.x==a.x&&this.y==a.y)return;this.currentPage=a,this.scrollTo(a.x,a.y)}},on:function(a,b){this._events[a]||(this._events[a]=[]),this._events[a].push(b)},_execEvent:function(a){if(this._events[a]){var b=0,c=this._events[a].length;if(c)for(;c>b;b++)this._events[a][b].call(this)}},scrollBy:function(a,b,c,d){a=this.x+a,b=this.y+b,c=c||0,this.scrollTo(a,b,c,d)},scrollTo:function(a,b,c,d){d=d||h.ease.circular,!c||this.options.useTransition&&d.style?(this._transitionTimingFunction(d.style),this._transitionTime(c),this._translate(a,b)):this._animate(a,b,c,d.fn)},scrollToElement:function(a,b,d,e,f){if(a=a.nodeType?a:this.scroller.querySelector(a)){var g=h.offset(a);g.left-=this.wrapperOffset.left,g.top-=this.wrapperOffset.top,d===!0&&(d=c.round(a.offsetWidth/2-this.wrapper.offsetWidth/2)),e===!0&&(e=c.round(a.offsetHeight/2-this.wrapper.offsetHeight/2)),g.left-=d||0,g.top-=e||0,g.left=g.left>0?0:g.left<this.maxScrollX?this.maxScrollX:g.left,g.top=g.top>0?0:g.top<this.maxScrollY?this.maxScrollY:g.top,b=void 0===b||null===b||"auto"===b?c.max(2*c.abs(g.left),2*c.abs(g.top)):b,this.scrollTo(g.left,g.top,b,f)}},_transitionTime:function(a){a=a||0,this.scrollerStyle[h.style.transitionDuration]=a+"ms",this.indicator1&&this.indicator1.transitionTime(a),this.indicator2&&this.indicator2.transitionTime(a)},_transitionTimingFunction:function(a){this.scrollerStyle[h.style.transitionTimingFunction]=a,this.indicator1&&this.indicator1.transitionTimingFunction(a),this.indicator2&&this.indicator2.transitionTimingFunction(a)},_translate:function(a,b){this.options.useTransform?this.scrollerStyle[h.style.transform]="translate("+a+"px,"+b+"px) scale("+this.scale+") "+this.translateZ:(a=c.round(a),b=c.round(b),this.scrollerStyle.left=a+"px",this.scrollerStyle.top=b+"px"),this.x=a,this.y=b,this.indicator1&&this.indicator1.updatePosition(),this.indicator2&&this.indicator2.updatePosition()},_initEvents:function(b){var c=b?h.removeEvent:h.addEvent,d=this.options.bindToWrapper?this.wrapper:a;c(a,"orientationchange",this),c(a,"resize",this),this.options.disableMouse||(c(this.wrapper,"mousedown",this),c(d,"mousemove",this),c(d,"mousecancel",this),c(d,"mouseup",this)),h.hasPointer&&!this.options.disablePointer&&(c(this.wrapper,"MSPointerDown",this),c(d,"MSPointerMove",this),c(d,"MSPointerCancel",this),c(d,"MSPointerUp",this),c(this.wrapper,"pointerdown",this),c(d,"pointermove",this),c(d,"pointercancel",this),c(d,"pointerup",this)),h.hasTouch&&!this.options.disableTouch&&(c(this.wrapper,"touchstart",this),c(d,"touchmove",this),c(d,"touchcancel",this),c(d,"touchend",this)),c(this.scroller,"transitionend",this),c(this.scroller,"webkitTransitionEnd",this),c(this.scroller,"oTransitionEnd",this),c(this.scroller,"MSTransitionEnd",this)},getComputedPosition:function(){var b,c,d=a.getComputedStyle(this.scroller,null);return this.options.useTransform?(d=d[h.style.transform].split(")")[0].split(", "),b=+(d[12]||d[4]),c=+(d[13]||d[5])):(b=+d.left.replace(/[^-\d]/g,""),c=+d.top.replace(/[^-\d]/g,"")),{x:b,y:c}},_initIndicators:function(){var a,b,c=this.options.interactiveScrollbars,d=("object"!=typeof this.options.scrollbars,"string"!=typeof this.options.scrollbars);this.options.scrollbars?(this.options.scrollY&&(a={el:e("v",c,this.options.scrollbars),interactive:c,defaultScrollbars:!0,customStyle:d,resize:this.options.resizeIndicator,listenX:!1},this.wrapper.appendChild(a.el)),this.options.scrollX&&(b={el:e("h",c,this.options.scrollbars),interactive:c,defaultScrollbars:!0,customStyle:d,resize:this.options.resizeIndicator,listenY:!1},this.wrapper.appendChild(b.el))):(a=this.options.indicators.length?this.options.indicators[0]:this.options.indicators,b=this.options.indicators[1]&&this.options.indicators[1]),a&&(this.indicator1=new f(this,a)),b&&(this.indicator2=new f(this,b)),this.on("refresh",function(){this.indicator1&&this.indicator1.refresh(),this.indicator2&&this.indicator2.refresh()}),this.on("destroy",function(){this.indicator1&&(this.indicator1.destroy(),this.indicator1=null),this.indicator2&&(this.indicator2.destroy(),this.indicator2=null)})},_initZoom:function(){this.scrollerStyle[h.style.transformOrigin]="0 0"},_zoomStart:function(a){var b=c.abs(a.touches[0].pageX-a.touches[1].pageX),d=c.abs(a.touches[0].pageY-a.touches[1].pageY);this.touchesDistanceStart=c.sqrt(b*b+d*d),this.startScale=this.scale,this.originX=c.abs(a.touches[0].pageX+a.touches[1].pageX)/2+this.wrapperOffset.left-this.x,this.originY=c.abs(a.touches[0].pageY+a.touches[1].pageY)/2+this.wrapperOffset.top-this.y,this._execEvent("zoomStart")},_zoom:function(a){if(this.enabled&&h.eventType[a.type]===this.initiated){this.options.preventDefault&&a.preventDefault();var b,d,e,f=c.abs(a.touches[0].pageX-a.touches[1].pageX),g=c.abs(a.touches[0].pageY-a.touches[1].pageY),i=c.sqrt(f*f+g*g),j=1/this.touchesDistanceStart*i*this.startScale;this.scaled=!0,this.scale<j?this.zoomDirection="in":this.zoomDirection="out",j<this.options.zoomMin?j=this.options.zoomBounce?.5*this.options.zoomMin*c.pow(2,j/this.options.zoomMin):this.options.zoomMin:j>this.options.zoomMax&&(j=this.options.zoomBounce?2*this.options.zoomMax*c.pow(.5,this.options.zoomMax/j):this.options.zoomMax),b=j/this.startScale,d=this.originX-this.originX*b+this.startX,e=this.originY-this.originY*b+this.startY,this.scale=j,this.scrollTo(d,e,0),this._execEvent("zoom")}},_zoomEnd:function(a){if(this.enabled&&h.eventType[a.type]===this.initiated){this.options.preventDefault&&a.preventDefault();var b,c,d;this.isInTransition=0,this.initiated=0,this.scale>this.options.zoomMax?this.scale=this.options.zoomMax:this.scale<this.options.zoomMin&&(this.scale=this.options.zoomMin),this.refresh(),d=this.scale/this.startScale,b=this.originX-this.originX*d+this.startX,c=this.originY-this.originY*d+this.startY,this.imageCurrentLeftAdjustment||(this.imageCurrentLeftAdjustment=0),this.imageCurrentTopAdjustment||(this.imageCurrentTopAdjustment=0),b>0?b=0:b<this.maxScrollX-this.imageCurrentLeftAdjustment&&(b=this.maxScrollX),c>0?c=0:c<this.maxScrollY-this.imageCurrentTopAdjustment&&(c=this.maxScrollY),(this.x!=b||this.y!=c)&&this.scrollTo(b,c,this.options.bounceTime),this.scaled=!1,this._execEvent("zoomEnd")}},zoom:function(a,b,c,d){if(a<this.options.zoomMin?a=this.options.zoomMin:a>this.options.zoomMax&&(a=this.options.zoomMax),a!=this.scale){var e=a/this.scale;this.scale<a?this.zoomDirection="in":this.zoomDirection="out",b=void 0===b?this.wrapperWidth/2:b,c=void 0===c?this.wrapperHeight/2:c,d=void 0===d?300:d,b=b+this.wrapperOffset.left-this.x,c=c+this.wrapperOffset.top-this.y,b=b-b*e+this.x,c=c-c*e+this.y,this.scale=a,this.refresh(),b>0?b=0:b<this.maxScrollX&&(b=this.maxScrollX),c>0?c=0:c<this.maxScrollY&&(c=this.maxScrollY),this.scrollTo(b,c,d)}},_wheelZoom:function(a){var b,d;if(a.preventDefault(),"wheelDeltaX"in a)b=a.wheelDeltaY/120;else if("wheelDelta"in a)b=a.wheelDelta/120;else{if(!("detail"in a))return;b=-a.detail/c.abs(a.detail)*2}b*=this.options.mouseWheelSpeed,d=this.scale+b/5,this.zoom(d,a.pageX,a.pageY,0),this._execEvent("wheelZoom")},_initWheel:function(){h.addEvent(this.wrapper,"mousewheel",this),h.addEvent(this.wrapper,"DOMMouseScroll",this),this.on("destroy",function(){h.removeEvent(this.wrapper,"mousewheel",this),h.removeEvent(this.wrapper,"DOMMouseScroll",this)})},_wheel:function(a){if(this.enabled){var b,c,d,e,f=this;if(clearTimeout(this.wheelTimeout),this.wheelTimeout=setTimeout(function(){f._execEvent("scrollEnd")},400),a.preventDefault(),"wheelDeltaX"in a)b=a.wheelDeltaX/120,c=a.wheelDeltaY/120;else if("wheelDelta"in a)b=c=a.wheelDelta/120;else{if(!("detail"in a))return;b=c=-a.detail/3}b*=this.options.mouseWheelSpeed,c*=this.options.mouseWheelSpeed,this.hasVerticalScroll||(b=c),d=this.x+(this.hasHorizontalScroll?b*this.options.invertWheelDirection:0),e=this.y+(this.hasVerticalScroll?c*this.options.invertWheelDirection:0),d>0?d=0:d<this.maxScrollX&&(d=this.maxScrollX),e>0?e=0:e<this.maxScrollY&&(e=this.maxScrollY),this.scrollTo(d,e,0),this.options.probeType>1&&this._execEvent("scroll")}},_initSnap:function(){this.currentPage={},"string"==typeof this.options.snap&&(this.options.snap=this.scroller.querySelectorAll(this.options.snap)),this.on("refresh",function(){var a,b,d,e,f,g,h=0,i=0,j=0,k=this.options.snapStepX||this.wrapperWidth,l=this.options.snapStepY||this.wrapperHeight;if(this.pages=[],this.options.snap===!0)for(d=c.round(k/2),e=c.round(l/2);j>-this.scrollerWidth;){for(this.pages[h]=[],a=0,f=0;f>-this.scrollerHeight;)this.pages[h][a]={x:c.max(j,this.maxScrollX),y:c.max(f,this.maxScrollY),width:k,height:l,cx:j-d,cy:f-e},f-=l,a++;j-=k,h++}else for(g=this.options.snap,a=g.length,b=-1;a>h;h++)(0===h||g[h].offsetLeft<=g[h-1].offsetLeft)&&(i=0,b++),this.pages[i]||(this.pages[i]=[]),j=c.max(-g[h].offsetLeft,this.maxScrollX),f=c.max(-g[h].offsetTop,this.maxScrollY),d=j-c.round(g[h].offsetWidth/2),e=f-c.round(g[h].offsetHeight/2),this.pages[i][b]={x:j,y:f,width:g[h].offsetWidth,height:g[h].offsetHeight,cx:d,cy:e},j>this.maxScrollX&&i++;this.goToPage(this.currentPage.pageX||0,this.currentPage.pageY||0,0),this.options.snapThreshold%1===0?(this.snapThresholdX=this.options.snapThreshold,this.snapThresholdY=this.options.snapThreshold):(this.snapThresholdX=c.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width*this.options.snapThreshold),this.snapThresholdY=c.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height*this.options.snapThreshold))}),this.on("flick",function(){var a=this.options.snapSpeed||c.max(c.max(c.min(c.abs(this.x-this.startX),1e3),c.min(c.abs(this.y-this.startY),1e3)),300);this.goToPage(this.currentPage.pageX+this.directionX,this.currentPage.pageY+this.directionY,a)})},_nearestSnap:function(a,b){var d=0,e=this.pages.length,f=0;if(c.abs(a-this.absStartX)<this.snapThresholdX&&c.abs(b-this.absStartY)<this.snapThresholdY)return this.currentPage;for(a>0?a=0:a<this.maxScrollX&&(a=this.maxScrollX),b>0?b=0:b<this.maxScrollY&&(b=this.maxScrollY);e>d;d++)if(a>=this.pages[d][0].cx){a=this.pages[d][0].x;break}for(e=this.pages[d].length;e>f;f++)if(b>=this.pages[0][f].cy){b=this.pages[0][f].y;break}return d==this.currentPage.pageX&&(d+=this.directionX,0>d?d=0:d>=this.pages.length&&(d=this.pages.length-1),a=this.pages[d][0].x),f==this.currentPage.pageY&&(f+=this.directionY,0>f?f=0:f>=this.pages[0].length&&(f=this.pages[0].length-1),b=this.pages[0][f].y),{x:a,y:b,pageX:d,pageY:f}},goToPage:function(a,b,d,e){e=e||this.options.bounceEasing,a>=this.pages.length?a=this.pages.length-1:0>a&&(a=0),b>=this.pages[0].length?b=this.pages[0].length-1:0>b&&(b=0);var f=this.pages[a][b].x,g=this.pages[a][b].y;d=void 0===d?this.options.snapSpeed||c.max(c.max(c.min(c.abs(f-this.x),1e3),c.min(c.abs(g-this.y),1e3)),300):d,this.currentPage={x:f,y:g,pageX:a,pageY:b},this.scrollTo(f,g,d,e)},next:function(a,b){var c=this.currentPage.pageX,d=this.currentPage.pageY;c++,c>=this.pages.length&&this.hasVerticalScroll&&(c=0,d++),this.goToPage(c,d,a,b)},prev:function(a,b){var c=this.currentPage.pageX,d=this.currentPage.pageY;c--,0>c&&this.hasVerticalScroll&&(c=0,d--),this.goToPage(c,d,a,b)},_initKeys:function(b){var c,d={pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40};if("object"==typeof this.options.keyBindings)for(c in this.options.keyBindings)"string"==typeof this.options.keyBindings[c]&&(this.options.keyBindings[c]=this.options.keyBindings[c].toUpperCase().charCodeAt(0));else this.options.keyBindings={};for(c in d)this.options.keyBindings[c]=this.options.keyBindings[c]||d[c];h.addEvent(a,"keydown",this),this.on("destroy",function(){h.removeEvent(a,"keydown",this)})},_key:function(a){if(this.enabled){var b,d=this.options.snap,e=d?this.currentPage.pageX:this.x,f=d?this.currentPage.pageY:this.y,g=h.getTime(),i=this.keyTime||0,j=.25;switch(this.options.useTransition&&this.isInTransition&&(b=this.getComputedPosition(),this._translate(c.round(b.x),c.round(b.y)),this.isInTransition=!1),this.keyAcceleration=200>g-i?c.min(this.keyAcceleration+j,50):0,a.keyCode){case this.options.keyBindings.pageUp:this.hasHorizontalScroll&&!this.hasVerticalScroll?e+=d?1:this.wrapperWidth:f+=d?1:this.wrapperHeight;break;case this.options.keyBindings.pageDown:this.hasHorizontalScroll&&!this.hasVerticalScroll?e-=d?1:this.wrapperWidth:f-=d?1:this.wrapperHeight;break;case this.options.keyBindings.end:e=d?this.pages.length-1:this.maxScrollX,f=d?this.pages[0].length-1:this.maxScrollY;break;case this.options.keyBindings.home:e=0,f=0;break;case this.options.keyBindings.left:e+=d?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.up:f+=d?1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.right:e-=d?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.down:f-=d?1:5+this.keyAcceleration>>0}if(d)return void this.goToPage(e,f);e>0?(e=0,this.keyAcceleration=0):e<this.maxScrollX&&(e=this.maxScrollX,this.keyAcceleration=0),f>0?(f=0,this.keyAcceleration=0):f<this.maxScrollY&&(f=this.maxScrollY,this.keyAcceleration=0),this.scrollTo(e,f,0),this.keyTime=g}},_animate:function(a,b,c,d){function e(){var m,n,o,p=h.getTime();return p>=l?(f.isAnimating=!1,f._translate(a,b),void(f.resetPosition(f.options.bounceTime)||f._execEvent("scrollEnd"))):(p=(p-k)/c,o=d(p),m=(a-i)*o+i,n=(b-j)*o+j,f._translate(m,n),f.isAnimating&&g(e),void(3==f.options.probeType&&f._execEvent("scroll")))}var f=this,i=this.x,j=this.y,k=h.getTime(),l=k+c;this.isAnimating=!0,e()},_updatePointer:function(a){for(var b=this._pointers.length,c=a.pointerId;b>0;){if(this._pointers[b-1].pointerId===c)return void(this._pointers[b-1]=a);a.touches=this._pointers,b--}},_removePointer:function(a){for(var b=this._pointers.length,c=a.pointerId;b>0;)this._pointers[b-1].pointerId===c&&this._pointers.splice(b-1,1),b--;a.touches=this._pointers},_addPointer:function(a){return this._pointers.length>2?void(a.touches=this._pointers):(this._pointers.push(a),void(a.touches=this._pointers))},handleEvent:function(a){switch(a.type){case"touchstart":case"MSPointerDown":case"pointerdown":case"mousedown":h.hasPointer&&this._addPointer(a),this._start(a),this.options.zoom&&a.touches&&a.touches.length>1&&this._zoomStart(a);break;case"touchmove":case"MSPointerMove":case"mousemove":case"pointermove":if(h.hasPointer&&this._updatePointer(a),this.options.zoom&&a.touches&&a.touches[1])return void this._zoom(a);1!==this._pointers.length&&h.hasPointer||this._move(a);break;case"touchend":case"MSPointerUp":case"pointerup":case"mouseup":case"touchcancel":case"MSPointerCancel":case"pointercancel":case"mousecancel":if(h.hasPointer&&this._removePointer(a),this.scaled)return void this._zoomEnd(a);this._end(a);break;case"orientationchange":case"resize":this._resize();break;case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this._transitionEnd(a);break;case"DOMMouseScroll":case"mousewheel":if("zoom"==this.options.wheelAction)return void this._wheelZoom(a);this._wheel(a);break;case"keydown":this._key(a)}}},f.prototype={handleEvent:function(a){switch(a.type){case"touchstart":case"MSPointerDown":case"pointerdown":case"mousedown":this._start(a);break;case"touchmove":case"MSPointerMove":case"pointermove":case"mousemove":this._move(a);break;case"touchend":case"MSPointerUp":case"pointerup":case"mouseup":case"touchcancel":case"MSPointerCancel":case"pointercancel":case"mousecancel":this._end(a)}},destroy:function(){this.options.interactive&&(h.removeEvent(this.indicator,"touchstart",this),h.removeEvent(this.indicator,"MSPointerDown",this),h.removeEvent(this.indicator,"pointerdown",this),h.removeEvent(this.indicator,"mousedown",this),h.removeEvent(a,"touchmove",this),h.removeEvent(a,"MSPointerMove",this),h.removeEvent(a,"pointermove",this),h.removeEvent(a,"mousemove",this),h.removeEvent(a,"touchend",this),h.removeEvent(a,"MSPointerUp",this),h.removeEvent(a,"pointerup",this),h.removeEvent(a,"mouseup",this)),this.options.defaultScrollbars&&this.wrapper.parentNode.removeChild(this.wrapper)},_start:function(b){var c=b.touches?b.touches[0]:b;b.preventDefault(),b.stopPropagation(),this.transitionTime(0),this.initiated=!0,this.moved=!1,this.lastPointX=c.pageX,this.lastPointY=c.pageY,this.startTime=h.getTime(),h.addEvent(a,"touchmove",this),h.addEvent(a,"MSPointerMove",this),h.addEvent(a,"pointermove",this),h.addEvent(a,"mousemove",this),this.scroller._execEvent("scrollStart")},_move:function(a){var b,c,d,e,f=a.touches?a.touches[0]:a;h.getTime();this.moved=!0,b=f.pageX-this.lastPointX,this.lastPointX=f.pageX,c=f.pageY-this.lastPointY,this.lastPointY=f.pageY,d=this.x+b,e=this.y+c,this._pos(d,e),a.preventDefault(),a.stopPropagation()},_end:function(b){this.initiated&&(this.initiated=!1,b.preventDefault(),b.stopPropagation(),h.removeEvent(a,"touchmove",this),h.removeEvent(a,"MSPointerMove",this),h.removeEvent(a,"pointermove",this),h.removeEvent(a,"mousemove",this),this.moved&&this.scroller._execEvent("scrollEnd"))},transitionTime:function(a){a=a||0,this.indicatorStyle[h.style.transitionDuration]=a+"ms"},transitionTimingFunction:function(a){this.indicatorStyle[h.style.transitionTimingFunction]=a},refresh:function(){this.transitionTime(0),this.options.listenX&&!this.options.listenY?this.indicatorStyle.display=this.scroller.hasHorizontalScroll?"block":"none":this.options.listenY&&!this.options.listenX?this.indicatorStyle.display=this.scroller.hasVerticalScroll?"block":"none":this.indicatorStyle.display=this.scroller.hasHorizontalScroll||this.scroller.hasVerticalScroll?"block":"none",this.scroller.hasHorizontalScroll&&this.scroller.hasVerticalScroll?(h.addClass(this.wrapper,"iScrollBothScrollbars"),h.removeClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="8px":this.wrapper.style.bottom="8px")):(h.removeClass(this.wrapper,"iScrollBothScrollbars"),h.addClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="2px":this.wrapper.style.bottom="2px"));this.wrapper.offsetHeight;this.options.listenX&&(this.wrapperWidth=this.wrapper.clientWidth,this.options.resize?(this.indicatorWidth=c.max(c.round(this.wrapperWidth*this.wrapperWidth/this.scroller.scrollerWidth),8),this.indicatorStyle.width=this.indicatorWidth+"px"):this.indicatorWidth=this.indicator.clientWidth,
this.maxPosX=this.wrapperWidth-this.indicatorWidth,this.sizeRatioX=this.options.speedRatioX||this.scroller.maxScrollX&&this.maxPosX/this.scroller.maxScrollX),this.options.listenY&&(this.wrapperHeight=this.wrapper.clientHeight,this.options.resize?(this.indicatorHeight=c.max(c.round(this.wrapperHeight*this.wrapperHeight/this.scroller.scrollerHeight),8),this.indicatorStyle.height=this.indicatorHeight+"px"):this.indicatorHeight=this.indicator.clientHeight,this.maxPosY=this.wrapperHeight-this.indicatorHeight,this.sizeRatioY=this.options.speedRatioY||this.scroller.maxScrollY&&this.maxPosY/this.scroller.maxScrollY),this.updatePosition()},updatePosition:function(){var a=c.round(this.sizeRatioX*this.scroller.x)||0,b=c.round(this.sizeRatioY*this.scroller.y)||0;this.options.ignoreBoundaries||(0>a?a=0:a>this.maxPosX&&(a=this.maxPosX),0>b?b=0:b>this.maxPosY&&(b=this.maxPosY)),this.x=a,this.y=b,this.scroller.options.useTransform?this.indicatorStyle[h.style.transform]="translate("+a+"px,"+b+"px)"+this.scroller.translateZ:(this.indicatorStyle.left=a+"px",this.indicatorStyle.top=b+"px")},_pos:function(a,b){0>a?a=0:a>this.maxPosX&&(a=this.maxPosX),0>b?b=0:b>this.maxPosY&&(b=this.maxPosY),a=this.options.listenX?c.round(a/this.sizeRatioX):this.scroller.x,b=this.options.listenY?c.round(b/this.sizeRatioY):this.scroller.y,this.scroller.scrollTo(a,b)}},d.ease=h.ease,d}(window,document,Math);!function(a,b,c){"undefined"!=typeof module?module.exports=c(a,b):"function"==typeof define&&"object"==typeof define.amd?define(c):b[a]=c(a,b)}("radio",this,function(a,b){"use strict";function c(a){return arguments.length?c.$.channel(a):c.$.reset(),c.$}return c.$={version:"0.3",channelName:"",channels:{},reset:function(){c.$.channelName="",c.$.channels={}},cleanup:function(){var a,b,c=this.channels[this.channelName],d=c.length;for(a=0;d>a;a++)b=c[a],null===b&&(c.splice(a,1),d=c.length,a--)},broadcast:function(){var a,c,d,e,f=this.channels[this.channelName],g=f.length;for(a=0;g>a;a++)c=f[a],c&&"object"==typeof c&&c.length&&(d=c[0],e=c[1]||b,d.apply(e,arguments));return this.cleanup(),this},channel:function(a){var b=this.channels;return b[a]||(b[a]=[]),this.channelName=a,this},subscribe:function(){var a,b,c=arguments,d=this.channels[this.channelName],e=c.length,f=[];for(a=0;e>a;a++)f=c[a],b="function"==typeof f?[f]:f,"object"==typeof b&&b.length&&d.push(b);return this},unsubscribe:function(){var a,b,c,d=arguments,e=this.channels[this.channelName],f=e.length;for(a=0;a<d.length;a++)for(b=0;f>b;b++)e[b]&&(c=d[a],"function"==typeof c&&e[b][0]===c?e[b]=null:"object"==typeof c&&c.length&&e[b][0]===d[a][0]&&e[b][1]===d[a][1]&&(e[b]=null));return this}},c}),function(){function a(a,b,c){for(var d=(c||0)-1,e=a?a.length:0;++d<e;)if(a[d]===b)return d;return-1}function b(b,c){var d=typeof c;if(b=b.cache,"boolean"==d||null==c)return b[c]?0:-1;"number"!=d&&"string"!=d&&(d="object");var e="number"==d?c:r+c;return b=(b=b[d])&&b[e],"object"==d?b&&a(b,c)>-1?0:-1:b?0:-1}function c(a){var b=this.cache,c=typeof a;if("boolean"==c||null==a)b[a]=!0;else{"number"!=c&&"string"!=c&&(c="object");var d="number"==c?a:r+a,e=b[c]||(b[c]={});"object"==c?(e[d]||(e[d]=[])).push(a):e[d]=!0}}function d(a){return a.charCodeAt(0)}function e(a,b){for(var c=a.criteria,d=b.criteria,e=-1,f=c.length;++e<f;){var g=c[e],h=d[e];if(g!==h){if(g>h||"undefined"==typeof g)return 1;if(h>g||"undefined"==typeof h)return-1}}return a.index-b.index}function f(a){var b=-1,d=a.length,e=a[0],f=a[d/2|0],g=a[d-1];if(e&&"object"==typeof e&&f&&"object"==typeof f&&g&&"object"==typeof g)return!1;var h=i();h["false"]=h["null"]=h["true"]=h.undefined=!1;var j=i();for(j.array=a,j.cache=h,j.push=c;++b<d;)j.push(a[b]);return j}function g(a){return"\\"+V[a]}function h(){return o.pop()||[]}function i(){return p.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function j(a){a.length=0,o.length<t&&o.push(a)}function k(a){var b=a.cache;b&&k(b),a.array=a.cache=a.criteria=a.object=a.number=a.string=a.value=null,p.length<t&&p.push(a)}function l(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}function m(c){function o(a){return a&&"object"==typeof a&&!Zc(a)&&Hc.call(a,"__wrapped__")?a:new p(a)}function p(a,b){this.__chain__=!!b,this.__wrapped__=a}function t(a){function b(){if(d){var a=l(d);Ic.apply(a,arguments)}if(this instanceof b){var f=X(c.prototype),g=c.apply(f,a||arguments);return Ea(g)?g:f}return c.apply(e,a||arguments)}var c=a[0],d=a[2],e=a[4];return Yc(b,a),b}function V(a,b,c,d,e){if(c){var f=c(a);if("undefined"!=typeof f)return f}var g=Ea(a);if(!g)return a;var i=Ac.call(a);if(!R[i])return a;var k=Wc[i];switch(i){case K:case L:return new k(+a);case N:case Q:return new k(a);case P:return f=k(a.source,z.exec(a)),f.lastIndex=a.lastIndex,f}var m=Zc(a);if(b){var n=!d;d||(d=h()),e||(e=h());for(var o=d.length;o--;)if(d[o]==a)return e[o];f=m?k(a.length):{}}else f=m?l(a):ed({},a);return m&&(Hc.call(a,"index")&&(f.index=a.index),Hc.call(a,"input")&&(f.input=a.input)),b?(d.push(a),e.push(f),(m?Ya:hd)(a,function(a,g){f[g]=V(a,b,c,d,e)}),n&&(j(d),j(e)),f):f}function X(a,b){return Ea(a)?Nc(a):{}}function Y(a,b,c){if("function"!=typeof a)return Zb;if("undefined"==typeof b||!("prototype"in a))return a;var d=a.__bindData__;if("undefined"==typeof d&&(Xc.funcNames&&(d=!a.name),d=d||!Xc.funcDecomp,!d)){var e=Fc.call(a);Xc.funcNames||(d=!A.test(e)),d||(d=E.test(e),Yc(a,d))}if(d===!1||d!==!0&&1&d[1])return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return Ib(a,b)}function Z(a){function b(){var a=i?g:this;if(e){var o=l(e);Ic.apply(o,arguments)}if((f||k)&&(o||(o=l(arguments)),f&&Ic.apply(o,f),k&&o.length<h))return d|=16,Z([c,m?d:-4&d,o,null,g,h]);if(o||(o=arguments),j&&(c=a[n]),this instanceof b){a=X(c.prototype);var p=c.apply(a,o);return Ea(p)?p:a}return c.apply(a,o)}var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=1&d,j=2&d,k=4&d,m=8&d,n=c;return Yc(b,a),b}function $(c,d){var e=-1,g=ia(),h=c?c.length:0,i=h>=s&&g===a,j=[];if(i){var l=f(d);l?(g=b,d=l):i=!1}for(;++e<h;){var m=c[e];g(d,m)<0&&j.push(m)}return i&&k(d),j}function aa(a,b,c,d){for(var e=(d||0)-1,f=a?a.length:0,g=[];++e<f;){var h=a[e];if(h&&"object"==typeof h&&"number"==typeof h.length&&(Zc(h)||ma(h))){b||(h=aa(h,b,c));var i=-1,j=h.length,k=g.length;for(g.length+=j;++i<j;)g[k++]=h[i]}else c||g.push(h)}return g}function ba(a,b,c,d,e,f){if(c){var g=c(a,b);if("undefined"!=typeof g)return!!g}if(a===b)return 0!==a||1/a==1/b;var i=typeof a,k=typeof b;if(!(a!==a||a&&U[i]||b&&U[k]))return!1;if(null==a||null==b)return a===b;var l=Ac.call(a),m=Ac.call(b);if(l==I&&(l=O),m==I&&(m=O),l!=m)return!1;switch(l){case K:case L:return+a==+b;case N:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case P:case Q:return a==vc(b)}var n=l==J;if(!n){var o=Hc.call(a,"__wrapped__"),p=Hc.call(b,"__wrapped__");if(o||p)return ba(o?a.__wrapped__:a,p?b.__wrapped__:b,c,d,e,f);if(l!=O)return!1;var q=a.constructor,r=b.constructor;if(q!=r&&!(Da(q)&&q instanceof q&&Da(r)&&r instanceof r)&&"constructor"in a&&"constructor"in b)return!1}var s=!e;e||(e=h()),f||(f=h());for(var t=e.length;t--;)if(e[t]==a)return f[t]==b;var u=0;if(g=!0,e.push(a),f.push(b),n){if(t=a.length,u=b.length,g=u==t,g||d)for(;u--;){var v=t,w=b[u];if(d)for(;v--&&!(g=ba(a[v],w,c,d,e,f)););else if(!(g=ba(a[u],w,c,d,e,f)))break}}else gd(b,function(b,h,i){return Hc.call(i,h)?(u++,g=Hc.call(a,h)&&ba(a[h],b,c,d,e,f)):void 0}),g&&!d&&gd(a,function(a,b,c){return Hc.call(c,b)?g=--u>-1:void 0});return e.pop(),f.pop(),s&&(j(e),j(f)),g}function ca(a,b,c,d,e){(Zc(b)?Ya:hd)(b,function(b,f){var g,h,i=b,j=a[f];if(b&&((h=Zc(b))||id(b))){for(var k=d.length;k--;)if(g=d[k]==b){j=e[k];break}if(!g){var l;c&&(i=c(j,b),(l="undefined"!=typeof i)&&(j=i)),l||(j=h?Zc(j)?j:[]:id(j)?j:{}),d.push(b),e.push(j),l||ca(j,b,c,d,e)}}else c&&(i=c(j,b),"undefined"==typeof i&&(i=b)),"undefined"!=typeof i&&(j=i);a[f]=j})}function da(a,b){return a+Ec(Vc()*(b-a+1))}function ea(c,d,e){var g=-1,i=ia(),l=c?c.length:0,m=[],n=!d&&l>=s&&i===a,o=e||n?h():m;if(n){var p=f(o);i=b,o=p}for(;++g<l;){var q=c[g],r=e?e(q,g,c):q;(d?!g||o[o.length-1]!==r:i(o,r)<0)&&((e||n)&&o.push(r),m.push(q))}return n?(j(o.array),k(o)):e&&j(o),m}function fa(a){return function(b,c,d){var e={};c=o.createCallback(c,d,3);var f=-1,g=b?b.length:0;if("number"==typeof g)for(;++f<g;){var h=b[f];a(e,h,c(h,f,b),b)}else hd(b,function(b,d,f){a(e,b,c(b,d,f),f)});return e}}function ga(a,b,c,d,e,f){var g=1&b,h=2&b,i=4&b,j=16&b,k=32&b;if(!h&&!Da(a))throw new wc;j&&!c.length&&(b&=-17,j=c=!1),k&&!d.length&&(b&=-33,k=d=!1);var m=a&&a.__bindData__;if(m&&m!==!0)return m=l(m),m[2]&&(m[2]=l(m[2])),m[3]&&(m[3]=l(m[3])),!g||1&m[1]||(m[4]=e),!g&&1&m[1]&&(b|=8),!i||4&m[1]||(m[5]=f),j&&Ic.apply(m[2]||(m[2]=[]),c),k&&Lc.apply(m[3]||(m[3]=[]),d),m[1]|=b,ga.apply(null,m);var n=1==b||17===b?t:Z;return n([a,b,c,d,e,f])}function ha(a){return ad[a]}function ia(){var b=(b=o.indexOf)===rb?a:b;return b}function ja(a){return"function"==typeof a&&Bc.test(a)}function ka(a){var b,c;return a&&Ac.call(a)==O&&(b=a.constructor,!Da(b)||b instanceof b)?(gd(a,function(a,b){c=b}),"undefined"==typeof c||Hc.call(a,c)):!1}function la(a){return bd[a]}function ma(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ac.call(a)==I||!1}function na(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=b,b=!1),V(a,b,"function"==typeof c&&Y(c,d,1))}function oa(a,b,c){return V(a,!0,"function"==typeof b&&Y(b,c,1))}function pa(a,b){var c=X(a);return b?ed(c,b):c}function qa(a,b,c){var d;return b=o.createCallback(b,c,3),hd(a,function(a,c,e){return b(a,c,e)?(d=c,!1):void 0}),d}function ra(a,b,c){var d;return b=o.createCallback(b,c,3),ta(a,function(a,c,e){return b(a,c,e)?(d=c,!1):void 0}),d}function sa(a,b,c){var d=[];gd(a,function(a,b){d.push(b,a)});var e=d.length;for(b=Y(b,c,3);e--&&b(d[e--],d[e],a)!==!1;);return a}function ta(a,b,c){var d=_c(a),e=d.length;for(b=Y(b,c,3);e--;){var f=d[e];if(b(a[f],f,a)===!1)break}return a}function ua(a){var b=[];return gd(a,function(a,c){Da(a)&&b.push(c)}),b.sort()}function va(a,b){return a?Hc.call(a,b):!1}function wa(a){for(var b=-1,c=_c(a),d=c.length,e={};++b<d;){var f=c[b];e[a[f]]=f}return e}function xa(a){return a===!0||a===!1||a&&"object"==typeof a&&Ac.call(a)==K||!1}function ya(a){return a&&"object"==typeof a&&Ac.call(a)==L||!1}function za(a){return a&&1===a.nodeType||!1}function Aa(a){var b=!0;if(!a)return b;var c=Ac.call(a),d=a.length;return c==J||c==Q||c==I||c==O&&"number"==typeof d&&Da(a.splice)?!d:(hd(a,function(){return b=!1}),b)}function Ba(a,b,c,d){return ba(a,b,"function"==typeof c&&Y(c,d,2))}function Ca(a){return Pc(a)&&!Qc(parseFloat(a))}function Da(a){return"function"==typeof a}function Ea(a){return!(!a||!U[typeof a])}function Fa(a){return Ha(a)&&a!=+a}function Ga(a){return null===a}function Ha(a){return"number"==typeof a||a&&"object"==typeof a&&Ac.call(a)==N||!1}function Ia(a){return a&&"object"==typeof a&&Ac.call(a)==P||!1}function Ja(a){return"string"==typeof a||a&&"object"==typeof a&&Ac.call(a)==Q||!1}function Ka(a){return"undefined"==typeof a}function La(a,b,c){var d={};return b=o.createCallback(b,c,3),hd(a,function(a,c,e){d[c]=b(a,c,e)}),d}function Ma(a){var b=arguments,c=2;if(!Ea(a))return a;if("number"!=typeof b[2]&&(c=b.length),c>3&&"function"==typeof b[c-2])var d=Y(b[--c-1],b[c--],2);else c>2&&"function"==typeof b[c-1]&&(d=b[--c]);for(var e=l(arguments,1,c),f=-1,g=h(),i=h();++f<c;)ca(a,e[f],d,g,i);return j(g),j(i),a}function Na(a,b,c){var d={};if("function"!=typeof b){var e=[];gd(a,function(a,b){e.push(b)}),e=$(e,aa(arguments,!0,!1,1));for(var f=-1,g=e.length;++f<g;){var h=e[f];d[h]=a[h]}}else b=o.createCallback(b,c,3),gd(a,function(a,c,e){b(a,c,e)||(d[c]=a)});return d}function Oa(a){for(var b=-1,c=_c(a),d=c.length,e=nc(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e}function Pa(a,b,c){var d={};if("function"!=typeof b)for(var e=-1,f=aa(arguments,!0,!1,1),g=Ea(a)?f.length:0;++e<g;){var h=f[e];h in a&&(d[h]=a[h])}else b=o.createCallback(b,c,3),gd(a,function(a,c,e){b(a,c,e)&&(d[c]=a)});return d}function Qa(a,b,c,d){var e=Zc(a);if(null==c)if(e)c=[];else{var f=a&&a.constructor,g=f&&f.prototype;c=X(g)}return b&&(b=o.createCallback(b,d,4),(e?Ya:hd)(a,function(a,d,e){return b(c,a,d,e)})),c}function Ra(a){for(var b=-1,c=_c(a),d=c.length,e=nc(d);++b<d;)e[b]=a[c[b]];return e}function Sa(a){for(var b=arguments,c=-1,d=aa(b,!0,!1,1),e=b[2]&&b[2][b[1]]===a?1:d.length,f=nc(e);++c<e;)f[c]=a[d[c]];return f}function Ta(a,b,c){var d=-1,e=ia(),f=a?a.length:0,g=!1;return c=(0>c?Sc(0,f+c):c)||0,Zc(a)?g=e(a,b,c)>-1:"number"==typeof f?g=(Ja(a)?a.indexOf(b,c):e(a,b,c))>-1:hd(a,function(a){return++d>=c?!(g=a===b):void 0}),g}function Ua(a,b,c){var d=!0;b=o.createCallback(b,c,3);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f&&(d=!!b(a[e],e,a)););else hd(a,function(a,c,e){return d=!!b(a,c,e)});return d}function Va(a,b,c){var d=[];b=o.createCallback(b,c,3);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f;){var g=a[e];b(g,e,a)&&d.push(g)}else hd(a,function(a,c,e){b(a,c,e)&&d.push(a)});return d}function Wa(a,b,c){b=o.createCallback(b,c,3);var d=-1,e=a?a.length:0;if("number"!=typeof e){var f;return hd(a,function(a,c,d){return b(a,c,d)?(f=a,!1):void 0}),f}for(;++d<e;){var g=a[d];if(b(g,d,a))return g}}function Xa(a,b,c){var d;return b=o.createCallback(b,c,3),Za(a,function(a,c,e){return b(a,c,e)?(d=a,!1):void 0}),d}function Ya(a,b,c){var d=-1,e=a?a.length:0;if(b=b&&"undefined"==typeof c?b:Y(b,c,3),"number"==typeof e)for(;++d<e&&b(a[d],d,a)!==!1;);else hd(a,b);return a}function Za(a,b,c){var d=a?a.length:0;if(b=b&&"undefined"==typeof c?b:Y(b,c,3),"number"==typeof d)for(;d--&&b(a[d],d,a)!==!1;);else{var e=_c(a);d=e.length,hd(a,function(a,c,f){return c=e?e[--d]:--d,b(f[c],c,f)})}return a}function $a(a,b){var c=l(arguments,2),d=-1,e="function"==typeof b,f=a?a.length:0,g=nc("number"==typeof f?f:0);return Ya(a,function(a){g[++d]=(e?b:a[b]).apply(a,c)}),g}function _a(a,b,c){var d=-1,e=a?a.length:0;if(b=o.createCallback(b,c,3),"number"==typeof e)for(var f=nc(e);++d<e;)f[d]=b(a[d],d,a);else f=[],hd(a,function(a,c,e){f[++d]=b(a,c,e)});return f}function ab(a,b,c){var e=-(1/0),f=e;if("function"!=typeof b&&c&&c[b]===a&&(b=null),null==b&&Zc(a))for(var g=-1,h=a.length;++g<h;){var i=a[g];i>f&&(f=i)}else b=null==b&&Ja(a)?d:o.createCallback(b,c,3),Ya(a,function(a,c,d){var g=b(a,c,d);g>e&&(e=g,f=a)});return f}function bb(a,b,c){var e=1/0,f=e;if("function"!=typeof b&&c&&c[b]===a&&(b=null),null==b&&Zc(a))for(var g=-1,h=a.length;++g<h;){var i=a[g];f>i&&(f=i)}else b=null==b&&Ja(a)?d:o.createCallback(b,c,3),Ya(a,function(a,c,d){var g=b(a,c,d);e>g&&(e=g,f=a)});return f}function cb(a,b,c,d){if(!a)return c;var e=arguments.length<3;b=o.createCallback(b,d,4);var f=-1,g=a.length;if("number"==typeof g)for(e&&(c=a[++f]);++f<g;)c=b(c,a[f],f,a);else hd(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)});return c}function db(a,b,c,d){var e=arguments.length<3;return b=o.createCallback(b,d,4),Za(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)}),c}function eb(a,b,c){return b=o.createCallback(b,c,3),Va(a,function(a,c,d){return!b(a,c,d)})}function fb(a,b,c){if(a&&"number"!=typeof a.length&&(a=Ra(a)),null==b||c)return a?a[da(0,a.length-1)]:n;var d=gb(a);return d.length=Tc(Sc(0,b),d.length),d}function gb(a){var b=-1,c=a?a.length:0,d=nc("number"==typeof c?c:0);return Ya(a,function(a){var c=da(0,++b);d[b]=d[c],d[c]=a}),d}function hb(a){var b=a?a.length:0;return"number"==typeof b?b:_c(a).length}function ib(a,b,c){var d;b=o.createCallback(b,c,3);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f&&!(d=b(a[e],e,a)););else hd(a,function(a,c,e){return!(d=b(a,c,e))});return!!d}function jb(a,b,c){var d=-1,f=Zc(b),g=a?a.length:0,l=nc("number"==typeof g?g:0);for(f||(b=o.createCallback(b,c,3)),Ya(a,function(a,c,e){var g=l[++d]=i();f?g.criteria=_a(b,function(b){return a[b]}):(g.criteria=h())[0]=b(a,c,e),g.index=d,g.value=a}),g=l.length,l.sort(e);g--;){var m=l[g];l[g]=m.value,f||j(m.criteria),k(m)}return l}function kb(a){return a&&"number"==typeof a.length?l(a):Ra(a)}function lb(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d}function mb(a){return $(a,aa(arguments,!0,!0,1))}function nb(a,b,c){var d=-1,e=a?a.length:0;for(b=o.createCallback(b,c,3);++d<e;)if(b(a[d],d,a))return d;return-1}function ob(a,b,c){var d=a?a.length:0;for(b=o.createCallback(b,c,3);d--;)if(b(a[d],d,a))return d;return-1}function pb(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=-1;for(b=o.createCallback(b,c,3);++f<e&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a?a[0]:n;return l(a,0,Tc(Sc(0,d),e))}function qb(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c="function"!=typeof b&&d&&d[b]===a?null:b,b=!1),null!=c&&(a=_a(a,c,d)),aa(a,b)}function rb(b,c,d){if("number"==typeof d){var e=b?b.length:0;d=0>d?Sc(0,e+d):d||0}else if(d){var f=Ab(b,c);return b[f]===c?f:-1}return a(b,c,d)}function sb(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=e;for(b=o.createCallback(b,c,3);f--&&b(a[f],f,a);)d++}else d=null==b||c?1:b||d;return l(a,0,Tc(Sc(0,e-d),e))}function tb(){for(var c=[],d=-1,e=arguments.length,g=h(),i=ia(),l=i===a,m=h();++d<e;){var n=arguments[d];(Zc(n)||ma(n))&&(c.push(n),g.push(l&&n.length>=s&&f(d?c[d]:m)))}var o=c[0],p=-1,q=o?o.length:0,r=[];a:for(;++p<q;){var t=g[0];if(n=o[p],(t?b(t,n):i(m,n))<0){for(d=e,(t||m).push(n);--d;)if(t=g[d],(t?b(t,n):i(c[d],n))<0)continue a;r.push(n)}}for(;e--;)t=g[e],t&&k(t);return j(g),j(m),r}function ub(a,b,c){var d=0,e=a?a.length:0;if("number"!=typeof b&&null!=b){var f=e;for(b=o.createCallback(b,c,3);f--&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a?a[e-1]:n;return l(a,Sc(0,e-d))}function vb(a,b,c){var d=a?a.length:0;for("number"==typeof c&&(d=(0>c?Sc(0,d+c):Tc(c,d-1))+1);d--;)if(a[d]===b)return d;return-1}function wb(a){for(var b=arguments,c=0,d=b.length,e=a?a.length:0;++c<d;)for(var f=-1,g=b[c];++f<e;)a[f]===g&&(Kc.call(a,f--,1),e--);return a}function xb(a,b,c){a=+a||0,c="number"==typeof c?c:+c||1,null==b&&(b=a,a=0);for(var d=-1,e=Sc(0,Cc((b-a)/(c||1))),f=nc(e);++d<e;)f[d]=a,a+=c;return f}function yb(a,b,c){var d=-1,e=a?a.length:0,f=[];for(b=o.createCallback(b,c,3);++d<e;){var g=a[d];b(g,d,a)&&(f.push(g),Kc.call(a,d--,1),e--)}return f}function zb(a,b,c){if("number"!=typeof b&&null!=b){var d=0,e=-1,f=a?a.length:0;for(b=o.createCallback(b,c,3);++e<f&&b(a[e],e,a);)d++}else d=null==b||c?1:Sc(0,b);return l(a,d)}function Ab(a,b,c,d){var e=0,f=a?a.length:e;for(c=c?o.createCallback(c,d,1):Zb,b=c(b);f>e;){var g=e+f>>>1;c(a[g])<b?e=g+1:f=g}return e}function Bb(){return ea(aa(arguments,!0,!0))}function Cb(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c="function"!=typeof b&&d&&d[b]===a?null:b,b=!1),null!=c&&(c=o.createCallback(c,d,3)),ea(a,b,c)}function Db(a){return $(a,l(arguments,1))}function Eb(){for(var a=-1,b=arguments.length;++a<b;){var c=arguments[a];if(Zc(c)||ma(c))var d=d?ea($(d,c).concat($(c,d))):c}return d||[]}function Fb(){for(var a=arguments.length>1?arguments:arguments[0],b=-1,c=a?ab(md(a,"length")):0,d=nc(0>c?0:c);++b<c;)d[b]=md(a,b);return d}function Gb(a,b){var c=-1,d=a?a.length:0,e={};for(b||!d||Zc(a[0])||(b=[]);++c<d;){var f=a[c];b?e[f]=b[c]:f&&(e[f[0]]=f[1])}return e}function Hb(a,b){if(!Da(b))throw new wc;return function(){return--a<1?b.apply(this,arguments):void 0}}function Ib(a,b){return arguments.length>2?ga(a,17,l(arguments,2),null,b):ga(a,1,null,null,b)}function Jb(a){for(var b=arguments.length>1?aa(arguments,!0,!1,1):ua(a),c=-1,d=b.length;++c<d;){var e=b[c];a[e]=ga(a[e],1,null,null,a)}return a}function Kb(a,b){return arguments.length>2?ga(b,19,l(arguments,2),null,a):ga(b,3,null,null,a)}function Lb(){for(var a=arguments,b=a.length;b--;)if(!Da(a[b]))throw new wc;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}}function Mb(a,b){return b="number"==typeof b?b:+b||a.length,ga(a,4,null,null,null,b)}function Nb(a,b,c){var d,e,f,g,h,i,j,k=0,l=!1,m=!0;if(!Da(a))throw new wc;if(b=Sc(0,b)||0,c===!0){var o=!0;m=!1}else Ea(c)&&(o=c.leading,l="maxWait"in c&&(Sc(b,c.maxWait)||0),m="trailing"in c?c.trailing:m);var p=function(){var c=b-(od()-g);if(0>=c){e&&Dc(e);var l=j;e=i=j=n,l&&(k=od(),f=a.apply(h,d),i||e||(d=h=null))}else i=Jc(p,c)},q=function(){i&&Dc(i),e=i=j=n,(m||l!==b)&&(k=od(),f=a.apply(h,d),i||e||(d=h=null))};return function(){if(d=arguments,g=od(),h=this,j=m&&(i||!o),l===!1)var c=o&&!i;else{e||o||(k=g);var n=l-(g-k),r=0>=n;r?(e&&(e=Dc(e)),k=g,f=a.apply(h,d)):e||(e=Jc(q,n))}return r&&i?i=Dc(i):i||b===l||(i=Jc(p,b)),c&&(r=!0,f=a.apply(h,d)),!r||i||e||(d=h=null),f}}function Ob(a){if(!Da(a))throw new wc;var b=l(arguments,1);return Jc(function(){a.apply(n,b)},1)}function Pb(a,b){if(!Da(a))throw new wc;var c=l(arguments,2);return Jc(function(){a.apply(n,c)},b)}function Qb(a,b){if(!Da(a))throw new wc;var c=function(){var d=c.cache,e=b?b.apply(this,arguments):r+arguments[0];return Hc.call(d,e)?d[e]:d[e]=a.apply(this,arguments)};return c.cache={},c}function Rb(a){var b,c;if(!Da(a))throw new wc;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}}function Sb(a){return ga(a,16,l(arguments,1))}function Tb(a){return ga(a,32,null,l(arguments,1))}function Ub(a,b,c){var d=!0,e=!0;if(!Da(a))throw new wc;return c===!1?d=!1:Ea(c)&&(d="leading"in c?c.leading:d,e="trailing"in c?c.trailing:e),S.leading=d,S.maxWait=b,S.trailing=e,Nb(a,b,S)}function Vb(a,b){return ga(b,16,[a])}function Wb(a){return function(){return a}}function Xb(a,b,c){var d=typeof a;if(null==a||"function"==d)return Y(a,b,c);if("object"!=d)return bc(a);var e=_c(a),f=e[0],g=a[f];return 1!=e.length||g!==g||Ea(g)?function(b){for(var c=e.length,d=!1;c--&&(d=ba(b[e[c]],a[e[c]],null,!0)););return d}:function(a){var b=a[f];return g===b&&(0!==g||1/g==1/b)}}function Yb(a){return null==a?"":vc(a).replace(dd,ha)}function Zb(a){return a}function $b(a,b,c){var d=!0,e=b&&ua(b);b&&(c||e.length)||(null==c&&(c=b),f=p,b=a,a=o,e=ua(b)),c===!1?d=!1:Ea(c)&&"chain"in c&&(d=c.chain);var f=a,g=Da(f);Ya(e,function(c){var e=a[c]=b[c];g&&(f.prototype[c]=function(){var b=this.__chain__,c=this.__wrapped__,g=[c];Ic.apply(g,arguments);var h=e.apply(a,g);if(d||b){if(c===h&&Ea(h))return this;h=new f(h),h.__chain__=b}return h})})}function _b(){return c._=zc,this}function ac(){}function bc(a){return function(b){return b[a]}}function cc(a,b,c){var d=null==a,e=null==b;if(null==c&&("boolean"==typeof a&&e?(c=a,a=1):e||"boolean"!=typeof b||(c=b,e=!0)),d&&e&&(b=1),a=+a||0,e?(b=a,a=0):b=+b||0,c||a%1||b%1){var f=Vc();return Tc(a+f*(b-a+parseFloat("1e-"+((f+"").length-1))),b)}return da(a,b)}function dc(a,b){if(a){var c=a[b];return Da(c)?a[b]():c}}function ec(a,b,c){var d=o.templateSettings;a=vc(a||""),c=fd({},c,d);var e,f=fd({},c.imports,d.imports),h=_c(f),i=Ra(f),j=0,k=c.interpolate||D,l="__p += '",m=uc((c.escape||D).source+"|"+k.source+"|"+(k===B?y:D).source+"|"+(c.evaluate||D).source+"|$","g");a.replace(m,function(b,c,d,f,h,i){return d||(d=f),l+=a.slice(j,i).replace(F,g),c&&(l+="' +\n__e("+c+") +\n'"),h&&(e=!0,l+="';\n"+h+";\n__p += '"),d&&(l+="' +\n((__t = ("+d+")) == null ? '' : __t) +\n'"),j=i+b.length,b}),l+="';\n";var p=c.variable,q=p;q||(p="obj",l="with ("+p+") {\n"+l+"\n}\n"),l=(e?l.replace(v,""):l).replace(w,"$1").replace(x,"$1;"),l="function("+p+") {\n"+(q?"":p+" || ("+p+" = {});\n")+"var __t, __p = '', __e = _.escape"+(e?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+l+"return __p\n}";var r="\n/*\n//# sourceURL="+(c.sourceURL||"/lodash/template/source["+H++ +"]")+"\n*/";try{var s=qc(h,"return "+l+r).apply(n,i)}catch(t){throw t.source=l,t}return b?s(b):(s.source=l,s)}function fc(a,b,c){a=(a=+a)>-1?a:0;var d=-1,e=nc(a);for(b=Y(b,c,1);++d<a;)e[d]=b(d);return e}function gc(a){return null==a?"":vc(a).replace(cd,la)}function hc(a){var b=++q;return vc(null==a?"":a)+b}function ic(a){return a=new p(a),a.__chain__=!0,a}function jc(a,b){return b(a),a}function kc(){return this.__chain__=!0,this}function lc(){return vc(this.__wrapped__)}function mc(){return this.__wrapped__}c=c?_.defaults(W.Object(),c,_.pick(W,G)):W;var nc=c.Array,oc=c.Boolean,pc=c.Date,qc=c.Function,rc=c.Math,sc=c.Number,tc=c.Object,uc=c.RegExp,vc=c.String,wc=c.TypeError,xc=[],yc=tc.prototype,zc=c._,Ac=yc.toString,Bc=uc("^"+vc(Ac).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Cc=rc.ceil,Dc=c.clearTimeout,Ec=rc.floor,Fc=qc.prototype.toString,Gc=ja(Gc=tc.getPrototypeOf)&&Gc,Hc=yc.hasOwnProperty,Ic=xc.push,Jc=c.setTimeout,Kc=xc.splice,Lc=xc.unshift,Mc=function(){try{var a={},b=ja(b=tc.defineProperty)&&b,c=b(a,a,a)&&b}catch(d){}return c}(),Nc=ja(Nc=tc.create)&&Nc,Oc=ja(Oc=nc.isArray)&&Oc,Pc=c.isFinite,Qc=c.isNaN,Rc=ja(Rc=tc.keys)&&Rc,Sc=rc.max,Tc=rc.min,Uc=c.parseInt,Vc=rc.random,Wc={};Wc[J]=nc,Wc[K]=oc,Wc[L]=pc,Wc[M]=qc,Wc[O]=tc,Wc[N]=sc,Wc[P]=uc,Wc[Q]=vc,p.prototype=o.prototype;var Xc=o.support={};Xc.funcDecomp=!ja(c.WinRTError)&&E.test(m),Xc.funcNames="string"==typeof qc.name,o.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:B,variable:"",imports:{_:o}},Nc||(X=function(){function a(){}return function(b){if(Ea(b)){a.prototype=b;var d=new a;a.prototype=null}return d||c.Object()}}());var Yc=Mc?function(a,b){T.value=b,Mc(a,"__bindData__",T),T.value=null}:ac,Zc=Oc||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ac.call(a)==J||!1},$c=function(a){var b,c=a,d=[];if(!c)return d;if(!U[typeof a])return d;for(b in c)Hc.call(c,b)&&d.push(b);return d},_c=Rc?function(a){return Ea(a)?Rc(a):[]}:$c,ad={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},bd=wa(ad),cd=uc("("+_c(bd).join("|")+")","g"),dd=uc("["+_c(ad).join("")+"]","g"),ed=function(a,b,c){var d,e=a,f=e;if(!e)return f;var g=arguments,h=0,i="number"==typeof c?2:g.length;if(i>3&&"function"==typeof g[i-2])var j=Y(g[--i-1],g[i--],2);else i>2&&"function"==typeof g[i-1]&&(j=g[--i]);for(;++h<i;)if(e=g[h],e&&U[typeof e])for(var k=-1,l=U[typeof e]&&_c(e),m=l?l.length:0;++k<m;)d=l[k],f[d]=j?j(f[d],e[d]):e[d];return f},fd=function(a,b,c){var d,e=a,f=e;if(!e)return f;for(var g=arguments,h=0,i="number"==typeof c?2:g.length;++h<i;)if(e=g[h],e&&U[typeof e])for(var j=-1,k=U[typeof e]&&_c(e),l=k?k.length:0;++j<l;)d=k[j],"undefined"==typeof f[d]&&(f[d]=e[d]);return f},gd=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!U[typeof e])return f;b=b&&"undefined"==typeof c?b:Y(b,c,3);for(d in e)if(b(e[d],d,a)===!1)return f;return f},hd=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!U[typeof e])return f;b=b&&"undefined"==typeof c?b:Y(b,c,3);for(var g=-1,h=U[typeof e]&&_c(e),i=h?h.length:0;++g<i;)if(d=h[g],b(e[d],d,a)===!1)return f;return f},id=Gc?function(a){if(!a||Ac.call(a)!=O)return!1;var b=a.valueOf,c=ja(b)&&(c=Gc(b))&&Gc(c);return c?a==c||Gc(a)==c:ka(a)}:ka,jd=fa(function(a,b,c){Hc.call(a,c)?a[c]++:a[c]=1}),kd=fa(function(a,b,c){(Hc.call(a,c)?a[c]:a[c]=[]).push(b)}),ld=fa(function(a,b,c){a[c]=b}),md=_a,nd=Va,od=ja(od=pc.now)&&od||function(){return(new pc).getTime()},pd=8==Uc(u+"08")?Uc:function(a,b){return Uc(Ja(a)?a.replace(C,""):a,b||0)};return o.after=Hb,o.assign=ed,o.at=Sa,o.bind=Ib,o.bindAll=Jb,o.bindKey=Kb,o.chain=ic,o.compact=lb,o.compose=Lb,o.constant=Wb,o.countBy=jd,o.create=pa,o.createCallback=Xb,o.curry=Mb,o.debounce=Nb,o.defaults=fd,o.defer=Ob,o.delay=Pb,o.difference=mb,o.filter=Va,o.flatten=qb,o.forEach=Ya,o.forEachRight=Za,o.forIn=gd,o.forInRight=sa,o.forOwn=hd,o.forOwnRight=ta,o.functions=ua,o.groupBy=kd,o.indexBy=ld,o.initial=sb,o.intersection=tb,o.invert=wa,o.invoke=$a,o.keys=_c,o.map=_a,o.mapValues=La,o.max=ab,o.memoize=Qb,o.merge=Ma,o.min=bb,o.omit=Na,o.once=Rb,o.pairs=Oa,o.partial=Sb,o.partialRight=Tb,o.pick=Pa,o.pluck=md,o.property=bc,o.pull=wb,o.range=xb,o.reject=eb,o.remove=yb,o.rest=zb,o.shuffle=gb,o.sortBy=jb,o.tap=jc,o.throttle=Ub,o.times=fc,o.toArray=kb,o.transform=Qa,o.union=Bb,o.uniq=Cb,o.values=Ra,o.where=nd,o.without=Db,o.wrap=Vb,o.xor=Eb,o.zip=Fb,o.zipObject=Gb,o.collect=_a,o.drop=zb,o.each=Ya,o.eachRight=Za,o.extend=ed,o.methods=ua,o.object=Gb,o.select=Va,o.tail=zb,o.unique=Cb,o.unzip=Fb,$b(o),o.clone=na,o.cloneDeep=oa,o.contains=Ta,o.escape=Yb,o.every=Ua,o.find=Wa,o.findIndex=nb,o.findKey=qa,o.findLast=Xa,o.findLastIndex=ob,o.findLastKey=ra,o.has=va,o.identity=Zb,o.indexOf=rb,o.isArguments=ma,o.isArray=Zc,o.isBoolean=xa,o.isDate=ya,o.isElement=za,o.isEmpty=Aa,o.isEqual=Ba,o.isFinite=Ca,o.isFunction=Da,o.isNaN=Fa,o.isNull=Ga,o.isNumber=Ha,o.isObject=Ea,o.isPlainObject=id,o.isRegExp=Ia,o.isString=Ja,o.isUndefined=Ka,o.lastIndexOf=vb,o.mixin=$b,o.noConflict=_b,o.noop=ac,o.now=od,o.parseInt=pd,o.random=cc,o.reduce=cb,o.reduceRight=db,o.result=dc,o.runInContext=m,o.size=hb,o.some=ib,o.sortedIndex=Ab,o.template=ec,o.unescape=gc,o.uniqueId=hc,o.all=Ua,o.any=ib,o.detect=Wa,o.findWhere=Wa,o.foldl=cb,o.foldr=db,o.include=Ta,o.inject=cb,$b(function(){var a={};return hd(o,function(b,c){o.prototype[c]||(a[c]=b)}),a}(),!1),o.first=pb,o.last=ub,o.sample=fb,o.take=pb,o.head=pb,hd(o,function(a,b){var c="sample"!==b;o.prototype[b]||(o.prototype[b]=function(b,d){var e=this.__chain__,f=a(this.__wrapped__,b,d);return e||null!=b&&(!d||c&&"function"==typeof b)?new p(f,e):f})}),o.VERSION="2.4.2",o.prototype.chain=kc,o.prototype.toString=lc,o.prototype.value=mc,o.prototype.valueOf=mc,Ya(["join","pop","shift"],function(a){var b=xc[a];o.prototype[a]=function(){var a=this.__chain__,c=b.apply(this.__wrapped__,arguments);return a?new p(c,a):c}}),Ya(["push","reverse","sort","unshift"],function(a){var b=xc[a];o.prototype[a]=function(){return b.apply(this.__wrapped__,arguments),this}}),Ya(["concat","slice","splice"],function(a){var b=xc[a];o.prototype[a]=function(){return new p(b.apply(this.__wrapped__,arguments),this.__chain__)}}),o}var n,o=[],p=[],q=0,r=+new Date+"",s=75,t=40,u=" 	\fÂ \ufeff\n\r\u2028\u2029áá ââââââââââââ¯âã",v=/\b__p \+= '';/g,w=/\b(__p \+=) '' \+/g,x=/(__e\(.*?\)|\b__t\)) \+\n'';/g,y=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,z=/\w*$/,A=/^\s*function[ \n\r\t]+\w/,B=/<%=([\s\S]+?)%>/g,C=RegExp("^["+u+"]*0+(?=.$)"),D=/($^)/,E=/\bthis\b/,F=/['\n\r\t\u2028\u2029\\]/g,G=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],H=0,I="[object Arguments]",J="[object Array]",K="[object Boolean]",L="[object Date]",M="[object Function]",N="[object Number]",O="[object Object]",P="[object RegExp]",Q="[object String]",R={};R[M]=!1,R[I]=R[J]=R[K]=R[L]=R[N]=R[O]=R[P]=R[Q]=!0;var S={leading:!1,maxWait:0,trailing:!1},T={configurable:!1,enumerable:!1,value:null,writable:!1},U={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},V={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},W=U[typeof window]&&window||this,X=U[typeof exports]&&exports&&!exports.nodeType&&exports,Y=U[typeof module]&&module&&!module.nodeType&&module,Z=Y&&Y.exports===X&&X,$=U[typeof global]&&global;!$||$.global!==$&&$.window!==$||(W=$);var _=m();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(W._=_,define(function(){return _})):X&&Y?Z?(Y.exports=_)._=_:X._=_:W._=_}.call(this),function(){"use strict";function a(){}function b(a,b){for(var c=a.length;c--;)if(a[c].listener===b)return c;return-1}function c(a){return function(){return this[a].apply(this,arguments)}}var d=a.prototype,e=this,f=e.EventEmitter;d.getListeners=function(a){var b,c,d=this._getEvents();if(a instanceof RegExp){b={};for(c in d)d.hasOwnProperty(c)&&a.test(c)&&(b[c]=d[c])}else b=d[a]||(d[a]=[]);return b},d.flattenListeners=function(a){var b,c=[];for(b=0;b<a.length;b+=1)c.push(a[b].listener);return c},d.getListenersAsObject=function(a){var b,c=this.getListeners(a);return c instanceof Array&&(b={},b[a]=c),b||c},d.addListener=function(a,c){var d,e=this.getListenersAsObject(a),f="object"==typeof c;for(d in e)e.hasOwnProperty(d)&&-1===b(e[d],c)&&e[d].push(f?c:{listener:c,once:!1
});return this},d.on=c("addListener"),d.addOnceListener=function(a,b){return this.addListener(a,{listener:b,once:!0})},d.once=c("addOnceListener"),d.defineEvent=function(a){return this.getListeners(a),this},d.defineEvents=function(a){for(var b=0;b<a.length;b+=1)this.defineEvent(a[b]);return this},d.removeListener=function(a,c){var d,e,f=this.getListenersAsObject(a);for(e in f)f.hasOwnProperty(e)&&(d=b(f[e],c),-1!==d&&f[e].splice(d,1));return this},d.off=c("removeListener"),d.addListeners=function(a,b){return this.manipulateListeners(!1,a,b)},d.removeListeners=function(a,b){return this.manipulateListeners(!0,a,b)},d.manipulateListeners=function(a,b,c){var d,e,f=a?this.removeListener:this.addListener,g=a?this.removeListeners:this.addListeners;if("object"!=typeof b||b instanceof RegExp)for(d=c.length;d--;)f.call(this,b,c[d]);else for(d in b)b.hasOwnProperty(d)&&(e=b[d])&&("function"==typeof e?f.call(this,d,e):g.call(this,d,e));return this},d.removeEvent=function(a){var b,c=typeof a,d=this._getEvents();if("string"===c)delete d[a];else if(a instanceof RegExp)for(b in d)d.hasOwnProperty(b)&&a.test(b)&&delete d[b];else delete this._events;return this},d.removeAllListeners=c("removeEvent"),d.emitEvent=function(a,b){var c,d,e,f,g=this.getListenersAsObject(a);for(e in g)if(g.hasOwnProperty(e))for(d=g[e].length;d--;)c=g[e][d],c.once===!0&&this.removeListener(a,c.listener),f=c.listener.apply(this,b||[]),f===this._getOnceReturnValue()&&this.removeListener(a,c.listener);return this},d.trigger=c("emitEvent"),d.emit=function(a){var b=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,b)},d.setOnceReturnValue=function(a){return this._onceReturnValue=a,this},d._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},d._getEvents=function(){return this._events||(this._events={})},a.noConflict=function(){return e.EventEmitter=f,a},"function"==typeof define&&define.amd?define(function(){return a}):"object"==typeof module&&module.exports?module.exports=a:e.EventEmitter=a}.call(this),function(){Object.create=Object.create||function(a){function b(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter.");return b.prototype=a,new b},Object.getPrototypeOf=Object.getPrototypeOf||function(a){return a.proto||a.constructor.prototype},Function.prototype.bind=Function.prototype.bind||function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}}(),function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.Proto=b()}(this,function(){return{create:function(){var a=Object.create(this),b="string"==typeof a.__init?a.__init:"init";return"function"==typeof a[b]&&a[b].apply(a,arguments),a},mixin:function(a,b){var c,d=b||this,e=/\b_super\b/,f=Object.getPrototypeOf(d)||d.prototype;for(var g in a)c=d[g],d[g]="function"==typeof a[g]&&"function"==typeof f[g]&&e.test(a[g])||"function"==typeof c&&"function"==typeof a[g]?function(a,b,c){return function(){var d=this._super;this._super="function"==typeof a?a:f[b];var e=c.apply(this,arguments);return this._super=d,e}}(c,g,a[g]):a[g];return d},extend:function(a,b){return this.mixin(a,Object.create(b||this))},proxy:function(a){var b=this[a],c=Array.prototype.slice.call(arguments,1);return c.unshift(this),b.bind.apply(b,c)}}}),PathAnimator.prototype={start:function(a,b){if(this.stop(),a=a||this.settings.startPercent||0,this.percent=a,0===this.settings.duration)return!1;var c=this,d=new Date,b=b||100,e=0;!function f(){var g,h,i=[],j=new Date,k=(j-d)/1e3,l=k/c.settings.duration;return 0===e&&(e=l),"function"==typeof c.settings.easing&&(l=c.settings.easing(l)),h=a+l*(b-a),c.settings.reverse&&("start"===c.settings.easing&&(l+=e),h=a-l*(b-a),a=0,0>h&&(h=b+h)),c.running=!0,h>b&&(h=b),c.percent=h,i[0]=c.pointAt(c.percent-1),i[1]=c.pointAt(c.percent+1),g=180*Math.atan2(i[1].y-i[0].y,i[1].x-i[0].x)/Math.PI,l>.999?(c.settings.step(c.pointAt(c.percent),g),c.stop(),c.percent=b,c.settings.onDone()):(c.timer=setTimeout(f,c.settings.fps),void c.settings.step(c.pointAt(c.percent),g))}()},stop:function(){clearTimeout(this.timer),this.timer=null,this.running=!1},stopAt:function(a){},pointAt:function(a){return this.path.getPointAtLength(this.len*a/100)},updatePath:function(a){return!this.path&&a&&(this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.setAttribute("d",a)),this.path.getTotalLength()}},this.PR=this.PR||{},this.PR.Templates=this.PR.Templates||{},this.PR.Templates.modal=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div id="modalPopup" class="hiddenPopup">\r\n    <div class="modalBackdrop"></div>\r\n</div>\r\n';return __p},function(a){"use strict";a.PR||(a.PR={})}(this),PR.utils={getEventPosition:function(a){return a||(a=window.event),a.changedTouches?[a.changedTouches[0].clientX,a.changedTouches[0].clientY]:[a.clientX,a.clientY]},getMetaValueByProperty:function(a){var b=_.find(document.getElementsByTagName("meta"),function(b){try{if(b.getAttribute("property")===a||b.getAttribute("name")===a)return b}catch(c){}});return b?b.getAttribute("content"):""},getInternetExplorerVersion:function(){var a,b,c=-1;return"Microsoft Internet Explorer"===navigator.appName?(a=navigator.userAgent,b=new RegExp("MSIE ([0-9]{1,}[\\.0-9]{0,})"),null!==b.exec(a)&&(c=parseFloat(RegExp.$1))):"Netscape"===navigator.appName&&(a=navigator.userAgent,b=new RegExp("Trident/.*rv:([0-9]{1,}[\\.0-9]{0,})"),null!==b.exec(a)?c=parseFloat(RegExp.$1):null!==new RegExp("Edge/(.*)").exec(a)&&(c=parseFloat(RegExp.$1))),c},getChromeVersion:function(){var a=navigator.userAgent,b=new RegExp("Chrome/([0-9]+)"),c=b.exec(a);return c?parseInt(c[1],10):-1},within:function(a,b,c,d){return d="undefined"==typeof d?!0:d,b>c&&(c=[b,b=c][0]),d?a>=b&&c>=a:a>b&&c>a},removeChildAction:function(a,b){for(var c=0;c<=a.length-1;c+=1){var d=a[c];if(d===b||!d.hasOwnProperty("getAttribute"))return;d.getAttribute("onclick")&&(d.setAttribute("pr-onclick",d.getAttribute("onclick")),d.removeAttribute("onclick"))}},returnAncestorsAndSelf:function(a,b){3===a.nodeType&&(a=a.parentNode);for(var c=[a];a.parentNode;)a=a.parentNode,a!==b&&c.push(a);return c},addClass:function(a,b){if(!a)throw new Error("DOM element not specified");if("string"!=typeof b&&"object"!=typeof b)throw new Error("CSS class not specified to add to the DOM element.");if(1!==a.nodeType)throw new Error("Specified element is not a DOM element to removeClass.");"string"==typeof b&&(b=b.split(" "));for(var c=0;c<b.length;c+=1){var d=a.className;-1===d.indexOf(b[c])&&(""!==d&&(b[c]=" "+b[c]),a.className=d+b[c])}return a.className},removeClass:function(a,b){var c="",d="",e=0;if(!a)throw new Error("DOM element not specified");if("string"!=typeof b&&"object"!=typeof b)throw new Error("CSS class not specified to add to the DOM element.");if(1!==a.nodeType)throw new Error("Specified element is not a DOM element to removeClass.");for("string"==typeof b&&(b=b.split(" ")),c=a.className,e=0;e<b.length;e+=1)d=new RegExp("\\s?\\b"+b[e]+"\\b(?![\\w-])","g"),c=c.replace(d,"");return a.className=c,a.className},addStyle:function(a,b){if(!b||"object"!=typeof b)throw new Error("PR.utils.addStyle -- param is required to be an object");_.each(b,function(b,c){a.style[c]=b})},removeStyle:function(a,b){switch(typeof b){case"object":_.each(b,function(c,d){a.style[b instanceof Array?c:d]=""});break;case"string":a.style[b]="";break;default:throw new Error("PR.utils.addStyle -- param is required to be an object")}},validateIsWebLink:function(a){return a.match(/^http.*:/)?!0:!1},lineDistance:function(a,b,c,d){var e=0,f=0;return e=c-a,e*=e,f=d-b,f*=f,Math.sqrt(e+f)},getScreenDimensions:function(){return[window.innerWidth,window.innerHeight]},getReaderScreenDimensions:function(){return[parent.window.innerWidth,parent.window.innerHeight]},_createBackgroundModal:function(){var a=document.createElement("div"),b=PR.utils.getScreenDimensions();return a.style.width=b[0]+"px",a.style.height=b[1]+"px",a.style.top=0,a.style.left=0,a.setAttribute("class","modalBackgroundClass"),a.style.backgroundColor="RGBA(0,0,0,0.6)",a.style.opacity="1",a.style.display="block",a.style.position="fixed",a},getPageDimensions:function(a){var b=a.querySelectorAll(".page");return b?[b[0].offsetWidth,b[0].offsetHeight]:null},generateRandomId:function(){return"u"+Math.random().toString(36).substr(2,5)},createDataset:function(a){function b(a,b){return b.replace(b,b.toUpperCase())}function c(a){return/^(true|yes)$/gi.test(a)?!0:/^(false|no)$/gi.test(a)?!1:/^[-]?\d*([\.]?\d)*$/g.test(a)?Number(a):a}var d={},e=0;return e+=this.readDataset(a,d,b,c),e>0?d:null},readDataset:function(a,b,c,d){for(var e=0,f=0;f<a.attributes.length;f+=1){var g=a.attributes[f];if(-1!==g.name.indexOf("data")){var h=g.name.slice(5).replace(/-(.)/g,c);b[h]=""===g.value?!0:d(g.value),e+=1}}if(e>0&&a.childNodes.length>0)for(var i=0,j=a.childNodes.length;j>i;i+=1){var k=a.childNodes[i];try{k.nodeType===k.ELEMENT_NODE&&(e+=this.readDataset(k,b,c,d))}catch(l){}}return e},createElement:function(a,b){var c,d={};return _.extend(d,{root:!1},b),c=document.createElement(d.root||"div"),c.innerHTML=a,d.root?c:c.firstChild},checkRadioSubscription:function(a,b){var c,d=[],e=0;if(radio.$.channels.PLAY_MEDIA&&(e=radio.$.channels.PLAY_MEDIA.length)){d=radio.$.channels[a];for(var f=0;e>f;f+=1)if(c=d[f][1].id,c===b)return!0}return!1},loadScript:function(a,b){var c=document.createElement("script");c.onload=function(){"function"==typeof b&&b()},c.type="text/javascript",c.async=!0,c.src=a,document.head.appendChild(c)},loadAsset:function(a,b){if("function"!=typeof b.error)throw new Error("No Error Callback for WidgetHelper");if("function"!=typeof b.success)throw new Error("No Success Callback for WidgetHelper");return 0===a.indexOf("data:")?b.success(a):PR.Core.CURRENT_APP_FRAMEWORK!==PR.Core.AppFrameworks.DESKTOP||PR.Core.isOnline===!0?b.success(a):void this.fetchAsset(a,b)},fetchAsset:function(a,b){b.success(a)},pageContainsWidget:function(a){return PR.utils.containsWidget(document,a)},containsWidget:function(a,b){return!!a.querySelector("[data-widget='"+b+"']")},hasAncestorWidgetPopup:function(a){return this.hasAncestorWidget(a,"POPUP")},hasAncestorWidget:function(a,b){for(a=a.parentElement;a;){if(a.getAttribute("data-widget")===b)return!0;a=a.parentElement}return!1},positionElement3d:function(a,b){var c={};if(!b)throw new Error("Invoking PR.utils.positionElement3d without valid destination");if(!a)throw new Error("Specify element to move");c[PR.Core.prefix.js.transform]="translate3d( "+(b.x||0)+"px, "+(b.y||0)+"px, "+(b.z||0)+"px )",PR.utils.addStyle(a,c)},positionElement2d:function(a,b){if(!b)throw new Error("Invoking PR.utils.positionElement3d without valid destination");if(!a)throw new Error("Specify element to move");PR.utils.addStyle(a,{left:b.x+"px",top:b.y+"px"})},encodeURI:function(a){return PR.Core.isFeaturesCalled&&(a=encodeURI(a)),a},encodeURIComponent:function(a){return PR.Core.isFeaturesCalled&&(a=encodeURIComponent(a)),a},isWindowsTablet:function(){return-1!==navigator.userAgent.indexOf("Windows")},isChromeTouch:function(){return null!==window.chrome&&"ontouchstart"in window},getStartingStyles:function(a){var b=window.getComputedStyle(a.el);a.startingOpacity=b.opacity||"",a.startingScale=PR.utils.getScale(b[_.find(b,function(a){return/^-webkit-transform$|^-moz-transform$|^transform$/i.test(a)})])},getEasingEquation:function(a,b,c,d,e){var f=function(b){var d=1-b;return 3*d*d*b*a+3*d*b*b*c+b*b*b},g=function(a){var c=1-a;return 3*c*c*a*b+3*c*a*a*d+a*a*a};return function(a){var b,c=a,d=0,h=1,i=c;if(d>i)return g(d);if(i>h)return g(h);for(;h>d;){if(b=f(i),Math.abs(b-c)<e)return g(i);c>b?d=i:h=i,i=.5*(h-d)+d}return g(i)}},getScale:function(a){if(!a||"none"===a)return{x:1,y:1};try{var b=PR.utils.getCSSMatrix(a);return{x:b.a,y:b.d}}catch(c){var b=a.match(/\(([^)]+)\)/)[1].split(",");return 16===b.length?{x:parseFloat(b[0],10),y:parseFloat(b[5],10)}:{x:parseFloat(b[0],10),y:parseFloat(b[3],10)}}},getCSSMatrix:function(a){return window.WebKitCSSMatrix&&new window.WebKitCSSMatrix(a)||window.MozCSSMatrix&&new window.MozCSSMatrix(a)||window.MSCSSMatrix&&new window.MSCSSMatrix(a)||window.OCSSMatrix&&new window.OCSSMatrix(a)||window.CSSMatrix&&new window.CSSMatrix(a)}},function(a){a.Bridge={isAnimating:!1,navigateToElement:function(b,c){var d=document.getElementById(b);d&&(isNaN(c)&&(c=1),window.scrollTo(0,a.Core.cumulativeOffset(d).top*c))},animateToElement:function(b,c){function d(a){return.5*(1-Math.cos(Math.PI*a))}function e(){var b;return h===m?void(a.Bridge.isAnimating=!1):(a.Bridge.isAnimating=!0,h+=1,b=h/m,window.scrollTo(0,j+k*d(b)),void window.requestAnimFrame(e))}if(!a.Bridge.isAnimating){var f=document.getElementById(b);if(f){var g={duration:500},h=0,i=a.Core.cumulativeOffset(f).top,j=window.scrollY||window.pageYOffset||document.body.scrollTop,k=i-j,l=_.extend({},g,c),m=Math.ceil(l.duration/(1e3/60));window.requestAnimFrame(e)}}}}}(PR),function(a){var b=function(a,b,c){return{id:a,stack:b,widgets:c,top:0,percentage:0}},c=85,d=100,e="DEBOUNCE_SCROLL",f=_.debounce(function(){radio(e).broadcast(document.body.scrollTop)},d,{leading:!1});a.StackController={enabled:!1,hasStacks:!1,initialized:!1,stacks:{},currentPageStack:null,init:function(){if(!this.initialized){var b="[data-stack-id]",c=[].slice.call(document.querySelectorAll(b));try{if(c[0].clientHeight<a.utils.getScreenDimensions()[1]/2)return void a.log("PR.StackController Disabled :: Screen Height is over double of single page stack element ")}catch(d){return}this.stacks=this.registerStacks(c),this.setPageStackByVisibility(),_.isEmpty(this.stacks)||(this.hasStacks=!0,radio(a.Event.STACK_CONTROLLER_ON_SCREEN).subscribe([this.enable,this])),this.initialized=!0}},enable:function(){this.enabled||(this.enabled=!0,radio(a.Event.STACK_CONTROLLER_ON_SCREEN).unsubscribe([this.enable,this]),radio(a.Event.ON_SCROLL).subscribe(f),radio(e).subscribe([this.onDebounceScroll,this]),this.enablePageStack())},disable:function(){this.enabled&&(this.enabled=!1,radio(a.Event.ON_SCROLL).unsubscribe(f),radio(e).unsubscribe([this.onDebounceScroll,this]),radio(a.Event.PAGE_ON_SCREEN).unsubscribe([this.enablePageStack,this]),radio(a.Event.PAGE_OFF_SCREEN).subscribe([this.disablePageStack,this]),this.disableAllPageStacks())},enablePageStack:function(b){a.log(b+" :: Enable Page Stack"),b=b?b:this.getCurrentPageStack(),radio(a.Event.STACK_ON_SCREEN).broadcast(b)},disablePageStack:function(b){b=b?b:this.getCurrentPageStack(),radio(a.Event.STACK_OFF_SCREEN).broadcast(b)},setPageStackByVisibility:function(a){var b=[];_.each(this.stacks,function(a){var c=this.isVisibleStack(a);c&&b.push(c)}.bind(this)),b=_(b).chain().sortBy("top").reverse().sortBy("percentage").reverse().value(),(b.length>0&&b[0].percentage>c||null===this.getCurrentPageStack()||1===b.length)&&this.setCurrentPageStack(b[0].id)},setCurrentPageStack:function(a){a!==this.getCurrentPageStack()&&this.disablePageStack(this.getCurrentPageStack()),this.currentPageStack=a},getCurrentPageStack:function(){return this.currentPageStack},enableAllPageStacks:function(){_.each(this.stacks,function(b){radio(a.Event.STACK_ON_SCREEN).broadcast(b.id)})},disableAllPageStacks:function(){_.each(this.stacks,function(b){radio(a.Event.STACK_OFF_SCREEN).broadcast(b.id)})},onDebounceScroll:function(){this.setPageStackByVisibility(),this.enablePageStack()},registerStacks:function(c){var d={};return _.each(c,function(c){for(var e=c.querySelectorAll("[data-widget]"),f=0;f<e.length;f+=1){var g=e[f].getAttribute("id"),h=a.Core.getWidgetById(g);h&&h.setStackContainer(c.dataset.stackId)}d[c.dataset.stackId]=new b(c.dataset.stackId,c,e)}.bind(this)),d},isVisibleStack:function(b){var c=b.stack,d=a.Core.cumulativeOffset(c).top,e=c.clientHeight,f=document.body.scrollTop,g=a.utils.getScreenDimensions()[1],h=0;return f>d?h=d-f+e:d>=f&&g>d+e-f?h=e:d>=f&&g+f>d&&(h=g-(d-f)),h>0?(_.extend(b,{percentage:Math.round(h/e*100),top:d}),b):(b.percentage=0,!1)}}}(PR),PR.TRANSITION_EFFECTS={FADE:"FADE",SLIDE:"SLIDE",FLIP:"FLIP",NONE:"NONE"},PR.TIMING_FUNCTION={LINEAR:"linear",EASE:"ease",EASE_IN:"ease-in",EASE_OUT:"ease-out",EASE_IN_OUT:"ease-in-out",STEP_START:"step-start",STEP_END:"step-end"},PR.ANIMATION_EFFECTS={APPEAR:"APPEAR",DISAPPEAR:"DISAPPEAR",FADE_IN:"FADE_IN",FADE_OUT:"FADE_OUT",ZOOM_IN:"ZOOM_IN",ZOOM_OUT:"ZOOM_OUT",GROW:"GROW",SHRINK:"SHRINK",ROTATE_CLOCKWISE:"ROTATE_CLOCKWISE",ROTATE_ANTICLOCKWISE:"ROTATE_ANTICLOCKWISE",FLY_IN:"FLY_IN",FLY_OUT:"FLY_OUT",PATH:"PATH"},PR.ANIMATION_DIRECTION={LEFT:"LEFT",RIGHT:"RIGHT",TOP:"TOP",BOTTOM:"BOTTOM",LTR:"LTR",RTL:"RTL"},PR.Event={PAGE_ON_SCREEN:"OnScreenEvent",PAGE_OFF_SCREEN:"OffScreenEvent",STACK_CONTROLLER_ON_SCREEN:"StackControllerOnScreen",STACK_ON_SCREEN:"StackOnScreen",STACK_OFF_SCREEN:"StackOffScreen",ELEMENT_VISIBLE:"ElementVisible",ELEMENT_NOT_VISIBLE:"ElementNotVisible",PR_INITIALIZED:"prInitialized",APP_SCROLL_EVENT:"appScrollEvent",REASSIGN_EVENT:"reassignEvent",ONLINE_EVENT:"onlineEvent",APP_NOTIFY_EVENT:"appNotifyEvent",ENABLE_GPU:"ENABLE_GPU",DISABLE_GPU:"DISABLE_GPU",ON_ORIENTATION_CHANGE:"ON_ORIENTATION_CHANGE",ON_RESIZE:"ON_RESIZE",ON_SCROLL:"ON_SCROLL",ON_ZOOM:"ON_ZOOM",OPEN_FILE:"OPEN_FILE",ISSUE_SCREEN:"ISSUE_SCREEN",TAKE_SCREENSHOT:"TAKE_SCREENSHOT",RESET_PAGE:"RESET_PAGE",SAVE_STATE:"SAVE_STATE",LOAD_STATE:"LOAD_STATE",NAVIGATE_NEXT_PAGE:"NAVIGATE_NEXT_PAGE",NAVIGATE_PREVIOUS_PAGE:"NAVIGATE_PREVIOUS_PAGE",NAVIGATE_TO_PAGE:"NAVIGATE_TO_PAGE",NAVIGATE_TO_ARTICLE:"NAVIGATE_TO_ARTICLE",NAVIGATE_TO_URL:"NAVIGATE_TO_URL",COLORING_EVENT:"coloringEvent",GEOLOCATION:"geoLocationEvent",TOGGLE_POPUP:"TOGGLE_POPUP",SHOW_POPUP:"SHOW_POPUP",HIDE_POPUP:"HIDE_POPUP",STOP_MEDIA:"STOP_MEDIA",PLAY_MEDIA:"PLAY_MEDIA",PAUSE_MEDIA:"PAUSE_MEDIA",TOGGLE_MEDIA:"TOGGLE_MEDIA",PLAY_ANIMATION:"PLAY_ANIMATION",ZOOMABLE_IMAGE:"ZOOMABLE_IMAGE",NEXT_SLIDE:"NEXT_SLIDE",PREVIOUS_SLIDE:"PREVIOUS_SLIDE",GO_TO_SLIDE:"GO_TO_SLIDE",PAGE_FLIP:"PAGE_FLIP",HIGHLIGHT_ALL:"HIGHLIGHT_ALL",UNHIGHLIGHT_ALL:"UNHIGHLIGHT_ALL"},PR.INTERACTION_EVENTS={INTERACTION_START:"ontouchstart"in window?"touchstart":"mousedown",INTERACTION_MOVE:"ontouchstart"in window?"touchmove":"mousemove",INTERACTION_END:"ontouchstart"in window?"touchend":"mouseup"},PR.INTERACTION_EVENTS_CHROME_WIN_TOUCH={INTERACTION_START:"onmousedown"in window?"mousedown":"touchstart",INTERACTION_MOVE:"onmousemove"in window?"mousemove":"touchmove",INTERACTION_END:"onmouseup"in window?"mouseup":"touchend"},PR.ANIMATION_EVENTS={ANIMATION_START:"animationstart",ANIMATION_END:"animationend"},PR.WIDGET_EVENTS={FLIP_END:"flipEnd",FLIP_START:"flipStart",SLIDE_SELECT_EVENT:"slideSelectEvent",PREVIOUS:-1,NEXT:1},function(a,b,c){b.Highlight||(b.Highlight=c(b))}(this,this.PR||{},function(a){function b(a){return"boolean"==typeof a?a:!a.collapsed}function c(){try{return document.getSelection().getRangeAt(0)}catch(a){h(a,"Error getting selection -- ")}return!1}function d(b,c){var d,g;d=o(b.commonAncestorContainer).then(function(a){return n(a,b.startContainer,b.endContainer)});var h=f;if(g={},g[MODE.HIGHLIGHT]=function(){e(d,b.startOffset,b.endOffset)},g[MODE.UNHIGHLIGHT]=function(){a.log("Unhighlighting");var c=u.checkHighlight(d);return d.length>c.length?void _.each(c,function(a,d){h(a,0===d?b.startOffset:0,d===c.length-1?b.endOffset:a.content.length)}):p(c)?void f(c[0],b.startOffset,b.endOffset):void 0},_.isFunction(g[c]))return g[c](),u.manageHighlights(),!0;throw new Error("Highlight mode not supported")}function e(b,c,d){a.log("Highlighting Selection"),_.each(b,function(a,e){a.data.match(/\S/)&&(u.getFromContent(a)||(u.add(new v(0===e?c:0,e===b.length-1?d:a.length)),u.getCurrent().addTextNode(a),g(a,0===e?c:0,e===b.length-1?d:a.length)))},this)}function f(a,b,c){var d=a.split(b,c);a.getElement().parentElement.replaceChild(d,a.getElement()),u.remove(a)}function g(a,b,c){function d(){var d=a.data.substring(b,c);return{left:0===b?!1:!a.data[b-1].match(/\s|\W/),right:c===a.data.length?!1:!a.data[c].match(/\s|\W/),bufferLeft:!!d.match(/^\s/),bufferRight:!!d.match(/\s$/)}}a.parentElement.replaceChild(l([document.createTextNode(k(a,0,b)),m(k(a,b,c),{partial:d()}),document.createTextNode(k(a,c,a.length))]),a)}function h(b,c){a.log(c||"Highlighting error",a.log.ERROR),a.log("  [ "+b.name+" ] "+b.message)}function i(a){return a.match(/^\#/)&&(a.length-1)%3<=0&&!a.match(/[g-zG-Z]/g)}function j(a){}function k(a,b,c){return a.data.substring(b,c)}function l(a){var b=document.createDocumentFragment();return _.each(a,function(a){b.appendChild(a)}),b}function m(a,b){return u.getCurrent().createElement().addContent(a).addStyle(t.get()).partial(b&&b.partial).getElement()}function n(a,b,c){var d=!1;return b===c?[b]:_.filter(_.map(a,function(a){return a===b&&(d=!0),a===c?(d=!1,a):d?a:void 0}),function(a){return"undefined"!=typeof a})}function o(a){var b=[],c={then:function(a){return a(b)}},d=document.createTreeWalker(a,NodeFilter.SHOW_TEXT);if(d.root.children)for(;d.nextNode();)b.push(d.currentNode);else b.push(d.currentNode);return c}function p(a){if(a.length<=1)return!0;for(var b=0,c=a[b].el,d=!0,e=null;b<a.length-1;)b+=1,e=c.parentElement.textContent===c.textContent?c.parentElement.nextElementSibling:c.nextElementSibling,e!==a[b].el&&(d=!1),c=a[b].el;return d}function q(a,b){function c(a){a.data.indexOf(e)>=0&&(a.data===f||a.parentElement.textContent===f)&&d.push(a)}var d=[],e=b.content,f=b.textNodeContent,g=document.createTreeWalker(a,NodeFilter.SHOW_TEXT);if(g.root.children)for(;g.nextNode();)c(g.currentNode);else c(g.currentNode);return d}var r=null,s=!1,t=function(){var a={css:null,color:null,cssClass:"PR_highlight"},b=_.clone(a);return{set:function(c){return _.isObject(c)?(_.extend(b,a,c),this):_.isString(c)?(i(c)&&(b.color=c),this):this},get:function(){return b},reset:function(){b=_.clone(a)}}}(),u=function(){var b=[],c=null;return{add:function(a){return b.push(a),c=a,this},remove:function(a){return _.pull(b,a),c=null,this},getFromContent:function(a){return _.find(b,function(b){return b.content===a})},length:function(){return b.length},getCurrent:function(){return c},checkHighlight:function(a){var c=[];return _.each(b,function(b){_.each(a,function(a){a===b.getTextNode()&&c.push(b)})}),c},manageHighlights:function(){return _.each(b,function(a){return a?a.el.parentElement&&a.content.length?void(1!==a.getElement().childNodes.length&&a.flatten()):void this.remove(a):void 0},this),this},toJSON:function(){var a=[];return _.each(b,function(b){a.push(b.toJSON())}),JSON.stringify(a)},log:function(){_.each(b,function(b){a.log(b)})}}}();Object.defineProperty(this,"MODE",{value:Object.create(Object.prototype,{HIGHLIGHT:{value:0},UNHIGHLIGHT:{value:1}})});var v=function(a,b){this.startOffset=a,this.endOffset=b,this.el=null,this.textNode=null,this.content="",this.options=""};return v.prototype.createElement=function(a){var b={type:function(a){this.el=document.createElement(a)},content:function(){this.addContent()},styles:function(a){this.addStyle(a)}};return _(_.extend({type:"span"},a)).each(function(a,c){c&&_.isFunction(b[c])&&b[c].call(this,a)},this),this},v.prototype.addTextNode=function(a){this.textNode=a},v.prototype.addContent=function(a){return this.el.innerHTML=a,this.content=a,this},v.prototype.addStyle=function(b){var c;return this.options=b,a.utils.addClass(this.el,b.cssClass),b.color&&(this.el.style.background=b.color),b.css&&_.each(b.css.split(";"),function(a){c=a.split(":"),_.has(this.el.style,c[0])&&(this.el.style[c[0]]=c[1])},this),this},v.prototype.partial=function(a){var b={left:function(){this.el.style.paddingLeft=0},right:function(){this.el.style.paddingRight=0}};return _.each(a,function(a,c){a&&_.isFunction(b[c])&&b[c].call(this)},this),this},v.prototype.flatten=function(){var a="";_.each(this.getElement().childNodes,function(b){a+=""===b.data||b.data?b.data:b.innerHTML}),this.el.innerHTML=a},v.prototype.updatePosition=function(){this.startOffset=this.el.parentElement.innerText.indexOf(this.el.outerText),this.endOffset=this.startOffset+this.content.length},v.prototype.split=function(a,b){var c=(this.el.childNodes[0].data,this.el.childNodes[0]),d=[this.startOffset,this.endOffset];return l([function(){return u.add(new v(0+d[0],a+d[0])),u.getCurrent().addTextNode(c),m(k(c,0,a))}(),document.createTextNode(k(c,a,b)),function(){return u.add(new v(b-a,c.length-a)),u.getCurrent().addTextNode(c),m(k(c,b,c.length))}()])},v.prototype.getElement=function(){return this.el||null},v.prototype.getTextNode=function(){return this.el.childNodes.length>1&&a.log("Highlights contains more than one text node",a.log.WARN),this.el.childNodes[0]},v.prototype.toJSON=function(){return JSON.stringify({parent:this.el.parentElement.id||null,textNodeContent:this.textNode.data,content:this.content,options:this.options,startOffset:this.startOffset,endOffset:this.endOffset})},{highlight:function(e,f){if(JSON.parse(a.Core.getFeatures()).enableHighlight){if(s=!!f,r=c(),t.set(e),!b(r))return a.log("No current selection"),!1;s&&j(r);try{d(r,MODE.HIGHLIGHT)}catch(g){h(g,"Error performing selection -- ")}return t.reset(),radio(a.Event.SAVE_STATE).broadcast(this.saveHighlight()),r}},unhighlight:function(){if(JSON.parse(a.Core.getFeatures()).enableHighlight){if(r=c(),!b(r))return a.log("No current selection"),!1;try{d(r,MODE.UNHIGHLIGHT)}catch(e){h(e,"Error performing selection -- ")}radio(a.Event.SAVE_STATE).broadcast(this.saveHighlight())}},canHighlight:function(){if(JSON.parse(a.Core.getFeatures()).enableHighlight){if(r=c(),!b(r))return!1;var d=o(r.commonAncestorContainer).then(function(a){return n(a,r.startContainer,r.endContainer)}),e=u.checkHighlight(d);return e.length!==_.filter(d,function(a){return a.length}).length}},saveHighlight:function(){return JSON.parse(a.Core.getFeatures()).enableHighlight?u.toJSON():void 0},log:function(){u.log()},loadHighlight:function(b){if(JSON.parse(a.Core.getFeatures()).enableHighlight&&!u.length()){var c=JSON.parse(b);_.each(c,function(a,b){c[b]=JSON.parse(a)}),_.each(c,function(a){t.set(a.options);try{e(q(document.querySelector("#"+a.parent),a),a.startOffset,a.endOffset)}catch(b){h(b,"Error recreating DOM from loaded data - ")}t.reset()})}}}}),PR.SearchWidget={INVALID_REGEX:/\[|\]|\[\]|\\\\|\||\+|\*|\^|\$|\-|\?|\./,ESCAPE_REGEX:/(\()|(\))/g,EXCLUDED_TAGS:["HTML","HEAD","BODY","SCRIPT","STYLE","LINK","TITLE","META"],HIGHLIGHT_CLASS:"PR_highlight_search",el:null,searchTerm:"",currentNode:null,originalNode:null,fragment:null,regex:null,opts:null,initialize:function(){_.bindAll(this),this.initVars(),this.addEventListeners()},initVars:function(){this.el=null,this.searchTerm="",this.currentNode=null,this.originalNode=null,this.fragment=null,this.regex=null,this.opts={wholeWordOnly:!1}},reset:function(){this.unhighlightAll(),this.initVars()},addEventListeners:function(){radio(PR.Event.HIGHLIGHT_ALL).subscribe([this.highlight,this]),radio(PR.Event.UNHIGHLIGHT_ALL).subscribe([this.unhighlightAll,this]),radio(PR.Event.PAGE_ON_SCREEN).subscribe([this.unhighlightAll,this])},removeEventListeners:function(){radio(PR.Event.HIGHLIGHT_ALL).unsubscribe([this.highlight,this]),radio(PR.Event.UNHIGHLIGHT_ALL).unsubscribe([this.unhighlightAll,this]),radio(PR.Event.PAGE_ON_SCREEN).unsubscribe([this.unhighlightAll,this])},highlight:function(a){return this.reset(),_.isString(a)?(this.highlightStr(a),!0):_.isArray(a)?(_.forEach(a,function(b,c){this.opts.wholeWordOnly=c!==a.length-1,this.highlightStr(b)},this),!0):(PR.log("Search terms invalid - use a string or an array or strings"),!1)},highlightStr:function(a,b){this.opts=_.extend(this.opts,b),this.searchTerm=this.escape(a),this.checkValidSearchTerm(this.searchTerm)&&_.forEach(this.getAllElements(),function(a){this.search(a)},this)},unhighlightAll:function(){_.forEach(this.getHighlights(),function(a){a.outerHTML=a.innerHTML})},search:function(a){return this.checkForExclusions(a)?void 0:(this.el=a,this.regex=this.createSearchRegex(this.searchTerm),_.forEach(a.childNodes,function(a){a.nodeType===Node.TEXT_NODE&&""!==a.wholeText.trim()&&(this.originalNode=a,this.currentNode=a,this.createNewNode())},this),a)},createNewNode:function(){var a,b,c=this.currentNode.nodeValue;b=this.regex.exec(c),b&&(a=b.index),a>=0?(this.originalNode===this.currentNode&&(this.fragment=document.createDocumentFragment()),this.fragment.appendChild(document.createTextNode(c.substr(0,a))),this.processMatch(a)):this.fragment&&c.length>0?(this.fragment.appendChild(document.createTextNode(c)),this.el.replaceChild(this.fragment,this.originalNode)):this.fragment&&this.el.replaceChild(this.fragment,this.originalNode)},processMatch:function(a){var b=this.currentNode.nodeValue;this.fragment.appendChild(this.createReplaceElement(b.substr(a,this.length(this.searchTerm)))),this.currentNode=document.createTextNode(b.substr(a+this.length(this.searchTerm))),this.createNewNode()},createReplaceElement:function(a){var b=document.createElement("span");return b.className=this.HIGHLIGHT_CLASS,b.appendChild(document.createTextNode(a)),b},checkForExclusions:function(a){return _.find(this.EXCLUDED_TAGS,function(b){return a.tagName===b})},escape:function(a){return a?a.replace(this.ESCAPE_REGEX,"\\$&"):(PR.log("Highlight Widget - Search term does not exist",PR.log.ERROR),!1)},checkValidSearchTerm:function(a){return a?this.INVALID_REGEX.test(a)?(PR.log("** ERROR - Highlight Widget ** Invalid search term - invalid character supplied",PR.log.ERROR),!1):!0:(PR.log("Highlight Widget - Search term does not exist",PR.log.ERROR),!1)},createSearchRegex:function(a){var b=_.bind(function(){return this.opts.wholeWordOnly?"\\b":""},this);return new RegExp(b()+a+b(),"gi")},length:function(a){return a.replace(/\\/g,"").length},getAllElements:function(){return Array.prototype.slice.call(document.getElementsByTagName("*"))},getHighlights:function(){return Array.prototype.slice.call(document.getElementsByClassName(this.HIGHLIGHT_CLASS))}},PR.highlightAll=function(a){PR.SearchWidget.highlight(a)},PR.unhighlightAll=function(){PR.SearchWidget.unhighlightAll()},PR.appCanScroll=!0,PR.enabled=!0,PR.params={},PR.Core={activeWidgets:[],AppFrameworks:{IPHONE:"ios.iphone",IPAD:"ios.ipad",ANDROID:"android.device",WEBOS:"webos.touchpad",DESKTOP:"desktop"},AppTargetFormat:{EPUB:"ePub",DEFAULT:"default",HTML5:"html5"},BrowserSniff:{AGENT:navigator.userAgent,FIREFOX:/Firefox/.test(navigator.userAgent),WEBKIT:/WebKit/.test(navigator.userAgent),OPERA:/Opera/.test(navigator.userAgent),SAFARI:/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent),CHROME:!!window.chrome,IE:/MSIE/.test(navigator.userAgent)||/Trident/.test(navigator.userAgent),IE9:9===PR.utils.getInternetExplorerVersion(),IE10:10===PR.utils.getInternetExplorerVersion(),IOS:/iPad|iPhone|iPod/.test(navigator.userAgent),CHROME40UP:PR.utils.getChromeVersion()>=40,CHROME40DOWN:PR.utils.getChromeVersion()<40,CHROMEFRAME:window.externalHost?!0:!1},WhiteListedParams:{enableBrowserBar:!0},$:window.$,SVG_NS:"http://www.w3.org/2000/svg",XLINK_NS:"http://www.w3.org/1999/xlink",widgets:{},WIDGET_MAP:null,CURRENT_APP_FRAMEWORK:"",CURRENT_TARGET_FORMAT:"",autoPlay:!1,containingFrame:void 0,initialized:!1,about:{VERSION:"1.12.6",GITCOMMIT:"3e060dd",BUILDTIME:"Fri, 27 Nov 2020 07:41:33 GMT"},mediaElementCheckLimit:5,mediaElementCheckCount:0,features:{inline_iframe:!0,android_ha:!1,enableHighlight:!1,tokenisedSearch:!0},isFeaturesCalled:!1,getFeatures:function(){return this.isFeaturesCalled=!0,JSON.stringify(this.features)},setFeatures:function(a){_.extend(this.features,a)},notifyFlag:!1,isOnline:!1,isZoom:!1,isOnScreen:!1,init:function(){if(!window.hasOwnProperty("radio"))throw new Error('Function "radio" not found for subscribe/publish events.');if(!this.initialized){try{this.$="undefined"!=typeof window.top.widgets$?window.top.widgets$:this.$;
}catch(a){}_.bindAll(this),this.checkOnline(),this.createWidgetFactory(),PR.enabled&&(this.notifyFlag=!1,this.subscribeEvents(),this.setVendorPrefix(),this.browserClass(),this.loadLegacyWidgets(),this.loadWidgets(),this.initialized=!0,PR.SearchWidget&&PR.SearchWidget.initialize(),PR.StackController.init(),radio(PR.Event.PR_INITIALIZED).broadcast())}},getOnScreenOverride:function(){return"true"===PR.utils.getMetaValueByProperty("quark-widgets-onscreen")},checkOnline:function(){this.setOnline("undefined"!=typeof window._isOnlineState?window._isOnlineState:this.isOnline)},browserClass:function(){PR.utils.addClass(document.body,"pr-"+this.CURRENT_APP_FRAMEWORK.split(".").join("-")),this.containingFrame&&(this.BrowserSniff.IE?PR.utils.addClass(document.body,"ie"):this.BrowserSniff.WEBKIT&&PR.utils.addClass(document.body,"webkit"))},_setAppFramework:function(){PR.Core.CURRENT_TARGET_FORMAT===PR.Core.AppTargetFormat.HTML5?this.CURRENT_APP_FRAMEWORK=this.AppFrameworks.DESKTOP:-1!==navigator.userAgent.toLowerCase().indexOf("ipad")?this.CURRENT_APP_FRAMEWORK=this.AppFrameworks.IPAD:-1!==navigator.userAgent.toLowerCase().indexOf("iphone")?this.CURRENT_APP_FRAMEWORK=this.AppFrameworks.IPHONE:-1!==navigator.userAgent.toLowerCase().indexOf("android")?this.CURRENT_APP_FRAMEWORK=this.AppFrameworks.ANDROID:window.PalmSystem?this.CURRENT_APP_FRAMEWORK=this.AppFrameworks.WEBOS:this.CURRENT_APP_FRAMEWORK=this.AppFrameworks.DESKTOP,this["is"+this.CURRENT_APP_FRAMEWORK.split(".").join("")]=!0;var a=!0,b=!0;this.containingFrame&&PR.params.webapp===!0&&(PR.params.enablescripts===!1&&(b=!1),b&&PR.params.autoplay!==!1||(a=!1)),this.autoPlay=a,PR.enabled=b},_setTargetFormat:function(){var a=PR.utils.getMetaValueByProperty("quark-target-format");this.CURRENT_TARGET_FORMAT=this.AppTargetFormat.DEFAULT,"epub"===a.toLowerCase()?this.CURRENT_TARGET_FORMAT=this.AppTargetFormat.EPUB:"html5"===a.toLowerCase()&&(this.CURRENT_TARGET_FORMAT=this.AppTargetFormat.HTML5)},_getParams:function(){var a,b,c,d,e,f,g,h,i={},j=window.frameElement;if(a=window.location.href,b=a.indexOf("#"),c=a.lastIndexOf("?"),c>=0){d=a.substring(c+1,-1===b?void 0:b),e=d.split("&");for(var k=0;k<e.length;k+=1)f=e[k].split("="),g=decodeURIComponent(f[0]),h=decodeURIComponent(f[1]),i[g]=h}j&&(_.extend(i,PR.utils.createDataset(j)),i.webapp&&(this.containingFrame=j)),i.hasOwnProperty("loglevel")&&(PR.log.level=Number(i.loglevel)),PR.params=i},subscribeEvents:function(){radio(PR.Event.APP_SCROLL_EVENT).subscribe([this.onAppScroll,this]),radio(PR.Event.REASSIGN_EVENT).subscribe([this.onReassignEvent,this]),radio(PR.Event.APP_NOTIFY_EVENT).subscribe([this.onAppNotify,this]),radio(PR.Event.NAVIGATE_NEXT_PAGE).subscribe([this._navNextPage,this]),radio(PR.Event.NAVIGATE_PREVIOUS_PAGE).subscribe([this._navPreviousPage,this]),radio(PR.Event.NAVIGATE_TO_PAGE).subscribe([this._navToPage,this]),radio(PR.Event.NAVIGATE_TO_ARTICLE).subscribe([this._navToArticle,this]),radio(PR.Event.NAVIGATE_TO_URL).subscribe([this._navToUrl,this]),radio(PR.Event.ZOOMABLE_IMAGE).subscribe([this._openImage,this]),radio(PR.Event.GEOLOCATION).subscribe([this._sendUserGeoLocCoords,this]),radio(PR.Event.OPEN_FILE).subscribe([this._openFile,this]),radio(PR.Event.ISSUE_SCREEN).subscribe([this._gotoIssueScreen,this]),radio(PR.Event.TAKE_SCREENSHOT).subscribe([this._takeScreenshot,this]),radio(PR.Event.RESET_PAGE).subscribe([this._resetPage,this]),radio(PR.Event.PR_INITIALIZED).subscribe([this._onPRInitalized,this]),radio(PR.Event.SAVE_STATE).subscribe(this.savePageState),radio(PR.Event.LOAD_STATE).subscribe(this.loadPageState),radio(PR.Event.GO_TO_SLIDE).subscribe([this._onGoToSlide,this]),window.onorientationchange=function(){radio(PR.Event.ON_ORIENTATION_CHANGE).broadcast()},window.onresize=function(){radio(PR.Event.ON_RESIZE).broadcast()},window.onscroll=function(){radio(PR.Event.ON_SCROLL).broadcast()}},createWidgetFactory:function(){!function(a){var b={ANIMATION:["FixedAnimationWidget","AnimationWidget"],AUDIO:"AudioWidget",BUTTON:"Button",COLORING:"ColoringWidget",EFFECTS:"ImageEffectsWidget",FLIP:"FlipWidget",FIGUREVIEWER:"FigureViewerWidget",IFRAME:"WebViewWidget",IMAGE360:"Image360Widget",ENLARGE_IMAGE:"ImageEnlargeWidget",PICTUREZOOM:"PictureZoomWidget",POPUP:"PopupViewer",MODAL_POPUP:"ModalPopupWidget",SCROLLZONE:"ScrollZoneWidget",SLIDESHOW:"SlideshowWidget",TRANSFORMABLE:"TransformableWidget",VIDEO:"VideoWidget",BASE:"BaseWidget",SAMPLE:"SampleWidget"};a.WIDGET_MAP={get:function(a){if(!b[a])throw new Error("Widget name not recognised, "+a);return b[a]||null}}}(this)},registerWidget:function(a,b){this.widgets[a]||(this.widgets[a]=b)},createWidget:function(a){var b=null;try{var c=a.getAttribute("data-widget"),d=this.WIDGET_MAP.get(a.getAttribute("data-widget"));"ANIMATION"===c&&(d=null===a.getAttribute("data-animation")?d[0]:d[1]),b=this.widgets[d].create(a),this.activeWidgets.push(b)}catch(e){PR.log(e,PR.log.ERROR)}return b},destroyWidget:function(a){this.activeWidgets=_.without(this.activeWidgets,a)},loadWidgets:function(a){_.each((a||document).querySelectorAll("[data-widget]"),function(a){this.createWidget(a)},this)},loadLegacyWidgets:function(){var widgets=document.querySelectorAll("[widget-load]");if(0!==widgets.length)for(var a=0;a<widgets.length;a+=1){var widget=widgets[a],js=widget.getAttribute("widget-load");-1!==js.indexOf("this")&&(js=js.replace("this","widget")),eval(js)}},onAppScroll:function(a){"boolean"==typeof a&&a!==PR.appCanScroll&&(PR.appCanScroll=a)},onReassignEvent:function(childElements,element){for(var i=0;i<=childElements.length-1;i+=1){var childElement=childElements[i];if(childElement===element)return;if(childElement.hasOwnProperty("getAttribute")&&childElement.getAttribute("pr-onclick")){var js=childElement.getAttribute("pr-onclick");-1!==js.indexOf("this")&&(js=js.replace("this","childElement")),eval(js)}}},onAppNotify:function(a){if(PR.Core.CURRENT_TARGET_FORMAT===PR.Core.AppTargetFormat.EPUB){if(a&&-1!==a.indexOf("jstap"))return;var b=a&&a.match(/^[^:]+\:/)[0];if(b){var c=["changePage:","navigateTo:","localResource:","geolocation:","internal:","screenshot:","resetstate:","hotspot:","resetstate:","savestate:","custom:","audio:","savestate:","reporting:","layer:","articleById:","inlineaudio:","video:","openImage:","externalurl:"];if(-1!==c.indexOf(b))return}}if(PR.Core.containingFrame)return PR.notifyApp(a);for(var d=window;d.parent&&d.parent!==d&&"undefined"!=typeof d.parent.PR&&"undefined"!=typeof d.parent.PR.Core;)d=d.parent;if(d!==window)return d.PR.Core.onAppNotify(a);switch(this.CURRENT_APP_FRAMEWORK){case this.AppFrameworks.IPAD:case this.AppFrameworks.IPHONE:var e=this;-1===a.indexOf("jstap")?(setTimeout(function(){var b=new Date;PR.log(a+"  "+b.getMilliseconds()),window.location=a},Math.floor(101*Math.random())),this.notifyFlag=!0,setTimeout(function(){e.notifyFlag=!1},500)):setTimeout(function(){if(!e.notifyFlag){var b=new Date;PR.log(a+"  "+b.getMilliseconds()),window.location=a}},Math.floor(57*Math.random()+102));break;case this.AppFrameworks.DESKTOP:this.onAppNotifyDesktop(a);break;case this.AppFrameworks.ANDROID:PR.notifyApp(a)}},onAppNotifyDesktop:function(a){if(PR.log("-- NOTIFY APP -- message: "+a),0===a.indexOf("http"))this.openInNewWindow(a);else if(0===a.indexOf("mailto:"))window.location=a;else if(0===a.indexOf("localResource://")||0===a.indexOf("video://")){var b=a,c=a.indexOf("://");-1!==c&&(b=a.substring(c+3,a.length)),this.openInNewWindow(b)}},openInNewWindow:function(a){PR.Core.CURRENT_TARGET_FORMAT===PR.Core.AppTargetFormat.EPUB?window.location.assign(a):window.open(a,"_blank")},setOnline:function(a){this.isOnline=a,radio(PR.Event.ONLINE_EVENT).broadcast(a)},setZoom:function(a){this.isZoom=a},_onScreen:function(){this.isOnScreen=!0;var a=PR.Event.PAGE_ON_SCREEN;PR.StackController.hasStacks&&(a=PR.Event.STACK_CONTROLLER_ON_SCREEN),radio(a).broadcast()},_offScreen:function(){this.isOnScreen=!1,radio(PR.Event.PAGE_OFF_SCREEN).broadcast()},getUniqueId:function(){return this.indexStart||(this.indexStart=0),this.indexStart+=1,"auto-generate-id-"+this.indexStart},triggerElementVisible:function(a){for(var b=a.querySelectorAll("[data-widget]"),c=0;c<b.length;c+=1){var d=b[c],e=PR.Core.getWidgetById(d.getAttribute("id"));e&&e._onElementVisible({id:e.id})}},triggerElementNotVisible:function(a){for(var b=a.querySelectorAll("[data-widget]"),c=0;c<b.length;c+=1){var d=b[c],e=PR.Core.getWidgetById(d.getAttribute("id"));e&&e._onElementNotVisible({id:e.id})}},_navNextPage:function(a){var b="changePage://next";return radio(PR.Event.APP_NOTIFY_EVENT).broadcast(b),b},_navPreviousPage:function(a){var b="changePage://previous";return radio(PR.Event.APP_NOTIFY_EVENT).broadcast(b),b},_navToPage:function(a){if(!a)throw new Error("[_navToPage() - Target dataset not passed through to the handler]");var b=a.linkIndex;if(!b)throw new Error("[data-link-index not specified for NAVIGATE_TO_PAGE in Button.js]");b=Number(b)-1;var c='{ "index" : "'+b+'" }',d="navigateTo://"+PR.utils.encodeURIComponent(c);return radio(PR.Event.APP_NOTIFY_EVENT).broadcast(d),d},_navToArticle:function(a){if(!a)throw new Error("[_navToArticle() - Target dataset not passed through to the handler]");var b=a.linkArticle,c="";if(!b)throw new Error("Article not specified for NAVIGATE_TO_ARTICLE in Button.js [data-link-article]");var d,e=a.linkIndex;return e||(e=1),e=Number(e)-1,0!==e||a.linkAnchor?(c+='{ "articleId" : "'+b+'", "index" : "'+e+'"',a.linkAnchor&&(c+=', "linkAnchor" : "'+a.linkAnchor+'"'),c+=" }",d="navigateTo://"+PR.utils.encodeURIComponent(c)):d="articleById://"+b,radio(PR.Event.APP_NOTIFY_EVENT).broadcast(d),d},_navToUrl:function(a){var b="",c="",d="",e="";if(!a)throw new Error("[_navToUrl() - Target dataset not passed through to the handler]");if(c=a.target,!c)throw new Error("Url not specified for NAVIGATE_TO_URL in Button.js [data-target]");if("string"==typeof c&&null!==c.match(/^[^:]+\:/)){if(c.match(/\%/g)||(c=encodeURI(c)),"w"!==c.charAt(0)&&(d=c.match(/^[^:]+\:/)[0]),PR.Core.isFeaturesCalled)if(d.match(/http\:/g)?(b="http",c=c.replace("http://","")):d.match(/https\:/g)?(b="https",c=c.replace("https://","")):d.match(/mailto\:/g)&&(e=a.target),""===b){c.match(/\%/g)&&(c=decodeURI(c));var f=""!==d?!0:!1;f&&(c=c.replace(d+"//","")),c=PR.utils.encodeURIComponent(c),f&&(c=d+"//"+c),""===e&&(e=c)}else e={scheme:b,url:c},a.appTarget&&_.extend(e,{target:a.appTarget.toLowerCase()}),e="externalurl://"+PR.utils.encodeURIComponent(JSON.stringify(e));else e=c;return radio(PR.Event.APP_NOTIFY_EVENT).broadcast(e),e}},_openImage:function(a){if(!a)throw new Error("[_openImage() - Target dataset not passed through to the handler]");var b=a.src;if(!b)throw new Error("[_openImage() - Source not specified for openImage://]");var c="openImage://"+b;return radio(PR.Event.APP_NOTIFY_EVENT).broadcast(c),c},_openFile:function(a){var b=a.target,c=this._generateQueryString(a,PR.Core.WhiteListedParams),d="localResource://"+b+c;radio(PR.Event.APP_NOTIFY_EVENT).broadcast(d)},_generateQueryString:function(a,b){if("object"!=typeof b)return"";var c,d=[];for(c in a)a.hasOwnProperty(c)&&b[c]&&d.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return d.length>0?"?"+d.join("&"):""},_sendUserGeoLocCoords:function(a){if(!a)throw new Error("[_sendUserGeoLocCoords - Target element not passed through to the handler]");var b=a.lat;if(!b)throw new Error('[_sendUserGeoLocCoords - The attribute "data-lat" not specified.]');var c=a.lon;if(!c)throw new Error('[_sendUserGeoLocCoords - The attribute "data-lon" not specified.]');var d="geolocation://locate/?lat="+b+"&lon="+c;return radio(PR.Event.APP_NOTIFY_EVENT).broadcast(d),d},_gotoIssueScreen:function(){var a="internal://issues";return radio(PR.Event.APP_NOTIFY_EVENT).broadcast(a),a},_takeScreenshot:function(){var a="screenshot://";return radio(PR.Event.APP_NOTIFY_EVENT).broadcast(a),a},cumulativeOffset:function(a){var b=0,c=0;do b+=a.offsetTop||0,c+=a.offsetLeft||0,a=a.offsetParent;while(a);return{top:b,left:c}},_resetPage:function(){var a="resetstate://";return radio(PR.Event.APP_NOTIFY_EVENT).broadcast(a),a},_onPRInitalized:function(){radio(PR.Event.PR_INITIALIZED).unsubscribe([this._onPRInitalized,this]),PR.Core.CURRENT_APP_FRAMEWORK===PR.Core.AppFrameworks.DESKTOP?PR.Core.autoPlay&&this.triggerOnScreen():this.getOnScreenOverride()&&this.triggerOnScreen()},triggerOnScreen:function(){this._onScreen(),radio(PR.Event.ONLINE_EVENT).broadcast(!0)},_onGoToSlide:function(a){var b="hotspot://"+a.target+"/"+a.targetSlide;radio(PR.Event.APP_NOTIFY_EVENT).broadcast(b)},canScroll:function(){return PR.appCanScroll},_shouldSwitchGPU:function(){return-1===[PR.Core.AppFrameworks.IPHONE,PR.Core.AppFrameworks.IPAD].indexOf(PR.Core.CURRENT_APP_FRAMEWORK)},enableGPU:function(){this._shouldSwitchGPU()&&radio(PR.Event.ENABLE_GPU).broadcast()},disableGPU:function(){this._shouldSwitchGPU()&&radio(PR.Event.DISABLE_GPU).broadcast()},getWidgetById:function(a){for(var b=this.activeWidgets,c=null,d=0;d<b.length;d+=1)if(c=b[d],c.id===a)return c;return!1},savePageState:function(){var a={},b=0;for(a.widgets=[],void 0!==PR.TransformableMaster&&(a.transformableMaster=PR.TransformableMaster.saveStates()),b=0;b<this.activeWidgets.length;b+=1)"TransformableWidget"!==this.activeWidgets[b].className&&(a.widgets[b]=this.activeWidgets[b].saveState());return a.highlights=PR.Highlight.saveHighlight(),radio(PR.Event.APP_NOTIFY_EVENT).broadcast("savestate://"+PR.utils.encodeURIComponent(JSON.stringify(a))),a},loadPageState:function(a){var b=null,c=0;for(b=JSON.parse(window.unescape(a)),void 0!==b.transformableMaster&&void 0!==PR.TransformableMaster&&PR.TransformableMaster.loadStates(b.transformableMaster),c=0;c<b.widgets.length;c+=1)b.widgets[c]&&this.activeWidgets[c].loadState(b.widgets[c]);PR.Highlight.loadHighlight(b.highlights)},setVendorPrefix:function(){var a,b="",c=document.createElement("div").style,d="t,webkitT,MozT,msT,OT".split(","),e=0,f=d.length;for(e=0;f>e;e+=1)if(a=d[e]+"ransform",a in c){b=d[e].substr(0,d[e].length-1);break}var g=function(a){return""===b?a:(a=a.charAt(0).toUpperCase()+a.substr(1),b+a)},h=function(a){var c=b?"-"+b.toLowerCase()+"-":"";return""===c?a:c+a},i=function(){return"webkit"===b?"webkitTransitionEnd":"Moz"===b?"transitionend":"o"===b?"oTransitionEnd":"transitionend"},j=function(){return"webkit"===b?"webkitAnimationEnd":"Moz"===b?"animationend":"o"===b?"oAnimationEnd":"animationend"},k=function(){return"webkit"===b?"webkitAnimationStart":"Moz"===b?"animationstart":"o"===b?"oAnimationstart":"animationstart"};this.prefix={js:{transform:g("transform"),transitionProperty:g("transitionProperty"),transitionDuration:g("transitionDuration"),transitionDelay:g("transitionDelay"),transitionTimingFunction:g("transitionTimingFunction"),transition:g("transition"),animationDuration:g("animationDuration"),boxshadow:g("boxShadow"),animationStart:k(),transitionEnd:i(),animationEnd:j()},css:{transform:h("transform"),transitionProperty:h("transition-property"),transitionDuration:h("transition-duration"),transformOrigin:h("transform-origin"),transitionTimingFunction:h("transition-timing-function"),transition:h("transition"),backfaceVisibility:h("backface-visibility"),perspectiveOrigin:h("perspective-origin"),animationDuration:h("animation-duration"),boxshadow:h("box-shadow")}}}},PR.log=function(a,b){b=b||PR.log.DEBUG,PR.log.level>-1&&b.value<=PR.log.level&&(b===PR.log.ERROR||console[b.label])},PR.log.level=-1,PR.log.ERROR={value:0,label:"error",style:"color:#cb3837"},PR.log.WARN={value:1,label:"warn",style:"color:#f39c12"},PR.log.DEBUG={value:2,label:"log",style:"color:#00adef"},function(){function a(a){PR.Core.init()}PR.Core._getParams(),PR.Core._setTargetFormat(),PR.Core._setAppFramework(),window.widgetSettings=[],window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){return window.setTimeout(a,1e3/60)}}(),window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}(),PR.Core.CURRENT_APP_FRAMEWORK===PR.Core.AppFrameworks.DESKTOP&&PR.Core.containingFrame||window.addEventListener("load",a,!1),window.MediaElementWatch=function(){"function"==typeof window.MediaElementPlayer||PR.Core.mediaElementCheckCount>=PR.Core.mediaElementCheckLimit?PR.Core.init():(PR.Core.mediaElementCheckCount+=1,setTimeout(function(){window.MediaElementWatch()},50))},window.linkReader=function(a){if(a.jQuery&&"undefined"==typeof jQuery){var d=document.getElementsByTagName("body")[0];window.jQuery=function(b){return a.jQuery(b,d)},window.$=window.jQuery,_.extend(window.$,a.jQuery)}(a.css||a["css-file"])&&b(a.css||a["css-file"],!!a["css-file"]),(a.js||a["js-file"])&&c(a.js||a["js-file"],!!a["js-file"])},window.loadReader=function(a,b){window.widgetSettings=a,window.linkReader({jQuery:b,"js-file":window.widgetSettings.reader+window.widgetSettings.video.mediaElementJSFile}),window.MediaElementWatch()};var b=function(a,b){var c=document.createElement(b?"link":"style");c.type="text/css",b?(c.rel="stylesheet",c.href=a,c.media="screen"):c.innerHTML=a,document.head.appendChild(c)},c=function(a,b){var c=document.createElement("script");b?c.src=a:c.innerHTML=a,document.body.appendChild(c)}}(),function(a){"use strict";PR.Transitions=a.Transitions||{};var b=PR.Core.BrowserSniff.IE9,c={fade:function(c){var d={from:0,to:1,duration:1e3,easeFunc:"linear",delay:0,startCallBack:null,endCallBack:function(){}};if(c=_.extend(d,c),c.from!==c.to)if(c.startCallBack&&c.startCallBack.apply(this),c.target.removeEventListener(PR.Core.prefix.js.transitionEnd,c.endCallBack,!1),c.target.style.visibility="visible",b){var e=function(b,c){var d,e=b.target.style,f=parseInt(b.duration,10)/(1e3/60),g=(b.to-b.from)/f;e.opacity=b.from,function h(){e.opacity=parseFloat(e.opacity)+parseFloat(g),(c?e.opacity<=b.to:e.opacity>=b.to)?(a.cancelRequestAnimFrame(d),b.endCallBack({currentTarget:b.target,eventPhase:2})):d=a.requestAnimFrame(h)}()};e(c,c.from>c.to)}else c.target.addEventListener(PR.Core.prefix.js.transitionEnd,c.endCallBack,!1),c.target.style.opacity=c.from,c.target.style.setProperty(PR.Core.prefix.css.transitionDuration,c.duration+"ms"),c.target.style.setProperty(PR.Core.prefix.css.transitionProperty,"opacity"),c.target.style.opacity=c.to}};_.extend(PR.Transitions,{fade:function(a){if(!a.target)throw new Error("[Transitions - fade Target not specified for transition.]");if("undefined"==typeof a.to)throw new Error("[Transitions - fade to not specified for transition.]");if("undefined"==typeof a.from)throw new Error("[Transitions - fade from not specified for transition.]");var b=a.target.style.opacity?a.target.style.opacity:1;b!==a.to&&c.fade(a)}}),PR.Transitions.TransSlide={transIn:function(a,b,c,d,e,f,g,h,i){if(!a)throw new Error("[TransSlide - transIn Target not specified for transition.]");b!==c&&(i=i===!1?!1:!0,a.removeEventListener(PR.Core.prefix.js.transitionEnd,h,!1),a.addEventListener(PR.Core.prefix.js.transitionEnd,h,!1),g.apply(this),i?(a.style.setProperty(PR.Core.prefix.css.transitionProperty,"transform"),a.style.setProperty(PR.Core.prefix.css.transform,"translate3d("+c+"px,0px,0px)")):a.style.setProperty("left",c+"px"),a.style.setProperty(PR.Core.prefix.css.transitionTimingFunction,"ease"),a.style.setProperty(PR.Core.prefix.css.transitionDuration,d+"ms"))},transOut:function(){}},PR.Transitions.TransFlip={transRight:function(a,b,c,d,e,f,g,h){b.removeEventListener(PR.Core.prefix.js.animationEnd,h,!1),b.addEventListener(PR.Core.prefix.js.animationEnd,h,!1),b.addEventListener(PR.Core.prefix.js.animationStart,g,!1),b.style.setProperty(PR.Core.prefix.css.animationDuration,e+"ms"),PR.utils.addClass(c,"front"),PR.utils.addClass(d,"back"),PR.utils.addClass(a,"active")}}}(this),function(a){"use strict";var b=function(){var a=document.createElement("div"),b="webkitPerspective perspective mozPerspective".split(" "),c=_.find(b,function(b){return"undefined"!=typeof a.style[b]}),d=function(){return PR.Core.$}();return{csstransforms3d:!!c,jQuery:!!d}}(),c=Proto.extend({actionQ:function(){var a=[];return{add:function(b){a.push(b)},getTask:function(){return PR.Core.BrowserSniff.FIREFOX?a.pop():a.shift()},clear:function(){a=[]},length:function(){return a.length},show:function(){return a}}}(),el:null,init:function(a){this.el=a,this.actionQ.clear()},register:function(a){return this.actionQ.add(a),this},perform:function(a){for(;this.actionQ.length();)this.actionQ.getTask().call(this)},end:function(a){this.perform(a)},move:function(a,b,c){},scale:function(a,b){},rotate:function(a){},duration:function(a){},delay:function(a){},ease:function(a){},hide:function(){},show:function(){},translate:function(a,b){return this.move(a,b,"")},to:function(a,b){return this.move(a,b,"")}}),d=c.extend({className:"CSSDelegate",_transforms:null,opts:null,init:function(a){if(!a)throw new Error(this.className+" Actor instance requires initialisation options");this._super(a.element),this.opts=_.extend(a,{reset:_.extend({position:{},scale:{},rotation:0},a.reset||{})}),this._transforms=[]},transform:function(a){this._transforms.push(a)},sortTransforms:function(a){return _.sortBy(a).reverse().join(" ")},perform:function(a){if(this.el.style[PR.Core.prefix.js.transition]="",this._super(),a&&_.isFunction(a)){var b=_.bind(function(c){a(),this.el.removeEventListener(PR.Core.prefix.js.transitionEnd,b)},this);this.el.addEventListener(PR.Core.prefix.js.transitionEnd,b)}this._transforms.length&&_.defer(_.bind(function(){this.el.style[PR.Core.prefix.js.transform]=this.sortTransforms(this._transforms),b&&this.el.style[PR.Core.prefix.css.transitionDuration]&&"0ms"===this.el.style[PR.Core.prefix.css.transitionDuration]&&_.defer(b)},this))},reset:function(a){if(this.opts.reset.style)return this.el.style=this.opts.reset.style,this;for(this.actionQ.clear();this._transforms.length;)this._transforms.pop();return this.el.style[PR.Core.prefix.js.transition]="",this.duration(0).move(this.opts.reset.position.x||0,this.opts.reset.position.y||0,"").scale(this.opts.reset.scale.x||1,this.opts.reset.scale.y||1).rotate(this.opts.reset.rotation||0).end(function(){for(;this._transforms.length;)this._transforms.pop();a&&_.isFunction(a)&&a()}.bind(this)),this.el.style.opacity=this.opts.reset.opacity,this.currentlyAnimating=!1,this},move:function(a,b,c){return"%"!==c&&(c="px"),"string"==typeof a&&-1!==a.search("%")&&(c=""),PR.Core.CURRENT_TARGET_FORMAT===PR.Core.AppTargetFormat.EPUB&&"ease"===this.el.dataset.timingFunction?this.register(function(){this.transform("translate("+(a||0)+"px, "+(b||0)+"px)")}):this.register(function(){this.transform("translate3d("+(a||0)+c+", "+(b||0)+c+", 0px)")})},scale:function(a,b){return PR.Core.CURRENT_TARGET_FORMAT===PR.Core.AppTargetFormat.EPUB&&"ease"===this.el.dataset.timingFunction?this.register(function(){this.transform("scale("+a+", "+b+")")}):this.register(function(){this.transform("scale3d("+a+", "+b+", 1)")})},rotate:function(a){return this.register(function(){this.transform("rotate("+a+"deg)")})},opacity:function(a){return this.register(function(){this.el.style.opacity=a})},hide:function(){return this.register(function(){this.el.style.opacity=0})},show:function(){return this.register(function(){this.el.style.opacity=1})},duration:function(a){return this.register(function(){this.el.style[PR.Core.prefix.js.transitionDuration]=a+"ms"})},delay:function(a){return this.register(function(){this.el.style[PR.Core.prefix.js.transitionDelay]=a+"ms"})},ease:function(a){return this.register(function(){this.el.style[PR.Core.prefix.js.transitionTimingFunction]=a})}}),e=c.extend({className:"jQueryDelegate",opts:null,_transform:{},_stepTransform:[],_transition:{},_step:null,self:null,$:PR.Core.$||window.$,init:function(a){if(!a)throw new Error(this.className+" Actor instance requires initialisation options");this._super(a.element),this.self=this.$(a.element),this.opts=_.extend(a,{initial:this.getInitialProps()}),this._step=[],this._stepTransform=[]},getInitialProps:function(){return _.mapValues(this.self.css(["left","top","width","height","opacity"]),function(a,b){return _.isString(a)?/\./.test(a)?parseFloat(a,10):parseInt(a,10):void 0})},perform:function(a){if(this._super(),0!==this._transition.duration){var b=_.bind(function(a,b,c){for(;this._stepTransform.length;)this._stepTransform.pop();_.each(this._step,function(a){a.call(this,b)},this),this.self.css({transform:this._stepTransform.join(" ")})},this);_.delay(function(c){c.self.animate(_.isEmpty(c._transform)?{opacity:c.opts.initial.opacity}:c._transform,_.extend(c._transition,{always:a,progress:b}))},this._transition.delay||0,this)}},reset:function(a){for(this.actionQ.clear(),this._transform={},this._transition={};this._step.length;)this._step.pop();for(;this._stepTransform.length;)this._stepTransform.pop();return this.self.stop(),this.self.css({transform:this.opts.reset.scale?"scale("+this.opts.reset.scale.x+","+this.opts.reset.scale.y+")":""}),this.self.animate({left:this.opts.initial.left,top:this.opts.initial.top,width:this.opts.initial.width,height:this.opts.initial.height,opacity:this.opts.initial.opacity},{duration:0}),a&&_.isFunction(a)&&a(),this},move:function(a,b,c){return this.register(function(){(a||0===a)&&(this._transform.left=this.opts.initial.left+a),(b||0===b)&&(this._transform.top=this.opts.initial.top+b)})},scale:function(a,b){return this.register(function(){this._step.push(function(c){this._stepTransform.push("scale("+(this.opts.reset.scale.x-(this.opts.reset.scale.x-a)*c)+","+(this.opts.reset.scale.y-(this.opts.reset.scale.y-b)*c)+")")})})},rotate:function(a){return this.register(function(){this._step.push(function(b){this._stepTransform.push("rotate("+a*b+"deg)")})})},opacity:function(a){return this.register(function(){this._transform.opacity=a})},hide:function(){return this.register(function(){this._transform.opacity=0})},show:function(){return this.register(function(){this._transform.opacity=1})},duration:function(a){return this.register(function(){this._transition.duration=a})},delay:function(a){return this.register(function(){this._transition.delay=a})},ease:function(a){return this.register(function(){this._transition.easing="linear"===a?"linear":"swing"})}});PR.Actor=Proto.extend({impl:null,init:function(){return b.csstransforms3d?(PR.log("Using CSS3 transforms"),void(this.impl=d)):PR.Core.BrowserSniff.IE||PR.Core.BrowserSniff.FIREFOX?(PR.log("Using jQuery for transforms"),void(this.impl=e)):void PR.log("No implementation for actor.js.  Requires CSS3 or jQuery.",PR.log.ERROR)},actor:function(a){return a=_.extend({element:this.el,reset:{style:null,opacity:1}},a),this.impl.create(a)}})}(this),PR.Core.registerWidget("BaseWidget",Proto.extend({className:"BaseWidget",id:null,stackContainer:null,init:function(a){_.extend(this,window.EventEmitter.prototype),this.hasTouch="ontouchstart"in window,this.isOnScreen=!1,this.isVisible=!0,this.isTouchInteractive=!1,a&&(this.el=a,this.id=a.id),!this.id&&a&&(this.el.setAttribute("id",PR.Core.getUniqueId()),this.id=this.el.getAttribute("id")),radio(PR.Event.PAGE_ON_SCREEN).subscribe([this._onScreenWidget,this]),radio(PR.Event.STACK_ON_SCREEN).subscribe([this._stackOnScreen,this]),radio(PR.Event.DISABLE_GPU).subscribe([this._disableGPU,this]),radio(PR.Event.ENABLE_GPU).subscribe([this._enableGPU,this]),PR.log("Create :: "+this.className+" "+this.id)},_stackOnScreen:function(a){this._stackCheck(a)&&(PR.log(this.id+" :: Stack On Screen :: "+a),radio(PR.Event.STACK_ON_SCREEN).unsubscribe([this._stackOnScreen,this]),radio(PR.Event.STACK_OFF_SCREEN).subscribe([this._stackOffScreen,this]),this._onScreenWidget())},_stackOffScreen:function(a){this._stackCheck(a)&&(PR.log(this.id+" :: Stack Off Screen :: "+a),radio(PR.Event.STACK_ON_SCREEN).subscribe([this._stackOnScreen,this]),radio(PR.Event.STACK_OFF_SCREEN).unsubscribe([this._stackOffScreen,this]),this._offScreenWidget())},_stackCheck:function(a){return a&&this.stackContainer&&this.stackContainer!==a?(PR.log(this.id+" :: Stack Check :: "+a+" :: false"),!1):(PR.log(this.id+" :: Stack Check :: "+a+" :: true"),!0)},setStackContainer:function(a){return a?void(this.stackContainer=a):void PR.log(this.id+" :: No Container ID Specified")},_onScreenWidget:function(){PR.log(this.id+" :: Widget on screen :: "+this.className),radio(PR.Event.PAGE_ON_SCREEN).unsubscribe([this._onScreenWidget,this]),radio(PR.Event.PAGE_OFF_SCREEN).subscribe([this._offScreenWidget,this]),radio(PR.Event.ELEMENT_VISIBLE).subscribe([this._onElementVisible,this]),radio(PR.Event.ELEMENT_NOT_VISIBLE).subscribe([this._onElementNotVisible,this]),this.isTouchInteractive&&(PR.utils.isWindowsTablet()&&PR.utils.isChromeTouch()?this.el.addEventListener(PR.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_END,this._onTouchInteractive,!1):this.el.addEventListener(PR.INTERACTION_EVENTS.INTERACTION_END,this._onTouchInteractive,!1)),this.isOnScreen=!0},_offScreenWidget:function(){PR.log(this.id+" ::: Widget off screen :: "+this.className),radio(PR.Event.PAGE_OFF_SCREEN).unsubscribe([this._offScreenWidget,this]),radio(PR.Event.PAGE_ON_SCREEN).subscribe([this._onScreenWidget,this]),radio(PR.Event.ELEMENT_VISIBLE).unsubscribe([this._onElementVisible,this]),radio(PR.Event.ELEMENT_NOT_VISIBLE).unsubscribe([this._onElementNotVisible,this]),this.isOnScreen=!1,PR.utils.isWindowsTablet()&&PR.utils.isChromeTouch()?this.el.removeEventListener(PR.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_END,this._onTouchInteractive,!1):this.el.removeEventListener(PR.INTERACTION_EVENTS.INTERACTION_END,this._onTouchInteractive,!1)},_onElementVisible:function(a){PR.log(this.id+" :: Element Visible :: "+this.className),radio(PR.Event.ELEMENT_VISIBLE).unsubscribe([this._onElementVisible,this]),this.isVisible=!0},_onElementNotVisible:function(a){PR.log(this.id+" ::: Element not Visible :: "+this.className),radio(PR.Event.ELEMENT_NOT_VISIBLE).unsubscribe([this._onElementNotVisible,this]),radio(PR.Event.ELEMENT_VISIBLE).subscribe([this._onElementVisible,this]),this.isVisible=!1},_onTouchInteractive:function(a){radio(PR.Event.APP_NOTIFY_EVENT).broadcast("jstap://"+this.id)},_isEventReferToMe:function(a){if(!a)throw new Error("[Dataset not specified, should have DOMStringMap.]");if(!this.el)throw new Error('[There is no "el" property on the widget.]');var b=this.el.getAttribute("id");if(!b)throw new Error('[There is no "id" attribute on the "el".]');if(a.target&&"undefined"!==a.target&&a.target!==b){if("string"!=typeof a.target)return!1;for(var c=a.target.split(","),d=c.length,e=0;d>e&&c[e]!==b;)if(e+=1,e===d)return!1}return a.id&&a.id!==b?!1:"string"==typeof a&&a!==b?!1:!0},_initDefaultProps:function(){if(!this.el)throw new Error('[The "el" is not initialized. BaseWidget]');var a,b=PR.utils.createDataset(this.el);for(var c in b)a=!0,this[c]=b[c];return a},baseImplementation:function(){},_addInteractionEvents:function(){},_removeInteractionEvents:function(){},_enableGPU:function(){},_disableGPU:function(){},saveState:function(){return""},loadState:function(a){},destroy:function(){this._offScreenWidget(),radio(PR.Event.PAGE_ON_SCREEN).unsubscribe([this._onScreenWidget,this]),this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el),PR.Core.destroyWidget(this)}})),PR.Core.registerWidget("SampleWidget",PR.Core.widgets.BaseWidget.extend({init:function(a){if(!a)throw new Error("HTML Element not attached.");this.className="SampleWidget",this._super(),this.el=a,this.id=a.getAttribute("id"),_.bindAll(this),a&&a.addEventListener("click",function(a){alert("clicking the sample widget")})},additionalMethod:function(){alert("calling additional method")}})),PR.Core.registerWidget("Button",PR.Core.widgets.BaseWidget.extend({className:"Button",_action:"",_defaultDelay:0,userInteraction:!0,outsideProximity:!1,el:null,id:null,startX:null,startY:null,proximity:10,init:function(a){
if(!a)throw new Error("HTML element not attached.");_.bindAll(this),this.el=a,this.id=a.getAttribute("id"),this.className="Button",this._super(),this._initDefaultProps(),this._initVars(),/NAVIGATE_TO_URL/g.test(this._action)&&this.el.removeAttribute("href"),/NAVIGATE/g.test(this._action)&&(this.el.style.cursor="pointer")},_onTap:function(a){var b,c,d,e=PR.utils.createDataset(this.el),f=e.action,g=e.target,h=[],i=[];if(!f)throw new Error("No action attribute specified on the button.");if(i=f.split(","),0===f.length)throw new Error("No actions specified on the button, at least one action must be specified");if("string"==typeof g&&(h=g.split(",")),i.length>1&&i.length!==h.length)throw new Error("Supplied number of targets does not match supplied number of actions");for(e=this.manageDataset(e),d=i.length,c=0;d>c;c+=1){b=i[c];var j,k={};for(j in e)e[j].toString()&&"function"!=typeof e[j]&&(i.length>1?(k[j]=e[j].toString().split(",")[b],k[j]=e[j].toString().split(",")[c]):k[j]=e[j]);k.widget="BUTTON",this.broadcastEvent(PR.Event[k.action],k,k.delay)}return"desktop"===PR.Core.CURRENT_APP_FRAMEWORK&&this._desktopEnhancements(),!1},broadcastEvent:function(a,b,c){return 0===Number(c)||"undefined"==typeof c?radio(a).broadcast(b):void _.delay(function(){radio(a).broadcast(b)},c)},manageDataset:function(a){var b,c=a.action.split(","),d=[],e=[],f="";if(a.delay=this.manageDatasetDelay(a,c.length),"undefined"!=typeof a.targetSlide){if(d=a.targetSlide.toString().split(","),c.length===d.length)return a;for(b=0;b<c.length;b+=1)"GO_TO_SLIDE"===c[b]?e.push(d.pop()):e.push("null");f=e.slice(0,e.length).join(","),a.targetSlide=f}return a},manageDatasetDelay:function(a,b){var c,d,e;for("undefined"==typeof a.delay?a.delay="0":a.delay+="",c=a.delay.split(","),e=0;b>e;e+=1)d=c[e],(""===d||"undefined"==typeof d||isNaN(d))&&(d=this._defaultDelay),c[e]=d;return c.join(",")},_desktopEnhancements:function(){var a=document.getElementsByClassName("carousel");a.length&&(this._fakeFocusClick(a[0],"mouseover",!0,!0),this._fakeFocusClick(a[0],"mousedown",!0,!0),this._fakeFocusClick(a[0],"click",!0,!0),this._fakeFocusClick(a[0],"mouseup",!0,!0))},_fakeFocusClick:function(a,b){var c=document.createEvent("MouseEvents");c.initEvent.apply(c,Array.prototype.slice.call(arguments,1)),a.dispatchEvent(c)},_onScreenWidget:function(){this._super(),this._addInteractionEvents()},_offScreenWidget:function(){this._super(),this._removeInteractionEvents()},handleEvent:function(a){switch(a.type){case PR.INTERACTION_EVENTS.INTERACTION_START:case PR.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_START:this._onInteractionStart(a);break;case PR.INTERACTION_EVENTS.INTERACTION_END:case PR.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_END:this._onInteractionEnd(a)}},_onInteractionStart:function(a){a.pageX?(this.startX=a.pageX,this.startY=a.pageY):(this.startX=a.touches[0].pageX,this.startY=a.touches[0].pageY),this.outsideProximity=!1,this.userInteraction===!0&&(PR.utils.isWindowsTablet()&&PR.utils.isChromeTouch()&&(this.el.addEventListener(PR.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_MOVE,this._onInteractionMove,!1),this.el.addEventListener(PR.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_END,this._onInteractionEnd,!1)),this.el.addEventListener(PR.INTERACTION_EVENTS.INTERACTION_MOVE,this._onInteractionMove,!1),this.el.addEventListener(PR.INTERACTION_EVENTS.INTERACTION_END,this._onInteractionEnd,!1))},_onInteractionMove:function(a){var b,c;b=a.pageX?a.pageX:a.changedTouches[0].pageX,c=a.pageY?a.pageY:a.changedTouches[0].pageY,this.checkProximity(this.startX,b)&&this.checkProximity(this.startY,c)||(this.outsideProximity=!0)},_onInteractionEnd:function(a){this.userInteraction===!0&&(PR.utils.isWindowsTablet()&&PR.utils.isChromeTouch()&&(this.el.removeEventListener(PR.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_MOVE,this._onInteractionMove,!1),this.el.removeEventListener(PR.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_END,this._onInteractionEnd,!1)),this.el.removeEventListener(PR.INTERACTION_EVENTS.INTERACTION_MOVE,this._onInteractionMove,!1),this.el.removeEventListener(PR.INTERACTION_EVENTS.INTERACTION_END,this._onInteractionEnd,!1)),this.outsideProximity||(radio(PR.Event.APP_NOTIFY_EVENT).broadcast("jstap://"+this.id),this._onTap(a))},_initVars:function(){if(this._action=this.action,!this._action)throw new Error("No action sepecified for the button with id "+this.el.id)},_addInteractionEvents:function(){this.userInteraction===!0&&(PR.utils.isWindowsTablet()&&PR.utils.isChromeTouch()&&this.el.addEventListener(PR.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_START,this._onInteractionStart,!1),this.el.addEventListener(PR.INTERACTION_EVENTS.INTERACTION_START,this._onInteractionStart,!1))},_removeInteractionEvents:function(){this.userInteraction===!0&&(PR.utils.isWindowsTablet()&&PR.utils.isChromeTouch()&&(this.el.removeEventListener(PR.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_START,this,!1),this.el.removeEventListener(PR.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_MOVE,this,!1),this.el.removeEventListener(PR.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_END,this,!1)),this.el.removeEventListener(PR.INTERACTION_EVENTS.INTERACTION_START,this,!1),this.el.removeEventListener(PR.INTERACTION_EVENTS.INTERACTION_MOVE,this,!1),this.el.removeEventListener(PR.INTERACTION_EVENTS.INTERACTION_END,this,!1))},getDataAction:function(){return this._action},setDataAction:function(a){this._action=a},checkProximity:function(a,b){return b>a-this.proximity&&b<a+this.proximity?!0:!1}})),PR.Core.registerWidget("AnimationWidget",PR.Core.widgets.BaseWidget.extend({startingOpacity:1,startingScale:{x:1,y:1},elementBoundingBox:0,pathElementBoundingBox:0,currentlyAnimating:!1,resizeTimer:0,animationStartTimer:0,hidden:!1,currentLoop:0,defaults:{className:"PR.AnimationWidget",animationCount:0,keyframeName:null,cssKeyframe:null,id:null,animation:null,duration:1e3,delay:0,timingFunction:"linear",loop:!1,count:0,hideAfter:!1,hideBefore:!1,userInteraction:!1},init:function(a){this._super(a),_.extend(this,this.defaults),this._initDefaultProps(),_.bindAll(this);var b="undefined"!=typeof PR.ANIMATION_EFFECTS[this.animation];if(!b)throw new Error("The type passed to the animation is invalid: "+this.animation);if(this.id=a.getAttribute("id"),this.hideBefore===!0&&(this.el.style.opacity=0),this.userInteraction===!0&&(this.isTouchInteractive=!0),PR.utils.getStartingStyles(this),this.el.style.opacity){var c=parseFloat(this.el.style.opacity,10);this.startingOpacity=c>1?c/100:c}if(this.elementBoundingBox=this.el.getBoundingClientRect(),this._resetCssKeyframe(),void 0===this.svgPath){var d=document.createTextNode("@keyframes "+this.keyframeName+this.cssKeyframe),e=document.createElement("style");e.type="text/css",e.id=this.keyframeName,e.appendChild(d),document.getElementsByTagName("head")[0].appendChild(e)}this.loop&&(this.count>0?this.animationCount=this.count:this.animationCount="infinite")},_getLeftOffset:function(){return this.el.offsetWidth+this.el.getBoundingClientRect().left},_getRightOffset:function(){var a=PR.utils.getPageDimensions(document.body),b=a[0];return b-this.el.getBoundingClientRect().left},_getTopOffset:function(){return this.el.offsetHeight+(window.pageYOffset+this.el.getBoundingClientRect().top)},_getBottomOffset:function(){return document.body.scrollHeight-(window.pageYOffset+this.el.getBoundingClientRect().top)},_applyTransform:function(a,b){this.el.style.transform="translate("+a+"px,"+b+"px)"},_resetCssKeyframe:function(){switch(this.animation){case PR.ANIMATION_EFFECTS.APPEAR:case PR.ANIMATION_EFFECTS.DISAPPEAR:case PR.ANIMATION_EFFECTS.FADE_IN:case PR.ANIMATION_EFFECTS.FADE_OUT:case PR.ANIMATION_EFFECTS.ZOOM_IN:case PR.ANIMATION_EFFECTS.ZOOM_OUT:case PR.ANIMATION_EFFECTS.GROW:case PR.ANIMATION_EFFECTS.SHRINK:case PR.ANIMATION_EFFECTS.ROTATE_CLOCKWISE:case PR.ANIMATION_EFFECTS.ROTATE_ANTICLOCKWISE:this.keyframeName=this.animation+this.id,this._setCssKeyFrame(0,0,0,0);break;case PR.ANIMATION_EFFECTS.FLY_IN:if(this.direction===PR.ANIMATION_DIRECTION.RIGHT){this.keyframeName=this.animation+this.direction+this.id;var a=this._getRightOffset();this._applyTransform(a,0),this._setCssKeyFrame(a,0,0,0)}else if(this.direction===PR.ANIMATION_DIRECTION.TOP){this.keyframeName=this.animation+this.direction+this.id;var b=-this._getTopOffset();this._applyTransform(0,b),this._setCssKeyFrame(0,b,0,0)}else if(this.direction===PR.ANIMATION_DIRECTION.BOTTOM){this.keyframeName=this.animation+this.direction+this.id;var c=this._getBottomOffset();this._applyTransform(0,c),this._setCssKeyFrame(0,c,0,0)}else{this.keyframeName=this.animation+this.direction+this.id;var d=-this._getLeftOffset();this._applyTransform(d,0),this._setCssKeyFrame(d,0,0,0)}break;case PR.ANIMATION_EFFECTS.FLY_OUT:this.direction===PR.ANIMATION_DIRECTION.RIGHT?(this.keyframeName=this.animation+this.direction+this.id,this._setCssKeyFrame(0,0,this._getRightOffset(),0)):this.direction===PR.ANIMATION_DIRECTION.TOP?(this.keyframeName=this.animation+this.direction+this.id,this._setCssKeyFrame(0,0,0,-this._getTopOffset())):this.direction===PR.ANIMATION_DIRECTION.BOTTOM?(this.keyframeName=this.animation+this.direction+this.id,this._setCssKeyFrame(0,0,0,this._getBottomOffset())):(this.keyframeName=this.animation+this.direction+this.id,this._setCssKeyFrame(0,0,-this._getLeftOffset(),0));break;case PR.ANIMATION_EFFECTS.PATH:var e=document.getElementById(this.pathId);this.pathElementBoundingBox=e.getBoundingClientRect();var f=e.getElementsByTagName("path")[0];if((void 0!==f||null!==f)&&(this.svgPath=f.getAttribute("d")),null===this.svgPath||void 0===this.svgPath||""===this.svgPath){this.svgPath=void 0,this.keyframeName=this.animation+this.id;var g=e.getBoundingClientRect().left-this.el.getBoundingClientRect().left-this.el.offsetWidth/2,h=e.getBoundingClientRect().top-this.el.getBoundingClientRect().top-this.el.offsetHeight/2,i=g+e.offsetWidth,j=h+e.offsetHeight;h+=e.offsetHeight/2,j=h,this.direction===PR.ANIMATION_DIRECTION.RTL?(this.el.style.transform="translate("+i+"px,"+j+"px)",this._setCssKeyFrame(i,j,g,h)):(this.el.style.transform="translate("+g+"px,"+h+"px)",this._setCssKeyFrame(g,h,i,j))}else this._setSvgPathAnimator()}},_setSvgPathAnimator:function(){var a,b=1e3/60/this.duration/4,c=1e3/60;this.startPercent=0;var d=!1,e=this.duration;switch(this.direction===PR.ANIMATION_DIRECTION.RTL&&(d=!0),this.timingFunction){case PR.TIMING_FUNCTION.LINEAR:a=PR.utils.getEasingEquation(0,0,1,1,b);break;case PR.TIMING_FUNCTION.EASE:a=PR.utils.getEasingEquation(.25,.1,.25,1,b);break;case PR.TIMING_FUNCTION.EASE_IN:a=PR.utils.getEasingEquation(.42,0,1,1,b);break;case PR.TIMING_FUNCTION.EASE_OUT:a=PR.utils.getEasingEquation(0,0,.58,1,b);break;case PR.TIMING_FUNCTION.EASE_IN_OUT:a=PR.utils.getEasingEquation(.42,0,.58,1,b);break;case PR.TIMING_FUNCTION.STEP_START:c=this.duration,this.startPercent=d?0:100;break;case PR.TIMING_FUNCTION.STEP_END:c=this.duration,this.startPercent=d?100:0;break;default:var f=/\((.*)\)/i,g=this.timingFunction.match(f)[1].split(",");if(this.timingFunction.includes("cubic-bezier"))a=PR.utils.getEasingEquation(g[0],g[1],g[2],g[3],b);else if(this.timingFunction.includes("steps")){var h=100/parseInt(g[0]);c=this.duration/parseInt(g[0]),"start"===g[1]?(a="start",this.startPercent=d?100-h:h,c=this.duration/parseInt(g[0]),e=d?this.duration:this.duration===c?1:this.duration-c):"end"===g[1]&&(this.startPercent=d?100:0)}}this.pathAnimator=new window.PathAnimator(this.svgPath,{duration:e/1e3,step:this._step.bind(this),reverse:d,easing:a,onDone:this._onAnimationEnd.bind(this),fps:c})},_step:function(a,b){var c=this.endScaleX/100-this.startingScale.x,d=this.endScaleY/100-this.startingScale.y,e=this.endOpacity/100-this.startingOpacity,f=this.pathAnimator.percent;this.pathAnimator.settings.reverse&&(f=100-f);var g=this.startingScale.x+f*c/100,h=this.startingScale.y+f*d/100,i=parseFloat(this.startingOpacity)+f*e/100,j=b;if(void 0!==this.endRotation&&0!==this.endRotation){var k=void 0!==this.rotationDuration&&0!==this.rotationDuration?this.duration/this.rotationDuration:1;j=f*this.endRotation/100*k}var l=this.pathElementBoundingBox.left+a.x-this.elementBoundingBox.width/2,m=this.pathElementBoundingBox.top+a.y-this.elementBoundingBox.height/2;this.el.style.cssText="top:"+m+"px;left:"+l+"px;opacity:"+i+";transform: scaleX("+g+")scaleY("+h+")rotate("+j+"deg);"},_onAnimationEnd:function(){return this.currentlyAnimating?(this.currentlyAnimating=!1,this.el.style.opacity=this.endOpacity/100,this.loop===!0?void this._loop():this.hideAfter===!0?void this._hide():void 0):void 0},_setCssKeyFrame:function(a,b,c,d){var e="visible";this.hideAfter===!0&&(e="hidden");var f=0;void 0!==this.endRotation&&(f=this.endRotation),this.cssKeyframe="{0%  {transform: translate("+a+"px,"+b+"px)scaleX("+this.startingScale.x+")scaleY("+this.startingScale.y+")rotate(0deg);opacity:"+this.startingOpacity+";}100% {transform: translate("+c+"px,"+d+"px)scaleX("+this.endScaleX/100+")scaleY("+this.endScaleY/100+")rotate("+f+"deg);visibility: "+e+";opacity: "+this.endOpacity/100+";}}"},_replaceCssKeyframeAnimation:function(){var a=document.createTextNode("@keyframes "+this.keyframeName+this.cssKeyframe),b=document.getElementById(this.keyframeName);b.replaceChild(a,b.childNodes[0])},_onResizingUpdateElements:function(a){"none"!==this.el.style.display&&void 0===this.svgPath&&(clearTimeout(this.resizeTimer),this.resizeTimer=this._setResizer())},_setResizer:function(){return setTimeout(function(){this.animation===PR.ANIMATION_EFFECTS.FLY_OUT?this._resetAnimation():this.currentlyAnimating?(clearTimeout(this.resizeTimer),this.resizeTimer=this._setResizer()):this._resetAnimation()}.bind(this),100)},_resetAnimation:function(){"none"!==this.el.style.animation&&(this._resetCssKeyframe(),this._replaceCssKeyframeAnimation())},_onAnimationStateChanged:function(a){a.type===PR.ANIMATION_EVENTS.ANIMATION_START?this.currentlyAnimating=!0:(this.currentlyAnimating=!1,this.animation===PR.ANIMATION_EFFECTS.FLY_OUT&&(this.el.style.display="none"))},_onTouchInteractive:function(){this._super(),this.restart()},restart:function(a){if((!a||this._isEventReferToMe(a))&&!this.currentlyAnimating)if(void 0===this.svgPath)if(this.el.style.animation="none",this.el.offsetHeight,PR.Core.BrowserSniff.SAFARI){var b=this;setTimeout(function(){b._setAnimation()},10)}else this._setAnimation();else this.currentlyAnimating=!0,this._animateToPath()},_setAnimation:function(){this.el.style.animation=this.keyframeName+" "+this.duration/1e3+"s "+this.delay/1e3+"s "+this.animationCount+" "+this.timingFunction+" forwards"},_animateToPath:function(a){return this.hidden?(this._show(),_.defer(this._animateToPath)):void this.pathAnimator.start(this.startPercent)},_loop:function(){return this.currentLoop<this.count-1?(this.restart(),void(this.currentLoop=this.currentLoop+1)):0===this.count?void this.restart():(this.hideAfter===!0&&this._hide(),void(this.currentLoop=0))},_hide:function(){this.hidden=!0,PR.utils.addClass(this.el,"displayNone")},_show:function(){this.hidden=!1,PR.utils.removeClass(this.el,"displayNone")},_startAnimation:function(){void 0===this.svgPath?this.restart():this.animationStartTimer=setTimeout(function(){this.restart()}.bind(this),this.delay)},_onElementVisible:function(a){(!a||this._isEventReferToMe(a))&&(this._super(),this.onscreen===!0&&this._startAnimation())},_onScreenWidget:function(){this.isOnScreen||(this._super(),this.onscreen!==!0||PR.utils.hasAncestorWidgetPopup(this.el)||this._startAnimation(),this._subscribeEvents())},_offScreenWidget:function(){if(this.isOnScreen)if(this._super(),this._unSubscribeEvents(),this.currentlyAnimating=!1,void 0===this.svgPath){var a=this;setTimeout(function(){a.el.style.animation="none",a.el.style.display="block"})}else clearTimeout(this.animationStartTimer),this.pathAnimator.stop(),this.el.style.cssText="",this.el.style.opacity=this.startingOpacity},_subscribeEvents:function(){this.el.addEventListener(PR.ANIMATION_EVENTS.ANIMATION_START,this._onAnimationStateChanged),this.el.addEventListener(PR.ANIMATION_EVENTS.ANIMATION_END,this._onAnimationStateChanged),radio(PR.Event.PLAY_ANIMATION).subscribe(this.restart),radio(PR.Event.ON_RESIZE).subscribe([this._onResizingUpdateElements,this])},_unSubscribeEvents:function(){this.el.removeEventListener(PR.ANIMATION_EVENTS.ANIMATION_START,this._onAnimationStateChanged),this.el.removeEventListener(PR.ANIMATION_EVENTS.ANIMATION_END,this._onAnimationStateChanged),radio(PR.Event.PLAY_ANIMATION).unsubscribe(this.restart),radio(PR.Event.ON_RESIZE).unsubscribe([this._onResizingUpdateElements,this])}})),PR.Core.registerWidget("FixedAnimationWidget",PR.Core.widgets.BaseWidget.extend({className:"FixedAnimationWidget",actions:null,currentActor:null,currentLoop:0,currentlyAnimating:!1,hidden:!1,startingOpacity:1,startingScale:{x:1,y:1},init:function(a){this._super(a),_.bindAll(this),this.mixin(PR.Actor.create()),this.data=_.extend({duration:1e3,delay:0,timingFunction:"linear",loop:!1,count:0,hideAfter:!1,hideBefore:!1},PR.utils.createDataset(this.el)),this.actions=this.setActions(),this.data.hideBefore===!0&&(this.el.style.opacity=0),this.data.userInteraction===!0&&(this.isTouchInteractive=!0),PR.utils.getStartingStyles(this),this.currentActor=this.actor({element:this.el,reset:{opacity:this.startingOpacity,scale:this.startingScale}})},_onScreenWidget:function(){this.isOnScreen||(this._super(),this.data.onscreen===!0&&this.restart(),radio(PR.Event.PLAY_ANIMATION).subscribe(this.restart))},_offScreenWidget:function(){if(this._super(),this.currentActor)try{this.currentlyAnimating=!1,this.currentActor.reset()}catch(a){}radio(PR.Event.PLAY_ANIMATION).unsubscribe(this.restart)},_onTouchInteractive:function(){this._super(),this.restart()},setActions:function(){var a=[],b=this,c={endPos:function(a){return function(c){var d=b.calcEndX(parseInt(a.x,10)),e=b.calcEndY(parseInt(a.y,10));return c.to(d,e)}},endScale:function(a){return("0"===a.x||"0"===a.y)&&PR.log("Warning: mobile devices hate a scale of 0",PR.log.WARN),function(c){return c.scale(a.x*b.startingScale.x,a.y*b.startingScale.y)}},endRotation:function(a){return function(b){return b.rotate(parseInt(a,10))}},endOpacity:function(a){return function(b){return b.opacity(parseInt(a,10)/100)}},duration:function(a){return function(b){return b.duration(parseInt(a,10))}},delay:function(a){return function(b){return b.delay(parseInt(a,10))}},timingFunction:function(a){return function(b){return b.ease(a)}}};return _.extend(this.data,{endScale:{x:"undefined"!=typeof this.data.endScaleX?parseInt(this.data.endScaleX,10)/100:1,y:"undefined"!=typeof this.data.endScaleY?parseInt(this.data.endScaleY,10)/100:1},endPos:{x:this.data.endX,y:this.data.endY,start:{x:this.data.startX,y:this.data.startY}}}),_.each(this.data,function(b,d){return c[d]?void a.push(c[d](b)):void 0}),a},animate:function(a){if(this.hidden)return this.show(),_.defer(this.animate,a);var b=a||this.actor({element:this.el,reset:{opacity:this.startingOpacity,scale:this.startingScale}});try{_.reduce(this.actions,function(a,b){return b(a)},b,this)}catch(c){}return b.end(this.onAnimationEnd),this.currentActor=b,b},restart:function(a){(!a||this._isEventReferToMe(a))&&(this.currentlyAnimating||(this.currentlyAnimating=!0,this.currentActor.reset(this.animate)))},loop:function(){return this.currentLoop<this.data.count-1?(this.restart(),void(this.currentLoop=this.currentLoop+1)):0===this.data.count?void this.restart():(this.data.hideAfter===!0&&this.hide(),void(this.currentLoop=0))},hide:function(){this.actor().hide().end(),this.hidden=!0,PR.utils.addClass(this.el,"displayNone")},show:function(){this.actor().opacity(this.startingOpacity).end(),this.hidden=!1,PR.utils.removeClass(this.el,"displayNone")},onAnimationEnd:function(){return this.currentlyAnimating?(this.currentlyAnimating=!1,this.data.loop===!0?void this.loop():this.data.hideAfter===!0?void this.hide():void 0):void 0},getOffset:function(){function a(){return b=c.getAttribute("data-widget"),!c.offsetParent||f.indexOf(b)>-1?!1:(c=c.offsetParent,!0)}for(var b,c=this.el,d=c.offsetLeft,e=c.offsetTop,f=["SLIDESHOW","POPUP"];a();)d+=c.offsetLeft,e+=c.offsetTop;return{x:d,y:e}},calcEndX:function(a){return a-this.calcOffsetX(this.el)},calcEndY:function(a){return a-this.calcOffsetY(this.el)},positionStops:["SLIDESHOW","POPUP"],calcOffsetX:function(a){var b,c=0;do{b=a.getAttribute("data-widget");var d=parseInt(window.getComputedStyle(a).left,10);if(!isNaN(d)){if(this.positionStops.indexOf(b)>-1)break;c+=d}}while(a===a.offsetParent);return c},calcOffsetY:function(a){var b,c=0;do{b=a.getAttribute("data-widget");var d=parseInt(window.getComputedStyle(a).top,10);if(!isNaN(d)){if(this.positionStops.indexOf(b)>-1)break;c+=d}}while(a===a.offsetParent);return c}})),PR.Core.registerWidget("AudioWidget",PR.Core.widgets.BaseWidget.extend({_audioTrackSRC:null,_audioLooping:!0,_audioPlayerType:null,_audioControls:!0,_audioAutoplay:!1,_audioElement:null,_playing:null,_audioID:null,_history:{},_state:null,_playShouldToggleToPause:!1,el:null,_notifyMessage:null,playFunction:null,pauseFunction:null,autoplayFunction:null,autostopFunction:null,toggleFunction:null,audioJSON:null,mediaElement:null,useMediaElement:!1,mediaElementID:null,mediaElementPluginPath:null,mediaElementCSSFile:null,mediaElementJSFile:null,mediaElementControls:null,mediaElementControlsAlwaysShow:null,isAndroidApp:!1,fakePlayerHTML:null,fakePlayerInnerHTML:'<button id="fakePlay" class="play">â¶</button><button id="fakePause" class="pause"><span class="pausebar"></span><span class="pausebar"></span></button>',init:function(a){if(!a)throw new Error("HTML Element not attached.");this.className="AudioWidget",this.el=a,this.id=a.id,this.isAndroidApp=PR.Core.CURRENT_APP_FRAMEWORK===PR.Core.AppFrameworks.ANDROID&&!PR.params.webapp,this._super(),_.bindAll(this,"audio","audioPause","autoplayAudio","inlinePlay","inlinePause","inlineAutoPlay","autoStopInline","inlineToggle","inlineDestroyPlayer","_onPlay","_onPause","_onToggle","appAutoPlay","appAutoStop","_reportPlay","_reportPause","_reportAudioEvent"),this._initVars(a);var b=window.widgetSettings;PR.Core.CURRENT_APP_FRAMEWORK===PR.Core.AppFrameworks.DESKTOP&&PR.Core.containingFrame&&(this.mediaElementPluginPath=b.reader+b.video.mediaElementPluginPath,this.mediaElementCSSFile=b.reader+b.video.mediaElementCSSFile,this.mediaElementJSFile=b.reader+b.video.mediaElementJSFile,this.mediaElementControls=b.video.mediaElementControls,this.mediaElementControlsAlwaysShow=b.video.mediaElementControlsAlwaysShow,this.useMediaElement=!0),"app"===this._audioPlayerType?this._initApp():this._initInline()},audio:function(a,b,c){this._audioPlayerType=b,"inline"===this._audioPlayerType?this._playTrack(a.id,c):radio(PR.Event.APP_NOTIFY_EVENT).broadcast(this._notifyMessage)},autoplayAudio:function(){for(var a=document.querySelectorAll('[data-audio-autoplay="true"]'),b=0;b<a.length;b+=1)a[b].onclick()},audioPause:function(){"inline"===this._audioPlayerType?this._pause():radio(PR.Event.APP_NOTIFY_EVENT).broadcast(this._notifyMessage)},inlinePlay:function(a,b){this._initInline(),b||this.autoStopInline(),this.isAndroidApp&&this._isEventReferToMe(a)?PR.Core.onAppNotify(this.audioJSON):(this._isEventReferToMe(a)||a.target===!0)&&this._audioElement.play()},inlinePause:function(a){this.isAndroidApp&&this._isEventReferToMe(a)?PR.Core.onAppNotify(this.audioJSON.replace("play","pause")):(this._isEventReferToMe(a)||a.target===!0)&&this._audioElement.pause()},inlineAutoPlay:function(){this._audioAutoplay===!0?this.inlinePlay({id:this.el.id}):this._initInline()},autoStopInline:function(){this.isAndroidApp?PR.Core.onAppNotify(this.audioJSON.replace("play","stop")):(this._audioElement.pause(),this._audioElement.currentTime&&(this._audioElement.currentTime=0))},inlineToggle:function(a){(this._isEventReferToMe(a)||a.target===!0)&&(this.isAndroidApp?PR.Core.onAppNotify(this.audioJSON.replace("play","toggle")):this._audioElement.paused?this.inlinePlay(a,!0):this.inlinePause(a))},inlineDestroyPlayer:function(a){this._isEventReferToMe(a)&&this._audioElement&&(this._audioElement.pause(),this.el.removeChild(this._audioElement),this._audioElement=null)},_onPlay:function(a){(this._isEventReferToMe(a)||a.target===!0)&&(PR.log("_onPlay "),radio(PR.Event.APP_NOTIFY_EVENT).broadcast(this._notifyMessage),this._playing=!0)},_onPause:function(a){(this._isEventReferToMe(a)||a.target===!0)&&(PR.log("_onPause "),"desktop"===PR.Core.CURRENT_APP_FRAMEWORK&&this._playing?radio(PR.Event.APP_NOTIFY_EVENT).broadcast(this._notifyMessage):radio(PR.Event.APP_NOTIFY_EVENT).broadcast("audio://"),this._playing=!1)},_onToggle:function(a){(this._isEventReferToMe(a)||a.target===!0)&&(PR.log("_onToggle "),this[this._playing?"_onPause":"_onPlay"](a))},appAutoPlay:function(){this._audioAutoplay===!0&&(radio(PR.Event.APP_NOTIFY_EVENT).broadcast(this._notifyMessage),this._playing=!0)},appAutoStop:function(){this._playing&&(radio(PR.Event.APP_NOTIFY_EVENT).broadcast(this._notifyMessage),this._playing=!1)},_subscribeEvents:function(){"app"!==this._audioPlayerType&&radio(PR.Event.STOP_MEDIA).subscribe(this.autostopFunction),radio(PR.Event.PLAY_MEDIA).subscribe([this.playFunction,this]),radio(PR.Event.PAUSE_MEDIA).subscribe([this.pauseFunction,this]),radio(PR.Event.TOGGLE_MEDIA).subscribe([this.toggleFunction,this])},_unSubscribeEvents:function(){"app"!==this._audioPlayerType&&radio(PR.Event.STOP_MEDIA).unsubscribe(this.autostopFunction),radio(PR.Event.PLAY_MEDIA).unsubscribe([this.playFunction,this]),radio(PR.Event.PAUSE_MEDIA).unsubscribe([this.pauseFunction,this]),radio(PR.Event.TOGGLE_MEDIA).unsubscribe([this.toggleFunction,this])},_onScreenWidget:function(){this.isOnScreen||(this._super(),PR.utils.hasAncestorWidgetPopup(this.el)||this.autoplayFunction(),this._subscribeEvents())},_offScreenWidget:function(){this.isOnScreen&&(this._super(),this.autostopFunction(),this._unSubscribeEvents())},_onElementVisible:function(a){(!a||this._isEventReferToMe(a))&&(this._super(),this.autoplayFunction())},_onElementNotVisible:function(a){(!a||this._isEventReferToMe(a))&&(this._super(),this.autostopFunction())},_pause:function(){this._state="pause",this._audioElement.pause()},_play:function(){this._state="play",this._audioElement.play()},_playTrack:function(a,b){return this._playShouldToggleToPause===!0&&this._currentTrackId===a&&"play"===this._state?void this._pause():(void 0===this._history[a]&&(this._history[a]={track:b,currentTime:.01}),this._currentTrackId=a,this._audioElement.src=b,void this._play())},_addAudioStyle:function(){this._audioElement&&PR.utils.addClass(this._audioElement,"audioControls")},_shouldStartAudio:function(){for(var a=this.el.parentNode,b=null;1===a.nodeType;){if(b=window.getComputedStyle(a),"hidden"===b.visibility||"none"===b.display||0===b.opacity)return!1;a=a.parentNode}return!0},_initVars:function(a){this.el=a;var b=PR.utils.createDataset(a);this._audioID=a.id,this._audioTrackSRC=b.src,this._audioLooping=void 0!==b.loop?b.loop:!1,this._audioPlayerType=b.audioType,this._audioControls=void 0!==b.controls?b.controls:!1,this._audioAutoplay=void 0!==b.autoplay?b.autoplay:!1,this._playing=!1,this.audioJSON='inlineAudio://{"src":"'+this._audioTrackSRC+'", "controls":'+this._audioControls+', "loop":'+this._audioLooping+', "action":"play"}'},_initApp:function(){this._notifyMessage="audio://"+this._audioTrackSRC,this.playFunction=this._onPlay,this.pauseFunction=this._onPause,this.autoplayFunction=this.appAutoPlay,this.autostopFunction=function(){},this.toggleFunction=this._onToggle},_initInline:function(){var a=this;if(null===this._audioElement){if(this.isAndroidApp||(this._audioElement=document.createElement("audio"),this._audioElement.src=this._audioTrackSRC,this._audioElement.setAttribute("id","media-"+this.id),this._audioControls&&(this._audioElement.controls=!0),this._audioLooping&&(this._audioElement.loop=!0),this._addAudioStyle(),this.el.appendChild(this._audioElement),this._audioElement.addEventListener("play",this._reportPlay,!1),this._audioElement.addEventListener("pause",this._reportPause,!1)),!this.fakePlayerHTML&&this.isAndroidApp&&"inline"===this._audioPlayerType&&this._audioControls){this.fakePlayerHTML=document.createElement("div"),PR.utils.addClass(this.fakePlayerHTML,"fake-player"),this.fakePlayerHTML.innerHTML=this.fakePlayerInnerHTML,this.el.appendChild(this.fakePlayerHTML);var b=document.getElementById("fakePlay"),c=document.getElementById("fakePause");b.onclick=function(){a.inlinePlay(a)},c.onclick=function(){a.inlinePause(a)}}this.useMediaElement&&(this.mediaElement=new window.MediaElement("media-"+this.id,{enablePluginDebug:!1,pluginPath:this.mediaElementPluginPath,loop:this._audioLooping,success:function(a){PR.log("Media Element Setup for audio")},error:function(a){}}),this._audioElement=this.mediaElement,this.mediaElement.addEventListener("play",function(b){a._reportAudioEvent("play")}),this.mediaElement.addEventListener("pause",function(b){a._reportAudioEvent("pause")})),this.playFunction=this.inlinePlay,this.pauseFunction=this.inlinePause,this.autoplayFunction=this.inlineAutoPlay,this.autostopFunction=this.autoStopInline,this.toggleFunction=this.inlineToggle}},_reportPlay:function(){this._reportAudioEvent("play")},_reportPause:function(){this._reportAudioEvent("pause")},_reportAudioEvent:function(a){var b={};b.widget="html5audio",b.path=this._audioTrackSRC,b.action=a;var c=JSON.stringify(b);c=encodeURIComponent(c),radio(PR.Event.APP_NOTIFY_EVENT).broadcast("reporting://"+c)}}));var FV_LANDSCAPE="landscape",FV_PORTRAIT="portrait";PR.Core.registerWidget("FigureViewerWidget",PR.Core.widgets.BaseWidget.extend({className:"FigureViewerWidget",_headerHeight:0,_footerHeight:0,_header:null,_footer:null,_widgetWidth:0,_widgetHeight:0,_minimumScale:0,_currentScale:0,_rightGap:0,_bottomGap:0,_maxAvailableHeight:0,_maxAvailableWidth:0,_minimumWidth:0,_minimumHeight:0,_headerScroll:null,_footerScroll:null,imageContainerDiv:null,imageContainerWrap:null,image:null,animationTime:300,canZoom:!0,imageSource:null,clickedTop:null,clickedLeft:null,clickedHeight:null,clickedWidth:null,mainScroll:null,clickedScale:0,xRatio:.5,yRatio:.5,lastImageX:0,lastImageY:0,imageOriginalWidth:0,imageOriginalHeight:0,imageOrientation:null,currentHeight:0,currentWidth:0,computedWidth:0,computedHeight:0,initialTop:0,initialLeft:0,init:function(a){var b=this;if(!a)throw new Error("HTML Element not attached.");this.className="PR.FigureViewerWidget",this.el=a,this.id=a.getAttribute("id"),PR.utils.addClass(this.el,"PR_FigureViewerWidget"),_.bindAll(this),this._initDefaultProps(),this._initVars(),this._super(),window.addEventListener("orientationchange",function(){b._resizeContainer()})},_initVars:function(){if(this.imageSource=this.src,!this.imageSource)throw new Error("The source for the image is not specified.");var a=null,b=null;this.headerSize&&(a=parseInt(this.headerSize,10)),this.footerSize&&(b=parseInt(this.footerSize,10)),this._headerHeight=null!==a?a:this._headerHeight,this._footerHeight=null!==b?b:this._footerHeight,this._header=this.el.getElementsByTagName("header")[0],this._footer=this.el.getElementsByTagName("footer")[0],this._establishWidgetWidth(),this._header&&(this._header.style.height=this._headerHeight+"px"),this._footer&&(this._footer.style.height=this._footerHeight+"px")},_onScreenWidget:function(){this._super(),this.imageContainerDiv||(this.imageContainerDiv=this._createContainerDiv()),this._applyIScrollToHeaderAndFooter()},_offScreenWidget:function(){this._super()},_onElementVisible:function(a){(!a||this._isEventReferToMe(a))&&(this._super(),this._resizeContainer())},_onImageLoad:function(a){this._addImageToWidget(this.imageContainerDiv),PR.utils.addClass(this.imageContainerDiv,"parentContainer"),PR.utils.addClass(this.imageContainerWrap,"scrollZone"),this._minimumScale=this.getCurrentScale(),this.imageContainerWrap.style.width=this.imageContainerDiv.style.width=this._getAvailableWidth()+"px",this.imageContainerWrap.style.height=this.imageContainerDiv.style.height=this._getAvailableHeight()+"px",
this._adjustSize(),this.canZoom===!0&&this._createIScroll()},_onIScrollZoom:function(){this._adjustSize()},_onZoomStart:function(){this.clickedTop=this._getCSS(this.imageContainerWrap,"top"),this.clickedLeft=this._getCSS(this.imageContainerWrap,"left"),this._setupDimensions(this.mainScroll.scale);var a=this.mainScroll.originX,b=this.mainScroll.originY;this.clickedScale=this.mainScroll.scale,this.xRatio=this._minMax(a/this.currentWidth,0,1),this.yRatio=this._minMax(b/this.currentHeight,0,1)},_onZoomEnd:function(a){var b,c,d,e,f,g,h=this.mainScroll,i=this.image,j=this.imageContainerWrap,k=h.x,l=h.y,m=h.imageCurrentTopAdjustment,n=h.imageCurrentLeftAdjustment,o=this._getCSS(j,"top"),p=this._getCSS(j,"left");this._bottomGap=!1,this._rightGap=!1;var q=a?0:this.animationTime;if(a&&h.refresh(),this._setupAnimations(i,0,"width height top left"),this._setupAnimations(j,q,"width height top left"),f=0,g=0,this.currentHeight<this._maxAvailableHeight)j.addEventListener(PR.Core.prefix.js.transitionEnd,this._onImgEnd,!1),b=(this._maxAvailableHeight-this.currentHeight)/2,d=this.currentHeight,c=0,e=this._maxAvailableWidth;else if(this.currentWidth<this._maxAvailableWidth)j.addEventListener(PR.Core.prefix.js.transitionEnd,this._onImgEnd,!1),b=0,d=this._maxAvailableHeight,c=(this._maxAvailableWidth-this.currentWidth)/2,e=this.currentWidth;else{c=b=0,e=this._maxAvailableWidth,d=this._maxAvailableHeight;var r=l+m,s=k+n;this.lastImageY;o>0&&(r=0),this.currentHeight+this.lastImageY+this.initialTop<this._maxAvailableHeight&&(this._bottomGap=!0,r=this._maxAvailableHeight-this.currentHeight),p>0&&(s=0),this.currentWidth+this.lastImageX+this.initialLeft<this._maxAvailableWidth&&(this._rightGap=!0,s=this._maxAvailableWidth-this.currentWidth),l+1>this.lastScrollY&&(0===r?h.scrollTo(k,r,0):this._bottomGap===!0?(h.scrollTo(k,this.lastImageY+this.initialTop,0),_.delay(_.bind(function(){h.scrollTo(k,r,this.animationTime)},this),10)):h.scrollTo(k,r,0)),k+1>this.lastScrollX&&(0===s?h.scrollTo(s,l,0):this._rightGap===!0?(h.scrollTo(this.lastImageX+this.initialLeft,l,0),_.delay(_.bind(function(){h.scrollTo(s,l,this.animationTime)},this),10)):h.scrollTo(s,l,0))}i.style.top=f+"px",i.style.left=g+"px",j.style.top=b+"px",j.style.width=e+"px",j.style.left=c+"px",j.style.height=d+"px",this._bottomGap!==!0&&this._rightGap!==!0&&h.refresh(),this.clickedHeight=null,this.clickedWidth=null},_addImageToWidget:function(a){return this._header?void this._header.parentNode.insertBefore(a,this._header.nextSibling):this._footer?void this._footer.parentNode.insertBefore(a,this._footer.nextSibling):void this.el.appendChild(a)},_createIScroll:function(){this.mainScroll=new IScroll(this.imageContainerWrap,{zoom:!0,zoomMin:this._minimumScale,zoomMax:1,startZoom:this._minimumScale,scrollX:!0,scrollY:!0,bounce:!0,zoomBounce:!1,directionLockThreshold:100,mouseWheelSpeed:.05,scrollbars:!0,mouseWheel:!0,wheelAction:"zoom"}),this.mainScroll.on("zoom",this._onIScrollZoom),this.mainScroll.on("wheelZoom",this._onWheelZoom),this.mainScroll.on("zoomStart",this._onZoomStart),this.mainScroll.on("zoomEnd",this._onZoomEnd)},_onWheelZoom:function(){this._adjustSize(!0)},_onWheelZoomEnd:function(){this.image.style.left="0px",this.image.style.top="0px",this.currentWidth<this._maxAvailableWidth&&(this.imageContainerWrap.style.left=(this._maxAvailableWidth-this.currentWidth)/2+"px"),this.currentHeight<this._maxAvailableHeight&&(this.imageContainerWrap.style.top=(this._maxAvailableHeight-this.currentHeight)/2+"px"),this.mainScroll.refresh()},_createContainerDiv:function(){var a=document.createElement("div");return this.imageContainerWrap=this._createImageWithContainer(this.imageSource),this.image=this.imageContainerWrap.firstChild,a.appendChild(this.imageContainerWrap),a.style.position="relative",this.imageContainerWrap.style.overflow="hidden",a.style.overflow="hidden",this.imageContainerWrap.style.position="relative",a},_createImageWithContainer:function(a){var b=document.createElement("div"),c=document.createElement("img");return c.addEventListener("load",this._onImageLoad),c.setAttribute("src",a),b.appendChild(c),b},_adjustSize:function(a){var b=this.mainScroll?this.mainScroll.scale:this._minimumScale;switch(this.imageContainerWrap.style.setProperty(PR.Core.prefix.css.transitionDuration,"0ms"),this._setupDimensions(b),this.canZoom=this.getCanZoom(),this.clickedHeight||this.clickedWidth||(this.clickedHeight=this.currentHeight,this.clickedWidth=this.currentWidth),this.mainScroll&&(this.lastImageX=this.mainScroll.x,this.lastImageY=this.mainScroll.y),this.imageOrientation){case FV_LANDSCAPE:this._adjustToLandscape(a);break;case FV_PORTRAIT:this._adjustToPortrait(a)}this.canZoom===!1&&(this.imageContainerWrap.style.width=this.imageOriginalWidth+"px",this.imageContainerWrap.style.height=this.imageOriginalHeight+"px",this.imageContainerWrap.style.top=(this._maxAvailableHeight-this.imageOriginalHeight)/2+"px",this.imageContainerWrap.style.left=(this._maxAvailableWidth-this.imageOriginalWidth)/2+"px")},_adjustToLandscape:function(a){("undefined"==typeof this.clickedLeft||null===this.clickedLeft)&&(this.clickedLeft=this.initialLeft);var b=this.imageContainerWrap,c=this.mainScroll,d=0,e=this.image,f=this.clickedLeft,g=0,h=this.currentWidth-this.clickedWidth,i=this.currentWidth,j=h*this.xRatio;i>this._maxAvailableWidth?i=this._maxAvailableWidth:i<this._minimumWidth&&(i=this._minimumWidth),0>j&&0===this.clickedLeft&&(j*=-1),this.clickedLeft-j>0&&(g=this.clickedLeft-j),j<this.clickedLeft&&(f=j),h>=0?(g=this.clickedLeft-j,0>g&&(g=0)):0>h&&(i=this.currentWidth,this.lastImageX>0&&(g=this.lastImageX+this.clickedLeft,f=-this.lastImageX)),g>this.initialLeft&&(g=this.initialLeft),this.lastImageY>0&&(d=-this.lastImageY),this.lastImageY+this.currentHeight<this._maxAvailableHeight&&(d=this._maxAvailableHeight-(this.lastImageY+this.currentHeight)),b.style.left=g+"px",b.style.width=i+"px",e.style.top=d+"px",e.style.left=f+"px",e.style.position="relative",this.mainScroll&&(this.lastScrollX=c.x,c.imageCurrentLeftAdjustment=f),a&&this._onWheelZoomEnd()},_adjustToPortrait:function(a){("undefined"==typeof this.clickedTop||null===this.clickedTop)&&(this.clickedTop=this.initialTop);var b=this.imageContainerWrap,c=this.mainScroll,d=0,e=this.image,f=this.clickedTop,g=0,h=this.currentHeight-this.clickedHeight,i=this.currentHeight,j=h*this.yRatio;i>this._maxAvailableHeight?i=this._maxAvailableHeight:i<this._minimumHeight&&(i=this._minimumHeight),0>j&&0===this.clickedTop&&(j*=-1),this.clickedTop-j>0&&(g=this.clickedTop-j),j<this.clickedTop&&(f=j),h>=0?(g=this.clickedTop-j,0>g&&(g=0)):0>h&&(i=this.currentHeight,this.lastImageY>0&&(g=this.lastImageY+this.clickedTop,f=-this.lastImageY)),g>this.initialTop&&(g=this.initialTop),this.lastImageX>0&&(d=-this.lastImageX),this.lastImageX+this.currentWidth<this._maxAvailableWidth&&(d=this._maxAvailableWidth-(this.lastImageX+this.currentWidth)),b.style.top=g+"px",b.style.height=i+"px",e.style.top=f+"px",e.style.left=d+"px",e.style.position="relative",this.mainScroll&&(this.lastScrollY=c.y,c.imageCurrentTopAdjustment=f),a&&this._onWheelZoomEnd()},_createIScrollOnElement:function(a){var b=new IScroll(a,{zoom:!1,scrollY:!0,directionLockThreshold:100,mouseWheelSpeed:20,scrollbars:!0,mouseWheel:!0,bounce:!1});return b},_applyIScrollToHeaderAndFooter:function(){this._header&&!this._headerScroll&&(this._headerScroll=this._createIScrollOnElement(this._header)),this._footer&&!this._footerScroll&&(this._footerScroll=this._createIScrollOnElement(this._footer))},_setupDimensions:function(a){this._setOriginalDimensions(),this._setCurrentDimensions(a),this._setMinimumDimensions(),this._setMaximumDimensions(),this.initialTop=(this._maxAvailableHeight-this._minimumHeight)/2,this.initialLeft=(this._maxAvailableWidth-this._minimumWidth)/2},_setOriginalDimensions:function(){this.imageOriginalWidth&&this.imageOriginalHeight||(this.imageOriginalHeight=parseFloat(window.getComputedStyle(this.image,null).getPropertyValue("height")),this.imageOriginalWidth=parseFloat(window.getComputedStyle(this.image,null).getPropertyValue("width")))},_setCurrentDimensions:function(a){this.currentWidth=this.computedWidth=this.imageOriginalWidth*a+1,this.currentHeight=this.computedHeight=this.imageOriginalHeight*a+1},_setMinimumDimensions:function(){this._minimumHeight&&this._minimumWidth||(this._minimumWidth=this.computedWidth,this._minimumHeight=this.computedHeight)},_setMaximumDimensions:function(){this._maxAvailableHeight=this._getAvailableHeight(),this._maxAvailableWidth=this._getAvailableWidth()},_resizeContainer:function(){this._destroyScrollElements(),this.imageContainerDiv.parentNode&&this.imageContainerDiv.parentNode.removeChild(this.imageContainerDiv),this._resetVariables(),this.imageContainerDiv=this._createContainerDiv(),this._applyIScrollToHeaderAndFooter()},_resetVariables:function(){this.imageOriginalHeight=null,this._establishWidgetWidth(),this._minimumWidth=null,this._minimumHeight=null,this.clickedTop=null,this.clickedLeft=null,this.clickedHeight=null,this.clickedWidth=null,this.image.style.top="0px",this.image.style.left="0px",this.lastImageX=0,this.lastImageY=0,this._currentScale=0,this.yRatio=.5,this.xRatio=.5,this.imageOriginalWidth=null,this.imageOriginalHeight=null},_destroyScrollElements:function(){this.mainScroll&&(this.mainScroll.destroy(),this.mainScroll=null),this._headerScroll&&(this._headerScroll.destroy(),this._headerScroll=null),this._footerScroll&&(this._footerScroll.destroy(),this._footerScroll=null)},_establishWidgetWidth:function(){this._widgetWidth=parseInt(this.el.clientWidth,10),this._widgetHeight=parseInt(this.el.clientHeight,10)},_minMax:function(a,b,c){return b>a?b:a>c?c:a},_getCSS:function(a,b){return parseFloat(window.getComputedStyle(a).getPropertyValue(b))},_onImgEnd:function(){},_setupAnimations:function(a,b,c){a.style.setProperty(PR.Core.prefix.css.transitionDuration,b+"ms"),a.style.setProperty(PR.Core.prefix.css.transitionProperty,c)},_getAvailableHeight:function(){var a=this._widgetHeight;return a-=parseInt(this._footerHeight,10),a-=parseInt(this._headerHeight,10)},_getAvailableWidth:function(){return this._widgetWidth},_getInitialImageScale:function(){var a,b=parseInt(this.image.width,10),c=parseInt(this.image.height,10),d=this._getAvailableWidth(),e=this._getAvailableHeight(),f=b/c,g=d/e;return g>f?(this.imageOrientation=FV_LANDSCAPE,a=e/c):(this.imageOrientation=FV_PORTRAIT,a=d/b),a},getCurrentScale:function(){return 0===this._currentScale&&(this._currentScale=this._getInitialImageScale()),this._currentScale},getCanZoom:function(){return this.imageOriginalHeight<this._maxAvailableHeight&&this.imageOriginalWidth<this._maxAvailableWidth?!1:!0}})),PR.Core.registerWidget("FlipWidget",PR.Core.widgets.BaseWidget.extend({className:"PR.FlipCard",el:null,currentFace:"card-front",transitionDuration:-1,front:function(){return this.el.querySelector(".front")},back:function(){return this.el.querySelector(".back")},init:function(a){if(!a)throw new Error("[HTML Element not attached for the Flip Widget.]");this.className="FlipWidget",this.el=a,this.id=a.id,this.isAndroid=PR.Core.CURRENT_APP_FRAMEWORK===PR.Core.AppFrameworks.ANDROID,!this.front(),!this.back(),this.el.className="card fixed card-front",this._super(),this.isAndroid&&this.androidInitFlip(),_.bindAll(this)},flip:function(a){var b;"undefined"!=typeof a&&(b=1===a?"card-back":"card-front",this.currentFace="card-front"===b?"card-back":"card-front"),this._onFlip()},_onScreenWidget:function(){this._super(),radio(PR.Event.PAGE_FLIP).subscribe([this._onFlip,this]),this._broadcastElementVisibility()},_offScreenWidget:function(){"card-front"!==this.currentFace&&this.flip(-1),this._super(),this._broadcastElementVisibility(),radio(PR.Event.PAGE_FLIP).unsubscribe([this._onFlip,this])},_onFlip:function(a){var b=9===PR.utils.getInternetExplorerVersion();if((!a||this._isEventReferToMe(a))&&!this.flipping){if(this.onEndFlipTimeoutId&&clearTimeout(this.onEndFlipTimeoutId),"undefined"!=typeof event&&this._reportFlipEvent(),this.isAndroid)return void this.androidFlip();if(b)return void this.ie9Flip();this.flipping=!0,this.el.addEventListener(PR.Core.prefix.js.transitionEnd,this._onEndFlip,!1),this.el.className="card intermediate "+this.currentFace,this._initFace(this.front()),this._initFace(this.back()),_.defer(_.bind(function(){this._applyFlip();var a=1e3;setTimeout(function(){this.flipping&&this._onEndFlip({target:this.front()})}.bind(this),a+10)},this)),PR.Core.disableGPU()}},_applyFlip:function(){this.currentFace="card-front"===this.currentFace?"card-back":"card-front",this.el.className="card flipping "+this.currentFace,this.emit(PR.WIDGET_EVENTS.FLIP_START)},_onEndFlip:function(a){(a.target===this.front()||a.target===this.back())&&(this.flipping=!1,this.el.removeEventListener(PR.Core.prefix.js.transitionEnd,this._onEndFlip,!1),this.isAndroid?this.onEndFlipTimeoutId=setTimeout(this._onFlipComplete,350):this._onFlipComplete())},_onFlipComplete:function(){this.el.className="card fixed "+this.currentFace,this._resetFace(this.front()),this._resetFace(this.back()),this._broadcastElementVisibility(),PR.Core.enableGPU(),this.emit(PR.WIDGET_EVENTS.FLIP_END,{eventPhase:2})},_reportFlipEvent:function(){var a={};a.eventAction=this.el.getAttribute("id"),a.eventCategory="Flip",radio(PR.Event.APP_NOTIFY_EVENT).broadcast("reporting://"+JSON.stringify(a))},_initFace:function(a){var b=window.scrollY||document.body.scrollTop,c=PR.Core.cumulativeOffset(a).top,d=window.innerHeight;b-=c,this.el.offsetHeight>=d&&(_.each(a.children,function(a){a.style.marginTop=-b+"px"}),a.style.overflow="hidden",a.style.marginTop=b+"px",a.style.height=d+"px"),this.transitionDuration>=0&&a.style.setProperty(PR.Core.prefix.css.transitionDuration,this.transitionDuration+"ms")},_resetFace:function(a){_.each(a.children,function(a){a.style.marginTop=""}),a.style.overflow="",a.style.marginTop="",a.style.height="",this.transitionDuration>=0&&a.style.setProperty(PR.Core.prefix.css.transitionDuration,"")},_broadcastElementVisibility:function(){var a,b,c=this.front(),d=this.back();"card-back"===this.currentFace?(a=d,b=c):(a=c,b=d),a?(radio(PR.Event.ELEMENT_VISIBLE).broadcast({id:a.id}),PR.Core.triggerElementVisible(a)):b&&(radio(PR.Event.ELEMENT_NOT_VISIBLE).broadcast({id:b.id}),PR.Core.triggerElementNotVisible(b))},androidInitFlip:function(){var a=_.bind(function(){PR.utils.removeClass(this.back(),"no-transition")},this);this.el.className="card androidFlip",PR.utils.addClass(this.back(),"no-transition"),_.defer(_.bind(function(){PR.utils.addClass(this.back(),"flipUp"),_.defer(a)},this))},androidFlip:function(){var a=null,b=_.bind(function(){a="card-front"===this.currentFace?this.front():this.back(),PR.utils.addClass(a,"flipUp"),setTimeout(c,200)},this),c=_.bind(function(){this.currentFace="card-front"===this.currentFace?"card-back":"card-front",a="card-front"===this.currentFace?this.front():this.back(),PR.utils.removeClass(a,"flipUp")},this);b()},ie9Flip:function(){var a="card-front"===this.currentFace?this.front():this.back(),b="card-front"===this.currentFace?this.back():this.front();this.el.className="card intermediate"+this.currentFace,a.style.zIndex=10,b.style.zIndex=0,a&&PR.Transitions.fade({target:a,from:1,to:0,duration:250,endCallBack:_.bind(function(){this.currentFace="card-front"===this.currentFace?"card-back":"card-front",a.style.opacity=1,b.style.zIndex=10,a.style.zIndex=0,this.el.className="card fixed "+this.currentFace,this._broadcastElementVisibility(),PR.Core.enableGPU(),this.emit(PR.WIDGET_EVENTS.FLIP_END,{eventPhase:2})},this)})}})),function(a){"use strict";var b=function(b){this.el=b,this.actions=null;try{b.dataset.action&&(this.actions=a.Core.widgets.Button.create(b))}catch(c){}};b.prototype.show=function(){this.el.style.display="block"},b.prototype.hide=function(){this.el.style.display="none"},b.prototype.trigger=function(){return this.actions?void this.actions._onTap():!1};var c=function(){this.slideArray=[],this.length=0};c.prototype.get=function(a){return this.slideArray[a]},c.prototype.set=function(a,b){this.slideArray[a]=b},c.prototype.push=function(a){this.slideArray.push(new b(a)),this.length=this.slideArray.length},c.prototype.reset=function(a){this.slideArray=[],this.lenght=0},a.Core.registerWidget("Image360Widget",a.Core.widgets.BaseWidget.extend({className:"Image360Widget",autoplay:"false",_autoRotateAngle:5,autoRotateSpeed:20,_autoSpinTimer:null,autoSpins:0,_bounds:[],_currentAngle:0,lastAngle:0,swipeDirection:!0,_currentImagePos:0,loopCount:1,_startTouchPos:0,_startAngle:0,el:null,wrapper:null,container:null,slidesCount:0,slides:null,init:function(a){if(!a)throw new Error("The el is not specified [Image360Widget]");this.el=a,this.id=a.getAttribute("id"),this._super(),this.isTouchInteractive=!0,_.bindAll(this),this._initDefaultProps(),this._initVars(),this._updateRotate(),this.slides.get(0).show()},_initVars:function(){if(this.container=this.el.querySelector("ul"),!this.container)throw new Error("[UL element not found in Image360Widget]");if(this.slides=new c,this.images=this.el.querySelectorAll("img"),_.each(this.el.querySelectorAll("li"),this.slides.push,this.slides),this.slidesCount=this.slides.length-1,this.slidesCount<0)throw new Error("[LI elements not found in Image360Widget]");this._bounds.push(this.el.offsetWidth),this._bounds.push(this.el.offsetHeight)},_onInteractionStart:function(b){b.touches&&b.touches.length>1||(b.preventDefault(),this.touchInteraction!==!1&&this.userInteraction!==!1&&(radio(a.Event.APP_SCROLL_EVENT).broadcast(!1),this._startAngle=this._currentAngle,this._startTouchPos=a.utils.getEventPosition(b)[0],window.clearInterval(this._autoSpinTimer),a.utils.isWindowsTablet()&&a.utils.isChromeTouch()&&(document.addEventListener(a.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_MOVE,this._onInteractionMove),document.addEventListener(a.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_END,this._onInteractionEnd)),document.addEventListener(a.INTERACTION_EVENTS.INTERACTION_MOVE,this._onInteractionMove),document.addEventListener(a.INTERACTION_EVENTS.INTERACTION_END,this._onInteractionEnd)))},_onInteractionMove:function(b){var c=a.utils.getEventPosition(b)[0],d=this._startTouchPos-c,e=2*this._bounds[0]/360*d;this.reverseDirection===!0&&(e=-1*e),this.swipeDirection=this.getSwipeDirection(e),this.lastAngle=e,this._currentAngle=this.wrapAngle(this._startAngle+e),this._updateRotate()},_onInteractionEnd:function(b){b.preventDefault(),radio(a.Event.APP_SCROLL_EVENT).broadcast(!0),radio(a.Event.APP_NOTIFY_EVENT).broadcast("jstap://"+this.id),a.utils.isWindowsTablet()&&a.utils.isChromeTouch()&&(document.removeEventListener(a.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_MOVE,this._onInteractionMove),document.removeEventListener(a.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_END,this._onInteractionEnd)),document.removeEventListener(a.INTERACTION_EVENTS.INTERACTION_MOVE,this._onInteractionMove),document.removeEventListener(a.INTERACTION_EVENTS.INTERACTION_END,this._onInteractionEnd)},_onAutoRotateTimer:function(){var a=this._currentAngle;this._currentAngle=this.wrapAngle(a+this._autoRotateAngle),a>this._currentAngle&&(this.autoSpins=this.autoSpins+1),this.autoSpins<this.loopCount?this._updateRotate():(this._currentAngle=0,this._updateRotate(),clearInterval(this._autoSpinTimer))},_onElementVisible:function(a){(!a||this._isEventReferToMe(a))&&(this._super(),this.autoplay===!0&&this.autoRotate())},_onElementNotVisible:function(a){(!a||this._isEventReferToMe(a))&&(this._super(a),this.autoplay===!0&&(this.autoSpins=0,clearInterval(this._autoSpinTimer)))},_onScreenWidget:function(){this.isOnScreen||(this._super(),this._addInteractionEvents(),this._subscribeEvents(),this._updateRotate(),9===a.utils.getInternetExplorerVersion()?this.preloadImages(this.autoplay===!0?this.autoRotate:_.noop):this.autoplay!==!0||a.utils.hasAncestorWidgetPopup(this.el)||this.autoRotate())},_offScreenWidget:function(){this.isOnScreen&&(this._super(),this.autoSpins=0,this._currentAngle=0,this._updateRotate(),this._removeInteractionEvents(),this._unSubscribeEvents())},_getBounds:function(){return this._bounds},_updateRotate:function(){var a=this._currentImagePos;if(this._currentImagePos=this.getCurrentImagePosition(),a!==this._currentImagePos)try{this.slides.get(a).hide(),this.slides.get(this._currentImagePos).show(),this.triggerEvents(this.getMoveRange(a,this._currentImagePos))}catch(b){}},_addInteractionEvents:function(){a.utils.isWindowsTablet()&&a.utils.isChromeTouch()&&this.el.addEventListener(a.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_START,this._onInteractionStart,!0),this.el.addEventListener(a.INTERACTION_EVENTS.INTERACTION_START,this._onInteractionStart,!0)},_removeInteractionEvents:function(){a.utils.isWindowsTablet()&&a.utils.isChromeTouch()&&this.el.removeEventListener(a.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_START,this._onInteractionStart,!0),this.el.removeEventListener(a.INTERACTION_EVENTS.INTERACTION_START,this._onInteractionStart,!0)},_subscribeEvents:function(){radio(a.Event.ON_ZOOM).subscribe([this.onZoom,this])},_unSubscribeEvents:function(){radio(a.Event.ON_ZOOM).unsubscribe([this.onZoom,this])},onZoom:function(a){a?this._removeInteractionEvents():this._addInteractionEvents()},autoRotate:function(){this._autoSpinTimer=setInterval(this._onAutoRotateTimer,this.autoRotateSpeed)},triggerEvents:function(a){var b=_.bind(function(c){c>a.length-1||(this.slides.get(a[c]).trigger(),_.defer(b,c+1))},this);b(0)},getCurrentImagePosition:function(){var a=this._currentAngle/(360/this.slidesCount);return 0>a&&(a=0),a>=this.slidesCount&&(a=this.slidesCount-1),Math.round(a)},wrapAngle:function(a){return(a%360+360)%360},getSwipeDirection:function(a){return this.lastAngle>a?!1:!0},getMoveRange:function(a,b){var c,d=[];if(this.swipeDirection&&a>b||!this.swipeDirection&&b>a){if(!this.swipeDirection){for(c=b;c<=this.slidesCount;c+=1)d.unshift(c);for(c=0;a-1>=c;c+=1)d.unshift(c);return d}for(c=a+1;c<=this.slidesCount;c+=1)d.push(c);for(c=0;b>=c;c+=1)d.push(c);return d}if(this.swipeDirection){for(c=a+1;b>=c;c+=1)d.push(c);return d}for(c=b;(a>0?a-1:0)>=c;c+=1)d.unshift(c);return d},preloadImages:function(b){var c,d,e,f=0,g=[];for(c=_.bind(function(a){f<this.slidesCount?(g[f].removeEventListener("load",c),f+=1):b()},this),d=_.bind(function(b){a.log("There was an error loading an image",a.log.WARN),c(b)}),e=0;e<=this.slidesCount;e+=1)g[e]=new Image,g[e].onload=c,g[e].onerror=d,g[e].src=this.images[e].src},exposeSlideConstructor:function(){return b}}))}(this.PR),PR.Core.registerWidget("ImageEffectsWidget",PR.Core.widgets.BaseWidget.extend({className:"ImageEffects",startOffsetX:0,startOffsetY:0,startScale:0,startAngle:0,endOffsetX:0,endOffsetY:0,endScale:0,endAngle:0,parentVisible:null,transition:"PanAndZoom",transitionDuration:600,el:null,imgEl:null,currentActor:null,unit:"px",init:function(a){if(!a)throw new Error("HTML Element not attached.");this.el=a,this._imgEl=this.el.querySelector("img"),_.bindAll(this),this._super(a),this.mixin(PR.Actor.create()),this._getDataAttributes(),this._imgEl.style.left=0,this._imgEl.style.top=0,"%"===this.unit&&(this.startOffsetX=this.startOffsetX+"%",this.startOffsetY=this.startOffsetY+"%"),this.currentActor=this.actor({element:this._imgEl,reset:{opacity:1,scale:{x:this.startScale,y:this.startScale},position:{x:this.startOffsetX,y:this.startOffsetY},rotation:this.startAngle}}),this._positionImageForStart(),setTimeout(function(){this.initialOpacity="number"==typeof this.initialOpacity?this.initialOpacity:1,this.el.style.opacity=this.initialOpacity>1?this.initialOpacity/100:this.initialOpacity}.bind(this))},_onScreenWidget:function(){this._super(),PR.utils.hasAncestorWidgetPopup(this.el)||setTimeout(function(){this._startTransition()}.bind(this),50)},_offScreenWidget:function(){this._super(),this._removeTransform()},_onElementVisible:function(a){(!a||this._isEventReferToMe(a))&&(this._super(a),this._startTransition(a))},_onElementNotVisible:function(a){(!a||this._isEventReferToMe(a))&&(this._super(a),this._resetImage(a),this._removeTransform())},_getDataAttributes:function(){_.each(PR.utils.createDataset(this.el),function(a,b){this[b]=a},this),"string"==typeof this.startOffsetX&&-1!==this.startOffsetX.search("%")&&(this.unit="%"),this.startOffsetX=0-parseInt(this.startOffsetX),this.startOffsetY=0-parseInt(this.startOffsetY),this.endOffsetX=0-parseInt(this.endOffsetX),this.endOffsetY=0-parseInt(this.endOffsetY)},_positionImageForStart:function(){this._imgEl.style.position="absolute",this._imgEl.style.transformOrigin="0 0",this.currentActor.reset()},_startTransition:function(a){var b="undefined"==typeof a?null:a.id;this._shouldApplyTransform(b)&&this.currentActor.reset(this._executeTransform)},_executeTransform:function(){this.currentActor.move(this.endOffsetX,this.endOffsetY,this.unit).scale(this.endScale,this.endScale).rotate(this.endAngle).duration(this.transitionDuration).end()},_resetImage:function(a){var b="undefined"==typeof a?null:a.id;this._shouldApplyTransform(b)&&this._removeTransform()},_removeTransform:function(){this.currentActor.reset()},_shouldApplyTransform:function(a){if(null!==this.parentVisible){var b=this._findAncestorWithId(this._imgEl,a);return b!==!1?!0:!1}return!0},_findAncestorWithId:function(a,b){for(;a.parentNode;)if(a=a.parentNode,a.id===b)return a;return!1}})),PR.Core.registerWidget("ImageEnlargeWidget",PR.Core.widgets.BaseWidget.extend({className:"ImageEnlargeWidget",src:"",_backgroundModal:null,pageContainer:null,image:null,el:null,gutter:10,init:function(a){if(!a)throw new Error("The el is not specified [ImageEnlargeWidget]");if(this.el=a,this.id=a.getAttribute("id"),this._super(),_.bindAll(this),this.pageContainer=document.querySelector(".page"),this.pageContainer&&(this._initDefaultProps(),!this.src))throw new Error("The image url not specified for [ImageEnlargeWidget] .")},_onInteractionStart:function(a){var b=a.changedTouches?a.changedTouches[0]:a;this._downPoint={x:b.pageX,y:b.pageY},this._removeInteractionEvents(),window.addEventListener(PR.INTERACTION_EVENTS.INTERACTION_END,this._onInteractionEnd)},_onInteractionEnd:function(a){window.removeEventListener(PR.INTERACTION_EVENTS.INTERACTION_END,this._onInteractionEnd);var b=a.changedTouches?a.changedTouches[0]:a,c={x:b.pageX,y:b.pageY};Math.abs(c.x-this._downPoint.x)<5&&Math.abs(c.y-this._downPoint.y)<5?(radio(PR.Event.APP_NOTIFY_EVENT).broadcast("jstap://imageEnlarge"),a.preventDefault(),a.stopImmediatePropagation(),this.image=this._createImage(this.src)):this._addInteractionEvents()},_onDocumentClick:function(a){radio(PR.Event.APP_NOTIFY_EVENT).broadcast("jstap://imageEnlarge"),a.preventDefault(),a.stopImmediatePropagation(),this.pageContainer.removeEventListener("click",this._onDocumentClick,!0),document.removeEventListener(PR.INTERACTION_EVENTS.INTERACTION_MOVE,this._onTouchMove,!0),PR.utils.removeClass(this._backgroundModal,"semi-transparent"),PR.utils.addClass(this._backgroundModal,"transparent"),this.animateScaleIn()},_onTouchMove:function(a){a.preventDefault()},_onScaleInEnd:function(a){this.image.removeEventListener(PR.Core.prefix.js.transitionEnd,this._onScaleInEnd),this.removeModalPopup(),this._addInteractionEvents()},_onScaleOutEnd:function(a){this.image.removeEventListener(PR.Core.prefix.js.transitionEnd,this._onScaleOutEnd),this.pageContainer.addEventListener("click",this._onDocumentClick,!0),document.addEventListener(PR.INTERACTION_EVENTS.INTERACTION_MOVE,this._onTouchMove,!0)},_onLoad:function(a){var b=this,c=PR.Core.BrowserSniff.FIREFOX?50:1,d=a.currentTarget;d.removeEventListener("load",this._onLoad),this._backgroundModal=this._createBackgroundModal(),this.pageContainer.appendChild(this._backgroundModal),this.pageContainer.appendChild(this.image),this.image.style.setProperty(PR.Core.prefix.css.transform,this.calculateScaleIn()),this.image.style.visibility="visible",_.delay(function(){b.animateScaleOut()},c)},_onScreenWidget:function(){this.isOnScreen||(this._super(),this._addInteractionEvents())},_onElementVisible:function(a){(!a||this._isEventReferToMe(a))&&this._addInteractionEvents()},_onElementNotVisible:function(a){(!a||this._isEventReferToMe(a))&&this._removeInteractionEvents()},_offScreenWidget:function(){this.isOnScreen&&(this._super(),this._removeInteractionEvents())},_createBackgroundModal:function(){var a=document.createElement("div");return a.setAttribute("id","modalBackground"),PR.utils.addClass(a,"modalBackdrop"),PR.utils.addClass(a,"transitionOpacity"),PR.utils.addClass(a,"transparent"),a},_createImage:function(a){var b=document.createElement("img");return PR.utils.addClass(b,"imageEnlarge"),PR.utils.addClass(b,"box-shadow"),b.addEventListener("load",this._onLoad),b.setAttribute("src",a),b},calculateScaleIn:function(){var a=this.image.offsetWidth,b=this.image.offsetHeight,c=this.el.getBoundingClientRect(),d=(c.width-this.gutter)/a,e=(c.height-this.gutter)/b,f=e>d?d:e;return"translate3d("+(c.left+c.width/2-a/2)+"px, "+(c.top+c.height/2-b/2)+"px, 0px)scale3d("+f+","+f+",1)"},calculateScaleOut:function(){var a=this.image.offsetWidth,b=this.image.offsetHeight,c=PR.utils.getScreenDimensions(),d=c[0],e=c[1],f=0;PR.Core.containingFrame&&(f=window.scrollY||document.body.scrollTop);var g=(d-this.gutter)/a,h=(e-this.gutter)/b,i=h>g?g:h;return i=i>1?1:i,PR.Core.containingFrame?"translate3d("+(d/2-a/2)+"px, "+(e/2-b/2+f)+"px, 0px)scale3d("+i+","+i+",1)":"translate3d("+(d/2-a/2)+"px, "+(e/2-b/2)+"px, 0px)scale3d("+i+","+i+",1)"},animateScaleIn:function(){this.image.addEventListener(PR.Core.prefix.js.transitionEnd,this._onScaleInEnd),PR.utils.addClass(this.image,"transitionOpacityTransform"),this.image.style.setProperty(PR.Core.prefix.css.transform,this.calculateScaleIn()),this.image.style.opacity=0},animateScaleOut:function(){PR.utils.addClass(this.image,"transitionTransform"),this.image.style.setProperty(PR.Core.prefix.css.transform,this.calculateScaleOut()),PR.Core.CURRENT_APP_FRAMEWORK===PR.Core.AppFrameworks.ANDROID?this.image.addEventListener(PR.Core.prefix.js.transitionEnd,this._onScaleOutEnd):(this.pageContainer.addEventListener("click",this._onDocumentClick,!0),document.addEventListener(PR.INTERACTION_EVENTS.INTERACTION_MOVE,this._onTouchMove,!0))},removeModalPopup:function(){this.pageContainer.removeChild(this.image),this.pageContainer.removeChild(this._backgroundModal)},_addInteractionEvents:function(){this.el.addEventListener(PR.INTERACTION_EVENTS.INTERACTION_START,this._onInteractionStart)},_removeInteractionEvents:function(){this.el.removeEventListener(PR.INTERACTION_EVENTS.INTERACTION_START,this._onInteractionStart),window.removeEventListener(PR.INTERACTION_EVENTS.INTERACTION_END,this._onInteractionEnd)},destroy:function(){this.el=null},toString:function(){return this.className+"\ndata-src :: "+this.src}})),PR.Core.registerWidget("PictureZoomWidget",PR.Core.widgets.BaseWidget.extend({className:"PictureZoomWidget",_startX:null,_startY:null,_doubleTapTimer:null,_swipePos:{x:null,y:null},_screenX:null,_swipeDist:30,_pageSwipe:!1,el:null,isAllowFullScreen:!1,image:null,imageContainerDiv:null,imageOffsetX:0,imageOffsetY:0,imageScroll:null,previewImage:null,pan:!0,isZoom:!1,isVariableOutput:!1,init:function(a){if(_.bindAll(this),!a)throw new Error("HTML Element not attached.");this._super(),_.bindAll(this),this.el=a,PR.utils.addClass(this.el,"PR_PictureZoomWidget"),this._initVars()},_initVars:function(){var a=PR.utils.createDataset(this.el);this.previewImage=this.el.getElementsByTagName("img")[0];var b=window.getComputedStyle(this.previewImage);"absolute"!==b.position&&(this.previewImage.style.position="relative");var c="px";if("string"==typeof a.offsetX&&-1!==a.offsetX.search("%")&&(this.isVariableOutput=!0,c=""),this.previewImage.style.top=a.offsetY+c,this.previewImage.style.left=a.offsetX+c,this.imageSource=a.src,!this.imageSource)throw new Error("The source for the large image is not specified.");this.offsetX=a.offsetX||a.offsetx,this.offsetY=a.offsetY||a.offsety,this.isZoom=a.zoom,this.isAllowFullScreen=a.allowFullscreen,
this.pan=a.panning},_onInteractionStart:function(a){return this.pan===!1?!0:((0===this.imageScroll.x||this.imageScroll.x===this.imageScroll.maxScrollX)&&(this._pageSwipe=!0),this._screenX=this.getTouchX(a),this._swipePos.x=this.imageScroll.x,this._swipePos.y=this.imageScroll.y,document.addEventListener(PR.INTERACTION_EVENTS.INTERACTION_MOVE,this._onInteractionMove),void document.addEventListener(PR.INTERACTION_EVENTS.INTERACTION_END,this._onInteractionEnd))},_onInteractionMove:function(a){this.imageScroll.x<0&&this.imageScroll.x>this.imageScroll.maxScrollX&&(this._pageSwipe=!1),(this.imageScroll.y>this._swipePos.y+this._swipeDist||this.imageScroll.y<this._swipePos.y-this._swipeDist)&&(this._pageSwipe=!1)},_onInteractionEnd:function(a){(this._screenX>this.getTouchX(a)+this._swipeDist||this._screenX<this.getTouchX(a)-this._swipeDist)&&(PR.Core.isZoom||(this._pageSwipe&&0===this.imageScroll.x&&radio(PR.Event.NAVIGATE_PREVIOUS_PAGE).broadcast(),this._pageSwipe&&this.imageScroll.x===this.imageScroll.maxScrollX&&radio(PR.Event.NAVIGATE_NEXT_PAGE).broadcast())),radio(PR.Event.APP_NOTIFY_EVENT).broadcast("jstap://"+this.el.id),document.removeEventListener(PR.INTERACTION_EVENTS.INTERACTION_MOVE,this._onInteractionMove),document.removeEventListener(PR.INTERACTION_EVENTS.INTERACTION_END,this._onInteractionEnd)},_onDblTap:function(a){radio(PR.Event.APP_SCROLL_EVENT).broadcast(!0);var b=this;if(this._doubleTapTimer){var c=a.changedTouches[0].screenX,d=a.changedTouches[0].screenY,e=PR.utils.lineDistance(this._startX,this._startY,c,d);clearTimeout(this._doubleTapTimer),this._doubleTapTimer=this._startX=this._startY=null,30>e&&radio(PR.Event.APP_NOTIFY_EVENT).broadcast("openImage://"+this.imageSource)}else this._startX=a.changedTouches[0].screenX,this._startY=a.changedTouches[0].screenY,this._doubleTapTimer=setTimeout(function(){radio(PR.Event.APP_SCROLL_EVENT).broadcast(!0),b._doubleTapTimer=null,a.preventDefault()},450)},_onDblClick:function(){radio(PR.Event.APP_NOTIFY_EVENT).broadcast("openImage://"+this.imageSource)},_onLoad:function(a){PR.utils.addClass(this.el,"scrollZone hideScrollbars"),this.pan===!0||this.isZoom===!0?(this.el.appendChild(this.imageContainerDiv),this.previewImage.style.display="none",this._allowFullScreenEventCheck(this.image),this.createIScroll()):this._allowFullScreenEventCheck(this.previewImage)},_allowFullScreenEventCheck:function(a){if(this.isAllowFullScreen===!0)if(PR.utils.isWindowsTablet()&&PR.utils.isChromeTouch())a.addEventListener("dblclick",this._onDblClick,!0),a.addEventListener("touchend",this._onDblTap,!0);else{var b=this.hasTouch?"touchend":"dblclick";this.hasTouch?a.addEventListener(b,this._onDblTap,!0):a.addEventListener(b,this._onDblClick,!0)}},_onPageResize:function(a){this.imageContainerDiv.style.width=this.el.offsetWidth+"px",this.imageContainerDiv.style.height=this.el.offsetHeight+"px";var b=parseInt(this.offsetX)/100*this.el.offsetWidth,c=parseInt(this.offsetY)/100*this.el.offsetHeight;this.imageScroll.refresh(),this.imageScroll.scrollTo(b,c,0)},createIScroll:function(){this.imageScroll=new IScroll(this.imageContainerDiv,{zoom:this.isZoom,doubleTapZoom:null,handleClick:!1,directionLockThreshold:100,bounce:!1,zoomMin:this.el.offsetWidth/this.image.width,startZoom:1,scrollbars:!0,scrollX:this.pan,scrollY:this.pan}),this.imageContainerDiv.style.cursor="move",this.imageScroll.on("scrollStart",this._onScrollStart),this.imageScroll.on("scrollEnd",this._onScrollEnd),this.imageScroll.on("zoomStart",this._onScrollStart),this.imageScroll.on("zoomEnd",this._onScrollEnd);var a=0,b=0;this.isVariableOutput?(a=parseInt(this.offsetX)/100*this.el.offsetWidth,b=parseInt(this.offsetY)/100*this.el.offsetHeight):(a=this.offsetX&&this.offsetX<=0?this.offsetX:0,b=this.offsetY&&this.offsetY<=0?this.offsetY:0),this.imageScroll.scrollTo(a,b,0)},_onScrollStart:function(a){PR.utils.addClass(this.el,"scrolling"),radio(PR.Event.APP_SCROLL_EVENT).broadcast(!1)},_onScrollEnd:function(a){PR.utils.removeClass(this.el,"scrolling"),radio(PR.Event.APP_SCROLL_EVENT).broadcast(!0)},_onScreenWidget:function(){this._super(),this.el.addEventListener(PR.INTERACTION_EVENTS.INTERACTION_START,this._onInteractionStart,!0),this.isVariableOutput&&radio(PR.Event.ON_RESIZE).subscribe([this._onPageResize,this]),radio(PR.Event.APP_SCROLL_EVENT).broadcast(!0),this.imageContainerDiv||this._initImageContainer()},_offScreenWidget:function(){this._super(),this.el.removeEventListener(PR.INTERACTION_EVENTS.INTERACTION_START,this._onInteractionStart,!0),this.isVariableOutput&&radio(PR.Event.ON_RESIZE).unsubscribe([this._onPageResize,this])},_createImageWithContainer:function(a){var b=document.createElement("div");b.style.width=this.el.offsetWidth+"px",b.style.height=this.el.offsetHeight+"px",this.isVariableOutput&&(b.style.left="0px",b.style.top="0px",b.style.position="absolute");var c=document.createElement("img");return c.addEventListener("load",this._onLoad),c.setAttribute("src",a),b.appendChild(c),b},_initImageContainer:function(){this.imageContainerDiv=this._createImageWithContainer(this.imageSource),this.image=this.imageContainerDiv.firstChild,this.isVariableOutput?(this.image.style.width=this.previewImage.width/this.el.offsetWidth*100+"%",this.image.style.height=this.previewImage.height/this.el.offsetHeight*100+"%"):(isNaN(parseFloat(this.previewImage.width,10))||(this.image.width=this.previewImage.width),isNaN(parseFloat(this.previewImage.height,10))||(this.image.height=this.previewImage.height))},getTouchX:function(a){return this.hasTouch?a.changedTouches[0].screenX:a.screenX}})),PR.Core.registerWidget("PopupViewer",PR.Core.widgets.BaseWidget.extend({className:"PopupViewer",el:"null",transitionDuration:"600",visible:!1,zIndexPosition:1e3,init:function(a){if(!a)throw new Error("HTML Element not attached.");this._super(),_.bindAll(this),this.el=a,this.id=a.getAttribute("id");var b=a.getAttribute("data-visible");PR.Core.disableGPU(),b?this.visible=!0:(PR.utils.addClass(this.el,"hiddenPopup"),PR.utils.addClass(this.el,"visibilityHidden")),PR.utils.addClass(this.el,"transitionOpacity"),this.setzIndex("auto"),radio(PR.Event.TOGGLE_POPUP).subscribe([this.togglePopUp,this]),radio(PR.Event.SHOW_POPUP).subscribe([this.showPopup,this]),radio(PR.Event.HIDE_POPUP).subscribe([this.hidePopup,this])},showPopup:function(a){if(this._isEventReferToMe(a)&&this.visible!==!0){PR.utils.removeClass(this.el,"offscreenPopupOffset"),PR.utils.removeClass(this.el,"displayPopupNone"),this.setzIndex();var b="layer://"+this.el.getAttribute("data-layer");radio(PR.Event.APP_NOTIFY_EVENT).broadcast(b),PR.Core.disableGPU(),_.defer(this.showPopupDefered)}},showPopupDefered:function(){PR.Core.disableGPU(),PR.utils.removeClass(this.el,"visibilityHidden"),PR.utils.removeClass(this.el,"hiddenPopup"),this.visible=!0,this.showPopupElements()},hidePopup:function(a){if(this._isEventReferToMe(a)){if(this.visible!==!0)return;this.visible=!1,PR.utils.addClass(this.el,"hiddenPopup"),PR.utils.addClass(this.el,"visibilityHidden");var b="layer://"+this.el.getAttribute("data-layer");radio(PR.Event.APP_NOTIFY_EVENT).broadcast(b),this.hidePopupElements(),PR.Core.disableGPU()}},hidePopupElements:function(){PR.Core.triggerElementNotVisible(this.el),this.setzIndex("auto"),PR.Core.enableGPU(),_.defer(function(){PR.utils.addClass(this.el,"displayPopupNone")}.bind(this))},showPopupElements:function(){PR.Core.triggerElementVisible(this.el),PR.Core.enableGPU()},togglePopUp:function(a){this._isEventReferToMe(a)&&(this.visible?this.hidePopup(a):this.showPopup(a))},setzIndex:function(a){this.el.style.zIndex=a||this.zIndexPosition},_onScreenWidget:function(){this._super(),this.visible?PR.Core.triggerElementVisible(this.el):PR.utils.addClass(this.el,"offscreenPopupOffset")},_offScreenWidget:function(){this._super();var a=PR.utils.createDataset(this.el);a.target=this._isValidTarget(a),a.visible?this.showPopup(a):(this.hidePopup(a),this.hidePopupElements(),this.visible=!1)},_isValidTarget:function(a){return"boolean"==typeof a.target?void 0:a.target}})),PR.Core.registerWidget("ModalPopupWidget",PR.Core.widgets.PopupViewer.extend({className:"ModalPopupWidget",content:null,contents:null,popup:null,dataset:null,zIndexPosition:900,headerBarHeight:50,init:function(a){if(!a)throw new Error("HTML Element not attached");_.bindAll(this),this.popup=this.createMasterPopup(),this.contents=this.createContents(),this.content=a,this.el=a,this.id=a.id,this.dataset=_.extend({autoclose:!0,screenScroll:!1},PR.utils.createDataset(a)),PR.utils.addClass(this.content,"modalContent displayPopupNone"),this.dataset.screenScroll&&PR.utils.addClass(this.content,"screenScrollable"),this._super(this.popup)},createMasterPopup:function(){return document.querySelector("#modalPopup")||_.bind(function(){var a;return a=PR.utils.createElement(PR.Templates.modal()),document.body.appendChild(a),a},this)()},createContents:function(){return document.querySelector("#modalContents")||_.bind(function(){var a;return a=PR.utils.createElement('<div id="modalContents" class="displayNone"></div>'),document.body.appendChild(a),a},this)()},destroy:function(){this.popup.querySelector(".modalBackdrop").removeEventListener("click",this.hideMaster),this._super()},showPopup:function(a){a.target===this.content.id&&(this.popup.appendChild(this.content),this._super({target:"modalPopup"}),_.defer(this.showContent),this.dataset.screenScroll||radio(PR.Event.ON_RESIZE).subscribe(this.positionContent),this.popup.querySelector(".modalBackdrop").addEventListener(PR.INTERACTION_EVENTS.INTERACTION_START,this.hideMaster))},hidePopup:function(a){a.target!==this.content.id&&"modalPopup"!==a.target||!this.visible||(PR.utils.containsWidget(this.content,"POPUP")&&this.hideNestedPopups(this.content),PR.utils.addClass(this.content,"hiddenPopup displayPopupNone"),this.contents.appendChild(this.content),this._super({target:"modalPopup"}),radio(PR.Event.ON_RESIZE).unsubscribe(this.positionContent),this.popup.querySelector(".modalBackdrop").removeEventListener(PR.INTERACTION_EVENTS.INTERACTION_START,this.hideMaster),radio(PR.Event.ELEMENT_NOT_VISIBLE).broadcast({id:this.content.id}),PR.Core.triggerElementNotVisible(this.content))},hideNestedPopups:function(a){[].forEach.call(a.querySelectorAll(" [data-widget=POPUP]"),function(a){PR.Core.getWidgetById(a.id).onHideTransitionEnd({eventPhase:2})})},_offScreenWidget:function(){this._super(),this.hidePopup({target:this.content.id})},hideMaster:function(a){this.dataset.autoclose!==!1&&this.dataset.autoclose&&radio("HIDE_POPUP").broadcast({target:"modalPopup"})},showContent:function(){PR.utils.removeClass(this.content,"hiddenPopup displayPopupNone visibilityHidden"),this.positionContent()},positionContent:function(){var a,b,c,d=(window.scrollX||document.body.scrollLeft,window.scrollY||document.body.scrollTop);b={width:window.innerWidth,height:window.innerHeight},a={width:this.content.offsetWidth,height:this.content.offsetHeight},c={x:Math.floor(b.width/2-a.width/2),y:Math.floor(b.height/2-a.height/2)},this.dataset.screenScroll&&(c.y=d+this.headerBarHeight),PR.utils.positionElement2d(this.content,c)}})),PR.Core.registerWidget("ScrollZoneWidget",PR.Core.widgets.BaseWidget.extend({className:"ScrollZoneWidget",_scrollInstance:void 0,_isAndroidApp:!1,_doesVerticalScroll:!1,_doesHorizontalScroll:!1,el:void 0,contentWrapperEl:void 0,scrollableContentEl:void 0,fadeHeight:"0",scrollbarh:!0,scrollbarv:!0,hideScrollbars:"false",arrows:"false",arrowImage:void 0,upArrowEl:void 0,downArrowEl:void 0,leftArrowEl:void 0,rightArrowEl:void 0,position:"Top or Left",startPos:{x:null,y:null},swipeDist:30,pageSwipe:!1,hasMoved:!1,init:function(a){if(!a)throw new Error("HTML Element not attached.");this._super(),_.bindAll(this),this._initVars(a),this.el.addEventListener(PR.INTERACTION_EVENTS.INTERACTION_START,this.onInteractionStart),this._createScroller()},_initVars:function(a){this.el=a,this.id=a.id,this.contentWrapperEl=a.children[0],this.scrollableContentEl=this.contentWrapperEl.children[0],this.scrollableContentEl.addEventListener("resize",this._onContentResize),this.scrollableContentEl.offsetHeight>this.contentWrapperEl.offsetHeight&&(this._doesVerticalScroll=!0),this.scrollableContentEl.offsetWidth>this.contentWrapperEl.offsetWidth&&(this._doesHorizontalScroll=!0);var b=PR.utils.createDataset(this.el);for(var c in b)("function"!=typeof b.hasOwnProperty||b.hasOwnProperty(c))&&(this[c]=b[c]);PR.utils.addClass(this.el,"scrollZone"),this.hideScrollbars===!0&&PR.utils.addClass(this.el,"hideScrollbars"),this._isAndroidApp=PR.Core.CURRENT_APP_FRAMEWORK===PR.Core.AppFrameworks.ANDROID&&!PR.params.webapp},_onScreenWidget:function(a){this._super(),this._subscribeEvents()},_offScreenWidget:function(){this._super(),this._unSubscribeEvents()},_subscribeEvents:function(){radio(PR.Event.ON_ZOOM).subscribe([this.onZoom,this])},_unSubscribeEvents:function(){radio(PR.Event.ON_ZOOM).unsubscribe([this.onZoom,this])},onZoom:function(a){a?this._scrollInstance.disable():this._scrollInstance.enable()},onInteractionStart:function(a){this._isAndroidApp&&radio(PR.Event.APP_SCROLL_EVENT).broadcast(!1),window.addEventListener(PR.INTERACTION_EVENTS.INTERACTION_MOVE,this.onInteractionMove,!1),window.addEventListener(PR.INTERACTION_EVENTS.INTERACTION_END,this.onInteractionEnd,!1)},onInteractionMove:function(a){var b=this._doesHorizontalScroll&&(0===this._scrollInstance.x||this._scrollInstance.x===this._scrollInstance.maxScrollX)||this._doesVerticalScroll&&(0===this._scrollInstance.y||this._scrollInstance.y===this._scrollInstance.maxScrollY);b?this._isAndroidApp&&radio(PR.Event.APP_SCROLL_EVENT).broadcast(!0):this._isAndroidApp||radio(PR.Event.APP_SCROLL_EVENT).broadcast(!1)},onInteractionEnd:function(a){radio(PR.Event.APP_SCROLL_EVENT).broadcast(!0),window.removeEventListener(PR.INTERACTION_EVENTS.INTERACTION_MOVE,this.onInteractionMove,!1),window.removeEventListener(PR.INTERACTION_EVENTS.INTERACTION_END,this.onInteractionEnd,!1)},_createScroller:function(){var a=this._doesHorizontalScroll,b=this._doesVerticalScroll;if(_.extend(this.el.style,{overflow:"unset"}),_.extend(this.contentWrapperEl.style,{overflow:"hidden"}),this._scrollInstance=new IScroll(this.contentWrapperEl,{bounce:!1,momentum:!0,scrollY:b,scrollX:a,lockDirection:!1,preventDefault:!1,mouseWheel:!0,scrollbars:this.scrollbarh&&this.scrollbarv,interactiveScrollbars:!0,useTransition:!1,probeType:3}),this.contentWrapperEl.addEventListener("mousewheel",this._mouseWheel),this.contentWrapperEl.addEventListener("DOMMouseScroll",this._mouseWheel),this.arrows===!0&&this._scrollInstance.on("scroll",this._scrollMove),this._scrollInstance.on("scrollStart",this._scrollStart),this._scrollInstance.on("scrollEnd",this._scrollEnd),this.arrows===!0&&(this._doesVerticalScroll&&(this.upArrowEl=this._createArrowElement(0,-22,0),this.el.appendChild(this.upArrowEl),this.downArrowEl=this._createArrowElement(0,this.el.offsetHeight+2,180),this.el.appendChild(this.downArrowEl)),this._doesHorizontalScroll&&(this.leftArrowEl=this._createArrowElement(this.el.offsetWidth-22,this.el.offsetHeight,270),this.el.appendChild(this.leftArrowEl),this.rightArrowEl=this._createArrowElement(0,this.el.offsetHeight,90),this.el.appendChild(this.rightArrowEl)),"Top or Left"===this.position?("undefined"!=typeof this.upArrowEl&&(this.upArrowEl.style.opacity=0),"undefined"!=typeof this.leftArrowEl&&(this.leftArrowEl.style.opacity=0),"undefined"!=typeof this.downArrowEl&&(this.downArrowEl.style.opacity=1),"undefined"!=typeof this.rightArrowEl&&(this.rightArrowEl.style.opacity=1)):"Bottom or Right"===this.position&&("undefined"!=typeof this.upArrowEl&&(this.upArrowEl.style.opacity=1),"undefined"!=typeof this.leftArrowEl&&(this.leftArrowEl.style.opacity=1),"undefined"!=typeof this.downArrowEl&&(this.downArrowEl.style.opacity=0),"undefined"!=typeof this.rightArrowEl&&(this.rightArrowEl.style.opacity=0))),"Bottom or Right"===this.position){var c=0-Math.abs(this.scrollableContentEl.offsetWidth),d=0-Math.abs(this.scrollableContentEl.offsetHeight-this.contentWrapperEl.offsetHeight);this._scrollInstance.scrollTo(c,d,0),_.defer(_.bind(function(){this._scrollInstance.refresh()},this))}},_enableGPU:function(){this._scrollInstance.translateZ=this._scrollInstanceTranslateZ,this._scrollInstance.scrollBy(0,0)},_disableGPU:function(){this._scrollInstanceTranslateZ=this._scrollInstance.translateZ,this._scrollInstance.translateZ="",this._scrollInstance.scrollBy(0,0)},_createArrowElement:function(a,b,c){var d=document.createElement("div");if(PR.utils.addClass(d,"arrowElement"),d.setAttribute("style","right:"+a+"px;top:"+b+"px;"),"undefined"!=typeof this.arrowImage){"undefined"==typeof c&&(c=0);var e=document.createElement("img");switch(PR.utils.addClass(e,"arrowImage"),d.appendChild(e),PR.utils.loadAsset(this.arrowImage,{success:function(a){e.setAttribute("src",a)},error:function(a){e.setAttribute("src",this.arrowImage)}}),c){case 90:PR.utils.addClass(e,"rotate90");break;case 180:PR.utils.addClass(e,"rotate180");break;case 270:PR.utils.addClass(e,"rotate270")}}return d},_scrollMove:function(a,b){b||(b={y:this._scrollInstance.y,x:this._scrollInstance.x});try{if(this._doesVerticalScroll){var c=Math.abs(b.y);1>c?this.upArrowEl.style.opacity=0:this.upArrowEl.style.opacity=1,c>this.scrollableContentEl.offsetHeight-this.contentWrapperEl.offsetHeight-1?this.downArrowEl.style.opacity=0:this.downArrowEl.style.opacity=1}if(this._doesHorizontalScroll){var d=Math.abs(b.x);1>d?this.leftArrowEl.style.opacity=0:this.leftArrowEl.style.opacity=1,d>this.scrollableContentEl.offsetWidth-this.contentWrapperEl.offsetWidth-1?this.rightArrowEl.style.opacity=0:this.rightArrowEl.style.opacity=1}}catch(e){PR.log("PR.ScrollZoneWidget::_scrollMove error - "+e)}a&&(a.stopPropagation(),a.preventDefault())},_scrollStart:function(a){var b=this;PR.utils.addClass(this.el,"scrolling"),window.addEventListener("blur",function(){b._scrollEnd()}),this.textSelect&&(this.selectTextTimeout=this._setTextSelectTimeout(500),window.addEventListener("mouseup",this._resetTextSelect))},_setTextSelectTimeout:function(a){return setTimeout(_.bind(function(){this._scrollInstance.moved||this._scrollInstance.disable()},this),a)},_resetTextSelect:function(a){window.removeEventListener("mouseup",this._resetTextSelect),clearTimeout(this.selectTextTimeout),this._scrollInstance.enable(),this._scrollInstance._end(a)},_scrollEnd:function(a){PR.utils.removeClass(this.el,"scrolling"),this.arrows===!0&&(this._doesHorizontalScroll&&(0===this._scrollInstance.x&&(this.leftArrowEl.style.opacity=0),this._scrollInstance.x===this._scrollInstance.maxScrollX&&(this.rightArrowEl.style.opacity=0)),this._doesVerticalScroll&&(0===this._scrollInstance.y&&(this.upArrowEl.style.opacity=0),this._scrollInstance.y===this._scrollInstance.maxScrollY&&(this.downArrowEl.style.opacity=0)))},_onContentResize:function(a){this._scrollInstance.refresh()},_mouseWheel:function(a){a.stopPropagation(),a.preventDefault()}})),PR.Core.registerWidget("VideoWidget",PR.Core.widgets.BaseWidget.extend({className:"VideoWidget",_videoElement:null,_videoSRC:null,_videoShowAfter:null,_videoUserInteraction:!0,_videoLoop:!0,_videoControls:!0,_videoAutoPlay:!1,_videoAutoPlayOrginal:!1,_videoFullscreenOnly:!1,_videoMuted:!1,_isPlaying:!1,isOnScreen:!1,isFullScreen:!1,_hasEnded:!1,el:null,_videoID:null,videoJSON:null,mediaElement:null,useMediaElement:!1,mediaElementID:null,mediaElementHeight:null,mediaElementWidth:null,mediaElementVideoEnded:!1,mediaElementPluginPath:null,mediaElementCSSFile:null,mediaElementJSFile:null,mediaElementControls:null,mediaElementControlsAlwaysShow:null,mediaElementRemovedElements:[],videoSubscribed:!1,isOnline:null,isSupportedOffline:!0,canVideoBePlayed:!0,init:function(a){if(!a)throw new Error("HTML Element not attached for the Slide Show Widget.");if(this.el=a,this.id=a.getAttribute("id"),this._super(),this.isVisible=!1,_.bindAll(this),this._initVars(a),this._videoElement){var b=this;this._videoElement.addEventListener("click",function(){PR.Core.onAppNotify("jstap://"+b.el.id)},!1)}},_onNetworkEvent:function(a){return this.isOnline!==a?(this.isOnline=a,this.isSupportedOffline||a?this.canVideoBePlayed=!0:this.canVideoBePlayed=!1,this._updateOnlinePlayState(),!this._isPlaying||a||this.isSupportedOffline?PR.Core.CURRENT_APP_FRAMEWORK===PR.Core.AppFrameworks.DESKTOP&&!a&&this._isPlaying?void this.videoPause(this):void 0:void this.videoPause(this)):void 0},_onScreenWidget:function(){this._onNetworkEvent(PR.Core.isOnline),this._selectDelegate(),this.videoSetup(),this.isOnScreen||(this._addInteractionEvents(),this._subscribeEvents()),this._super()},_selectDelegate:function(){if(this.videoPlay=this.videoPause=this.videoToggle=this.videoSetup=this.videoDestroy=function(){},this.mediaElementRequirements()){var a=window.widgetSettings;if("undefined"==typeof a.reader)return;this.useMediaElement=!0,this.videoPlay=this.webReaderPlay,this.videoPause=this.webReaderPause,this.videoToggle=this.webReaderToggle,this.videoSetup=this.webReaderSetupVideo,this.videoDestroy=this.webReaderDestroyVideo,this.mediaElementPluginPath=a.reader+a.video.mediaElementPluginPath,this.mediaElementCSSFile=a.reader+a.video.mediaElementCSSFile,this.mediaElementJSFile=a.reader+a.video.mediaElementJSFile,this.mediaElementControls=a.video.mediaElementControls,this.mediaElementControlsAlwaysShow=a.video.mediaElementControlsAlwaysShow}else this.videoPlay=this.nativeVideoPlayBefore,this.videoPause=this.nativeVideoPause,this.videoToggle=this.nativeVideoToggle,this.videoSetup=this.nativeVideoAutoPlay,this.videoDestroy=this.nativeVideoDestroy},_offScreenWidget:function(){this.videoDestroy(),this.isOnScreen&&(this._removeInteractionEvents(),this._unSubscribeEvents()),this._super()},_onElementVisible:function(a){(!a||this._isEventReferToMe(a))&&(this._selectDelegate(),this._super(),this._onNetworkEvent(PR.Core.isOnline),!this._videoAutoPlay||PR.params.webapp&&PR.Core.BrowserSniff.IOS||(this.videoSetup(),this.videoPlay({})),this._addInteractionEvents(),this._subscribeEvents())},_onElementNotVisible:function(a){(!a||this._isEventReferToMe(a))&&(this._super(),this.videoPause(a),this._removeInteractionEvents(),this._unSubscribeEvents())},handleEvent:function(a){switch(a.type){case PR.INTERACTION_EVENTS.INTERACTION_START:case PR.INTERACTION_EVENTS.INTERACTION_END:this._onInteraction(a)}},_onInteraction:function(a){var b=a.target;b.nodeName&&"IMG"===b.nodeName||this._videoControls&&a.stopPropagation()},_onFullScreenStart:function(){this.isFullScreen=!0},_onFullScreenEnd:function(){this.isFullScreen=!1,this._showPoster()},_onVideoEnd:function(){this._hasEnded=!0,this._showPoster(),PR.Core.onAppNotifyDesktop("videoState://stopped")},reportPlay:function(){this._isPlaying=!0,this._hasEnded=!1,this._reportVideoEvent("play"),PR.Core.onAppNotifyDesktop("videoState://started")},reportPause:function(){this._isPlaying=!1,this._reportVideoEvent("pause"),PR.Core.onAppNotifyDesktop("videoState://stopped")},_initVars:function(a){this.el=a,this._videoID=a.id;var b=PR.utils.createDataset(a);this._videoUserInteraction=b.userInteraction,this._videoLoop=b.loop,this._videoControls=b.controls,this._videoAutoPlay=b.autoplay,this._videoAutoPlayOrginal=b.autoplay,this._videoFullscreenOnly=b.fullscreenOnly,this._videoMuted=b.muted,this._videoSRC=b.src,this._videoShowAfter=b.showAfter,this.videoFileType=this.getVideoExtension(this._videoSRC);var c=this.el.getBoundingClientRect(),d=PR.Core.cumulativeOffset(this.el);this.videoJSON='html5Video://{"x":"'+d.left+'", "y":"'+c.top+'", "width":"'+c.width+'", "height":"'+c.height+'", "innerWidth":"'+window.innerWidth+'", "innerHeight":"'+window.innerHeight+'", "src":"'+this._videoSRC+'"',"undefined"!=typeof this._videoControls&&(this.videoJSON+=', "controls":'+this._videoControls),"undefined"!=typeof this._videoLoop&&(this.videoJSON+=', "loop":'+this._videoLoop),"undefined"!=typeof this._videoAutoPlay&&(this.videoJSON+=', "autoplay":'+this._videoAutoPlay),"undefined"!=typeof this._videoFullscreenOnly&&(this.videoJSON+=', "fullscreen":'+this._videoFullscreenOnly),this.videoJSON+=', "hasPoster":'+(this.el.querySelectorAll(".videoPoster").length>0?"true":"false"),this.videoJSON+=', "action":"play"}',this.isSupportedOffline=this._isVideoSupportedOffline()},getVideoExtension:function(a){var b=/(?:\.([^.]+))?$/;return b.exec(a)[1]},getVideoSrcWithSettings:function(){var a=this._videoSRC;if(PR.params.webapp){var b=JSON.parse(this.videoJSON.split("html5Video://")[1]),c=-1===this._videoSRC.indexOf("?")?"?":"&";a=this._videoSRC+c+"loop="+b.loop+"&controls="+b.controls}return a},_addInteractionEvents:function(){this.el.addEventListener(PR.INTERACTION_EVENTS.INTERACTION_START,this,!1),this.el.addEventListener(PR.INTERACTION_EVENTS.INTERACTION_END,this,!1)},_removeInteractionEvents:function(){this.el.removeEventListener(PR.INTERACTION_EVENTS.INTERACTION_START,this,!1),this.el.removeEventListener(PR.INTERACTION_EVENTS.INTERACTION_END,this,!1)},_subscribeEvents:function(){this.videoSubscribed||(radio(PR.Event.PLAY_MEDIA).subscribe([this.videoPlay,this]),radio(PR.Event.PAUSE_MEDIA).subscribe([this.videoPause,this]),radio(PR.Event.TOGGLE_MEDIA).subscribe([this.videoToggle,this]),radio(PR.Event.ONLINE_EVENT).subscribe([this._onNetworkEvent,this]),this.videoSubscribed=!0)},_unSubscribeEvents:function(){this.videoSubscribed=!1,radio(PR.Event.PLAY_MEDIA).unsubscribe([this.videoPlay,this]),radio(PR.Event.PAUSE_MEDIA).unsubscribe([this.videoPause,this]),radio(PR.Event.TOGGLE_MEDIA).unsubscribe([this.videoToggle,this]),radio(PR.Event.ONLINE_EVENT).unsubscribe([this._onNetworkEvent,this])},nativeVideoPlayBefore:function(a){this._isEventReferToMe(a)?(PR.Core.CURRENT_APP_FRAMEWORK===PR.Core.AppFrameworks.ANDROID&&!window.frameElement||this._videoFullscreenOnly===!0||this._hidePlay(),this.nativeVideoPlay(a)):this._videoElement&&this._videoElement.pause()},nativeVideoPlay:function(a){var b=this;if(this._isEventReferToMe(a))if(PR.Core.CURRENT_APP_FRAMEWORK!==PR.Core.AppFrameworks.ANDROID||window.frameElement){if(this._videoFullscreenOnly){if(this._isEventReferToMe(a))if(0===this._videoSRC.indexOf("http://"))radio(PR.Event.NAVIGATE_TO_URL).broadcast({target:this._videoSRC});else{var c=this.getVideoSrcWithSettings();radio(PR.Event.APP_NOTIFY_EVENT).broadcast("video://"+c)}}else if(this.nativeVideoSetup(),this._isEventReferToMe(a)){"none"===this._videoElement.style.display&&(this._videoElement.style.display=""),PR.utils.addClass(b._videoElement,"displayBlock"),b._videoControls&&(b._videoElement.controls=!0);try{b._videoElement.play()}catch(d){}}}else PR.Core.onAppNotify(this.videoJSON)},nativeVideoPause:function(a){this._isEventReferToMe(a)&&(PR.Core.CURRENT_APP_FRAMEWORK!==PR.Core.AppFrameworks.ANDROID||window.frameElement?this._videoElement.pause():PR.Core.onAppNotify(this.videoJSON.replace('"action":"play"','"action":"pause"')))},nativeVideoToggle:function(a){!this._videoFullscreenOnly&&this._isEventReferToMe(a)&&(PR.Core.CURRENT_APP_FRAMEWORK!==PR.Core.AppFrameworks.ANDROID||window.frameElement?this._videoElement.paused?this.nativeVideoPlay(a):this.nativeVideoPause(a):PR.Core.onAppNotify(this.videoJSON.replace('"action":"play"','"action":"toggle"')))},nativeVideoSetup:function(){if("mp4"!==this.videoFileType&&PR.Core.BrowserSniff.IE){var a="video-not-compatible";PR.Core.onAppNotifyDesktop("notification://"+a)}if(null===this._videoElement){this._videoElement=document.createElement("video");var b=PR.Core.BrowserSniff.IOS?"#t=0.01":"";this._videoElement.src=this._videoSRC+b,this._videoElement.setAttribute("id","media-"+this.id),PR.Core.CURRENT_APP_FRAMEWORK===PR.Core.AppFrameworks.ANDROID&&(this._videoElement.style.backgroundColor="#000"),this._videoLoop&&(this._videoElement.loop=!0),this._videoElement.setAttribute("playsinline",""),this._videoMuted&&(this._videoElement.muted=!0,this._videoElement.setAttribute("muted",!0)),PR.utils.addClass(this._videoElement,"videoControls"),PR.Core.AppFrameworks.IPAD&&PR.utils.addClass(this.el,"hardware-gpu"),this.el.insertBefore(this._videoElement,this._getFirstNonTextChild(this.el)),this._videoElement.addEventListener("play",this.reportPlay,!1),this._videoElement.addEventListener("pause",this.reportPause,!1),this._videoElement.addEventListener("ended",this._onVideoEnd,!1),this._videoElement.addEventListener("webkitbeginfullscreen",this._onFullScreenStart,!1),this._videoElement.addEventListener("webkitendfullscreen",this._onFullScreenEnd,!1),this._videoElement.addEventListener("playing",this._hidePoster,!1)}},nativeVideoAutoPlay:function(){if(this._shouldStartVideo())if(this._videoAutoPlay)if(this._videoFullscreenOnly){var a=this.getVideoSrcWithSettings();radio(PR.Event.APP_NOTIFY_EVENT).broadcast("video://"+a)}else this.nativeVideoPlay(this.el);else this.nativeVideoSetup()},autostopVideo:function(){this._videoElement.pause()},nativeVideoDestroy:function(){if(this._videoElement){var a=this.el.getElementsByClassName("background")[0];if(a?this.el.removeChild(a):this.el.background="",!this._videoElement)return;this._videoElement.style.display="none",this._videoElement.pause(),this._isPlaying=!1,this._showPoster(),this.el.removeChild(this._videoElement),this._videoElement=null}},webReaderPause:function(a){this._isEventReferToMe(a)&&this.mediaElement&&this.mediaElement.pause()},webReaderPlay:function(a){if(this._isEventReferToMe(a)||a==={}){if(this._videoFullscreenOnly){var b=this.getVideoSrcWithSettings();return void radio(PR.Event.APP_NOTIFY_EVENT).broadcast("video://"+b)}if(this.canVideoBePlayed!==!0){this.videoPause(this);var c="notification-offline-content-unavailable";return void PR.Core.onAppNotifyDesktop("alert://"+c)}this.mediaElement?this.mediaElement.play():(this._videoAutoPlay=!0,this.webReaderSetupVideo())}},webReaderToggle:function(a){if(this._isEventReferToMe(a))if(this._isPlaying===!0)this.webReaderPause(a);else{if(this.canVideoBePlayed!==!0){var b="notification-offline-content-unavailable";return void PR.Core.onAppNotifyDesktop("alert://"+b)}this.webReaderPlay(a)}},webReaderVideoElement:function(a){this._videoElement=document.createElement("video"),this._videoElement.src=a,this._videoElement.setAttribute("id","media-"+this.id),this._videoElement.setAttribute("width",this.mediaElementWidth),this._videoElement.setAttribute("height",this.mediaElementHeight),this._videoLoop&&(this._videoElement.loop=!0),this._videoElement.setAttribute("webkit-playsinline",""),PR.utils.addClass(this._videoElement,"videoControls"),this._storeElements(),this.el.insertBefore(this._videoElement,this._getFirstNonTextChild(this.el)),this._videoElement.parentNode.style.backgroundColor="#000",PR.utils.hasAncestorWidgetPopup(this.el)||!this._videoAutoPlay||this._videoFullscreenOnly||this._videoElement.setAttribute("autoplay",!0),this._videoMuted&&(this._videoElement.muted=!0,this._videoElement.setAttribute("muted",!0)),this.webReaderMediaElement()},webReaderMediaElement:function(){var a=this,b=this._videoControls;(!this._videoControls||this._videoLoop)&&(this.mediaElementControls=[],b=!1),this.mediaElementDimensions(),this.mediaElement=new window.MediaElementPlayer("#media-"+a.id,{enablePluginDebug:!1,pluginPath:this.mediaElementPluginPath,loop:this._videoLoop,videoWidth:this.mediaElementWidth,videoHeight:this.mediaElementHeight,features:this.mediaElementControls,videoVolume:"horizontal",enableAutosize:!1,autoRewind:!1,pauseOtherPlayers:!1,success:function(c,d){function e(b){b.target.currentTime>0&&(_.defer(a._hidePoster),c.removeEventListener("timeupdate",e))}return PR.utils.addClass(a.el,"mediaEl-noControls"),a.mediaElementPoster&&(c.addEventListener("ended",function(b){a._showPoster()}),c.addEventListener("play",function(b){a._hidePoster()})),c.addEventListener("pause",function(b){a._isPlaying=!1,a.reportPause()}),c.addEventListener("play",function(b){if(a.canVideoBePlayed!==!0){a.videoPause(a);var c="notification-offline-content-unavailable";return void PR.Core.onAppNotifyDesktop("alert://"+c)}a._isPlaying=!0,a.reportPlay()}),c.addEventListener("ended",function(b){a._isPlaying=!1}),a._videoAutoPlay&&a._videoFullscreenOnly&&a._shouldStartVideo()?a.webReaderPlay({}):(!a._videoLoop&&b&&c.addEventListener("playing",function(b){
PR.utils.removeClass(a.el,"mediaEl-noControls")}),void c.addEventListener("timeupdate",e))},error:function(a){var b="video-missing";/\.(FLV|MP4|M4A|MOV|MP4V|3GP|3G2)$/i.test(a.getAttribute("src"))&&(b="video-not-compatible"),PR.Core.onAppNotifyDesktop("notification://"+b)}})},webReaderSetupVideo:function(){var a=this;this._videoElement||PR.utils.loadAsset(this._videoSRC,{success:function(b){a.webReaderVideoElement(b)},error:function(){a.webReaderVideoElement(a._videoSRC)}})},webReaderDestroyVideo:function(){this._videoElement&&(this.mediaElement.pause(),this._isPlaying=!1,this._showPoster(),this._videoElement=null,this._reStoreElements(),this._videoAutoPlay=this._videoAutoPlayOrginal,window.$("#"+this.mediaElement.id).remove(),this.mediaElement=null)},_updateOnlinePlayState:function(){var a=this.el.querySelectorAll("img"),b=0,c=this.canVideoBePlayed?"displayOnline":"displayOffline",d=this.canVideoBePlayed?"displayOffline":"displayOnline";for(b=0;b<a.length;b+=1){var e=a[b].getAttribute("data-widget");e&&"BUTTON"===e&&(PR.utils.addClass(a[b],c),PR.utils.removeClass(a[b],d))}},_isVideoSupportedOffline:function(){return PR.Core.CURRENT_APP_FRAMEWORK!==PR.Core.AppFrameworks.DESKTOP?!0:-1!==this._videoSRC.indexOf("://")?!1:PR.Core.BrowserSniff.IE||PR.Core.BrowserSniff.FIREFOX?!1:!1},_shouldStartVideo:function(){for(var a=this.el.parentNode,b=null;1===a.nodeType;){if(b=window.getComputedStyle(a),"hidden"===b.visibility||"none"===b.display||0===b.opacity)return!1;a=a.parentNode}return!0},_hidePoster:function(){var a=this.el.querySelectorAll("img"),b=0;for(b=0;b<a.length;b+=1)PR.utils.addClass(a[b],"displayNone")},_storeElements:function(){var a=this.el.querySelectorAll("img");this.mediaElementRemovedElements=a},_reStoreElements:function(){var a=this.mediaElementRemovedElements,b=0;for(b=0;b<a.length;b+=1)this.el.appendChild(a[b]);this.mediaElementRemovedElements=[]},_hidePlay:function(){var a=this.el.querySelectorAll("img"),b=0;for(b=0;b<a.length;b+=1){var c=a[b].getAttribute("data-widget");c&&"BUTTON"===c&&PR.utils.addClass(a[b],"displayNone")}},_showPoster:function(a){if((this._isPlaying!==!0||this._hasEnded!==!1)&&this.isFullScreen!==!0){var b,c=this.el.querySelectorAll("img");for(b=0;b<c.length;b+=1)PR.utils.removeClass(c[b],"displayNone");this._videoControls&&(this._videoElement.controls=!1)}},mediaElementRequirements:function(){return"undefined"!=typeof $&&PR.Core.containingFrame?!0:!1},mediaElementDimensions:function(){var a=document.getElementById(this.id);if(a.offsetHeight)this.mediaElementHeight=a.offsetHeight,this.mediaElementWidth=a.offsetWidth;else{const b=window.getComputedStyle(a);this.mediaElementHeight=parseInt(b.height),this.mediaElementWidth=parseInt(b.width)}document.getElementsByClassName("videoPoster")[0]&&(this.mediaElementPoster=document.getElementsByClassName("videoPoster")[0].getAttribute("src"))},removeChildElements:function(){var a=document.getElementById(this.id);if(a.hasChildNodes())for(var b=a.children;b.length;)a.removeChild(b[0])},_reportVideoEvent:function(a){var b={};b.widget="html5video",b.path=this._videoSRC,b.action=a;var c=JSON.stringify(b);c=encodeURIComponent(c),radio(PR.Event.APP_NOTIFY_EVENT).broadcast("reporting://"+c)},_getFirstNonTextChild:function(a){if(!a)return null;var b;if(this._videoShowAfter)b=document.getElementById(this._videoShowAfter),b.nextSibling&&(b=b.nextSibling);else for(b=a.firstChild;1!==b.nodeType;){if(!b.nextSibling)return null;b=b.nextSibling}return b}})),PR.Core.registerWidget("WebViewWidget",PR.Core.widgets.BaseWidget.extend({className:"WebViewWidget",isWebLink:!1,userInteraction:"true",_isIframeLoaded:!1,_hasBeenOffline:!1,el:null,_imageEl:null,previewImage:null,iframe:null,src:"",videoPlayer:null,ytPlayerId:"",init:function(a){if(!a)throw new Error("HTML Element not attached in WebViewWidget.");this.el=a,this.id=a.getAttribute("id"),this._super(),_.bindAll(this),this._initDefaultProps(),this._initWebView()},_initWebView:function(){if(!this.src)throw new Error("[Iframe source url not specified.]");PR.utils.addClass(this.el,"visibilityHidden"),this.previewImage=this.el.getElementsByTagName("img")[0],this.isWebLink=PR.utils.validateIsWebLink(this.src);for(var a=0;a<this.el.children.length;a+=1)this.el.children[a].style&&(this.el.children[a].style.position="absolute");if(this.userInteraction!==!0&&this.disableIFrame(),PR.params.webapp){var b,c;if(this._isYoutubeVideo()){var d=-1===this.src.indexOf("?")?"?":"&";this.src=this.src+d+"playsinline=1&enablejsapi=1",b="//www.youtube.com/iframe_api",c="youtube_api",this.ytPlayerId="html5YoutubeWidget"+this.id}else this._isVimeoVideo()&&(b="//player.vimeo.com/api/player.js",c="vimeo_api");if(void 0!==b){var e=document.createElement("script");e.src=b,e.id=c;var f=document.getElementsByTagName("script")[0];f.parentNode.insertBefore(e,f)}}},_onNetworkEvent:function(a){PR.log("_onNetworkEvent"),this.validateWidget(a)},_onLoad:function(a){this._fadeIn()},_onIframeLoad:function(a){try{this._overrideAnchorTarget(),this._initialiseIframe()}catch(b){PR.log(b,PR.log.ERROR)}this.isOnScreen&&(this._iframeOnScreen(),PR.params.webapp&&this._isVimeoVideo()&&this._addVimeoEvents()),PR.utils.removeClass(this.el,"visibilityHidden")},_isYoutubeVideo:function(){return-1!==this.src.indexOf("youtube")},_isVimeoVideo:function(){return-1!==this.src.indexOf("vimeo")},_addVimeoEvents:function(){this.videoPlayer=new window.Vimeo.Player(this.iframe),this.videoPlayer.on("play",function(){PR.Core.onAppNotifyDesktop("videoState://started")}),this.videoPlayer.on("pause",function(){PR.Core.onAppNotifyDesktop("videoState://stopped")})},_onScreenWidget:function(){this.isOnScreen||(this._super(),this.iframe=this.createIframe(),this.validateWidget(PR.Core.isOnline),this._addInteractionEvents(),this._subscribeEvents(),this._iframeOnScreen(),this.ytPlayerId&&null!==document.getElementById("youtube_api")&&void 0!==window.YT&&window.registerYoutubeEvents(this.ytPlayerId))},_onElementVisible:function(a){if(!a||this._isEventReferToMe(a)){var b=this.iframe.getAttribute("src");(""===b||null===b||void 0===b)&&this.iframe.setAttribute("src",this.src)}},_onElementNotVisible:function(a){(!a||this._isEventReferToMe(a))&&(this._super(),null!==this.videoPlayer?(this._isYoutubeVideo()&&this.videoPlayer.pauseVideo(),this._isVimeoVideo()&&this.videoPlayer.pause()):this.iframe.setAttribute("src",""))},_offScreenWidget:function(){this.isOnScreen&&(this._super(),this.iframe&&this.removeiFrame(),this._removeInteractionEvents(),this._unSubscribeEvents(),this._iframeOffScreen())},createIframe:function(){function a(a,c){b.addEventListener?b.addEventListener(a,c):b.attachEvent&&b.attachEvent(a,c)}if(this.iframe)return this.iframe;var b=document.createElement("iframe");return this.previewImage?this.el.insertBefore(b,this.previewImage):this.el.appendChild(b),b.setAttribute("class","html5widget"),this._isYoutubeVideo()&&b.setAttribute("id",this.ytPlayerId),(!PR.utils.hasAncestorWidgetPopup(this.el)||this._isYoutubeVideo()||this._isVimeoVideo())&&b.setAttribute("src",this.src),this.userInteraction!==!0?b.setAttribute("scrolling","no"):PR.Core.CURRENT_APP_FRAMEWORK!==PR.Core.AppFrameworks.DESKTOP&&PR.utils.addStyle(this.el,{overflow:"scroll",webkitOverflowScrolling:"touch"}),PR.params.webapp&&b.setAttribute("allowfullscreen","allowfullscreen"),a("load",this._onIframeLoad),b.style.display="block",b.style.position="absolute",b.style.top="0",b.style.left="0",this.previewImage&&(this.previewImage.style.display="none"),b.setAttribute("width","100%"),b.setAttribute("height","100%"),b},removeiFrame:function(){return this.iframe&&(this.iframe.parentElement.removeChild(this.iframe),this.iframe=null),this},_initialiseIframe:function(){var a=this.iframe.contentWindow;"undefined"!=typeof a.PR&&window.PR.Core.isFeaturesCalled&&"function"==typeof a.PR.features&&a.PR.features()},_createImage:function(a){if(!this._imageEl){var b=document.createElement("img");b.setAttribute("id","image"),PR.utils.addClass(b,"webviewImage"),PR.utils.addClass(b,"transitionOpacity"),b.style.width=this.el.offsetWidth+"px",b.style.height=this.el.offsetHeight+"px",b.addEventListener("load",this._onLoad),PR.utils.loadAsset(a,{success:function(a){b.setAttribute("src",a)},error:function(c){b.setAttribute("src",a)}}),this.el.appendChild(b),this._imageEl=b}},_fadeIn:function(){this._imageEl&&(PR.utils.removeClass(this._imageEl,"transparent"),PR.utils.addClass(this._imageEl,"opaque"))},_fadeOut:function(){this._imageEl&&(PR.utils.removeClass(this._imageEl,"opaque"),PR.utils.addClass(this._imageEl,"transparent"),this._imageEl.style.display="none")},_addInteractionEvents:function(){},_removeInteractionEvents:function(){},_subscribeEvents:function(){radio(PR.Event.ONLINE_EVENT).subscribe([this._onNetworkEvent,this])},_unSubscribeEvents:function(){radio(PR.Event.ONLINE_EVENT).unsubscribe([this._onNetworkEvent,this])},_overrideAnchorTarget:function(){try{var a=null;try{a=event.target.contentWindow.document.getElementsByTagName("a")}catch(b){return void PR.log("WebViewWidget - error manipulating anchor targets\nEvent or iFrame document does not exist",PR.log.ERROR)}for(var c=0;c<a.length;c+=1){var d=a[c],e=d.getAttribute("target"),f=d.getAttribute("href");"_blank"===e&&f&&(d.setAttribute("target",""),d.addEventListener("click",this._onAnchorClick))}}catch(g){PR.log("WebViewWidget - _overrideAnchorTarget :: "+g.message,PR.log.ERROR)}},_onAnchorClick:function(a){a.preventDefault(),radio(PR.Event.APP_NOTIFY_EVENT).broadcast("jstap://"+this.id);var b=a.currentTarget,c=b.getAttribute("href");radio(PR.Event.NAVIGATE_TO_URL).broadcast({target:c})},_iframeOnScreen:function(){try{var a=this.iframe.contentWindow.PR;a.Core.isOnScreen||a.Core._onScreen()}catch(b){}},_iframeOffScreen:function(){try{var a=this.iframe.contentWindow.PR;a.Core.isOnScreen&&a.Core._offScreen()}catch(b){}},showImage:function(){this._imageEl?(this._imageEl.style.display="block",this._fadeIn()):this.offlineImage&&this._createImage(this.offlineImage),this.iframe&&(this.iframe.style.display="none")},hideImage:function(){this._imageEl&&this._fadeOut(),this.iframe&&(this.iframe.style.display="block")},disableIFrame:function(){var a=document.createElement("div");a.style.position="absolute";var b=PR.Core.CURRENT_APP_FRAMEWORK===PR.Core.AppFrameworks.ANDROID?.01:0;a.style.backgroundColor="RGBA(0,0,0,"+b+")",a.style.width=this.el.offsetWidth+"px",a.style.height=this.el.offsetHeight+"px",a.style.left=a.style.top=0,a.addEventListener("click",function(a){a.preventDefault(),a.stopPropagation()}),this.el.appendChild(a)},setIframeSrc:function(a){var b=a?a:this.iframe,c=this;return this.isWebLink?void(b.src=this.src):void PR.utils.loadAsset(this.src,{success:function(a){if(a===c.src)return void(b.src=c.src);a=c.makePathsRelative(a,c.src);try{b.contentWindow.document.open(),b.contentWindow.document.write(a),b.contentWindow.document.close()}catch(d){PR.log("There was an error writing the content to the iframe: "+d,PR.log.ERROR)}},error:function(a){c.validateWidget(!1)}})},makePathsRelative:function(a,b){function c(a,c,d,e){return-1!==d.indexOf("://")||-1!==d.indexOf("data:")?a:c+b+"/"+d+e}return b=PR.utils.getFullURLLocation(b,{removeFileLocation:!0}),a=a.replace(/((?:src|href)=["'])([^'^"]+)(["'])/gi,c),a=a.replace(/(url\(['"])([^#][\s\S]+?)(['"]\))/gi,c)},validateWidget:function(a){var b=a?a:PR.Core.isOnline;b||this._hasBeenOffline!==!1||(this._hasBeenOffline=!0),b?(this.hideImage(),this._hasBeenOffline===!0&&(this._hasBeenOffline=!1,this.iframe.setAttribute("src",this.src))):this.showImage()}})),function(a,b){var c=a.utils,d={_timer:null,_basePath:"",_index:-1,_previousIndex:0,_slideWidth:0,_slideHeight:0,_resizeTimer:0,className:"PR.SlideShowWidget",el:null,id:null,defaultIndex:0,items:[],isAnimating:!1,isIE9:a.Core.BrowserSniff.IE9,hasSubscribed:!1,transitionDuration:1e3,autoplayDuration:3e3,autoplay:"false",transition:"NONE",loop:"true",showIndicators:"false",touchInteraction:"true",initialOpacity:1},e={_createLayout:function(){for(var a=0;a<=this.items.length-1;a+=1)this.items[a].style.opacity="0",this.items[a].style.visibility="hidden";this._super()},goToSlide:function(c,d,e){var f=this.getSlideByIndex(d),g=this.getSlideByIndex(c);g&&(a.Transitions.fade({target:g,from:0,to:1,duration:e?1:this.transitionDuration,startCallBack:e?_.noop:this._onTransitionStart,endCallBack:e?_.noop:this._onTransitionVisibleEnd}),setTimeout(function(){this.isAnimating&&this._onTransitionVisibleEnd({eventPhase:2,currentTarget:g})}.bind(this),this.transitionDuration+10)),f&&(a.Transitions.fade({target:f,from:1,to:0,duration:e?1:this.transitionDuration,endCallBack:e?_.noop:this._onTransitionHideEnd}),setTimeout(function(){this.isAnimating&&this._onTransitionHideEnd({eventPhase:b.AT_TARGET,currentTarget:f})}.bind(this),this.transitionDuration+10)),this._super.apply(this,arguments)},_onInteractionEnd:function(b){this.slideByDirection(a.WIDGET_EVENTS.NEXT),this._super()},_onTransitionHideEnd:function(c){if(c.eventPhase===b.AT_TARGET){var d=c.currentTarget;"0"===d.style.opacity&&(d.style.visibility="hidden",d.removeEventListener(a.Core.prefix.js.transitionEnd,this._onTransitionHideEnd,!1),radio(a.Event.ELEMENT_NOT_VISIBLE).broadcast({id:d.id}),a.Core.triggerElementNotVisible(d))}}},f={_createLayout:function(){this.hasBackFaceSupport=this._isBackFaceSupported(),this.hasBackFaceSupport?this._initFlip():this._initAndroidFlip(),this._super()},_initFlip:function(){this.flip=a.Core.widgets.FlipWidget.create(this.ul);for(var b=0;b<=this.items.length-1;b+=1){var d=this.items[b];c.addClass(d,"flipItem"),d.style.display="none"}},_initAndroidFlip:function(){a.utils.addClass(this.el,"androidFlipSlideshow");for(var b=0;b<this.items.length;b+=1)a.utils.addClass(this.items[b],"androidFlipSlide"),a.utils.addClass(this.items[b],"flipUp");a.utils.removeClass(this.items[0],"flipUp")},_onInteractionStart:function(a){this._super()},_onInteractionEnd:function(b){this.slideByDirection(a.WIDGET_EVENTS.NEXT),this._super()},_onTransitionStart:function(a){this.isAnimating=!0,this._super()},_onTransitionVisibleEnd:function(a){this.isAnimating=!1,this._super()},onGoToSlide:function(a){this.isAnimating!==!0&&this._super.apply(this,arguments)},goToSlide:function(a,b,c){var d=this.getSlideByIndex(b),e=this.getSlideByIndex(a);e&&d?this.hasBackFaceSupport?this._applyFlip(d,e):this._applyAndroidFlip(d,e):e&&(e.style.visibility="visible",e.style.display="block"),this._super.apply(this,arguments)},_applyFlip:function(b,d){for(var e=_.indexOf(this.ul.children,b),f=_.indexOf(this.ul.children,d),g=f>e?1:-1,h=0;h<=this.items.length-1;h+=1){var i=this.items[h];i.style.display="none",c.removeClass(i,"front face"),c.removeClass(i,"back face")}b.style.display="block",b.className=1===g?"front face":"back face",d.style.display="block",d.className=1===g?"back face":"front face",this.flip.once(a.WIDGET_EVENTS.FLIP_START,this._onTransitionStart),this.flip.once(a.WIDGET_EVENTS.FLIP_END,this._onTransitionVisibleEnd),this.flip.flip(g)},_applyAndroidFlip:function(b,c){var d=_.bind(function(){b.addEventListener(a.Core.prefix.js.transitionEnd,e),this.isAnimating=!0,a.utils.addClass(b,"flipUp"),a.utils.removeClass(c,"flipUp"),a.utils.addClass(c,"flipDown")},this),e=_.bind(function(){b.removeEventListener(a.Core.prefix.js.transitionEnd,e),c.addEventListener(a.Core.prefix.js.transitionEnd,f),a.utils.removeClass(c,"flipDown")},this),f=_.bind(function(){c.removeEventListener(a.Core.prefix.js.transitionEnd,f),this.isAnimating=!1},this);b&&!this._isFlipping&&d()},_isBackFaceSupported:function(){return!(a.Core.CURRENT_APP_FRAMEWORK===a.Core.AppFrameworks.ANDROID||a.Core.BrowserSniff.IE10)}},g={_createLayout:function(){for(var b=parseInt(this.autoplayDuration,10),c=parseInt(this.transitionDuration,10),d=0;d<=this.items.length-1;d+=1)this.setItemsStyle(d);this.ul.style.width=this.el.offsetWidth*this.items.length+"px";var e={scrollX:!0,scrollY:!1,momentum:!1,useTransform:!1,snap:!0,snapSpeed:c>b?b:c};this.touchInteraction||_.extend(e,{mouseWheel:!1,disableMouse:!0,disableTouch:!0}),-1!==a.utils.getInternetExplorerVersion()&&_.extend(e,{preventDefault:!1}),this.iScroll=new IScroll(this.el,e),this.iScroll.on("scrollEnd",this._onScrollEnd),this._super()},goToSlide:function(a,b,c){this.slideByIndex(a,c),this._super.apply(this,arguments)},_onScrollEnd:function(){this.setIndex(this.iScroll.currentPage.pageX);var b=this._previousIndex,c=this.iScroll.currentPage.pageX,d=this.items[b],e=this.items[c];b!==c&&(d&&a.Core.triggerElementNotVisible(d),a.Core.triggerElementVisible(e),this.autoplay===!0&&this.isOnScreen&&this._initTimer())},slideByIndex:function(a,b){return 0>a||a>this.items.length-1?!1:(b||window.clearInterval(this._timer),void this.iScroll.goToPage(a,0))},setItemSlideOpacity:function(a,b){var c=this.items[a].children;if(void 0===c[0])throw new Error("The li items must contain child element to create slide show.");c[0].style.opacity=b},setItemsStyle:function(a){this.setItemSlideOpacity(a,1),this.items[a].style.width=this.el.offsetWidth+"px",this.items[a].style.left=a*this.el.offsetWidth+"px"},_onResizingUpdateElements:function(a){for(var b=0;b<=this.items.length-1;b+=1)this.items[b].style.left=null,this.items[b].style.width=null,b!==this.getIndex()&&this.setItemSlideOpacity(b,0);this.iScroll.currentPage.pageX=this.getIndex(),this.iScroll.refresh(),this.ul.style.width=this.el.offsetWidth+"px",clearTimeout(this._resizeTimer),this._resizeTimer=setTimeout(function(){for(var a=0;a<=this.items.length-1;a+=1)this.setItemsStyle(a);this.ul.style.width=this.el.offsetWidth*this.items.length+"px",this.iScroll.currentPage.pageX=this.getIndex(),this.iScroll.refresh(),this.autoplay===!0&&this.isOnScreen&&this._initTimer()}.bind(this),100)},_onInteractionStart:function(a){this.hasTouch||a.preventDefault(),this._super()},_enableGPU:function(){this.iScroll&&(this.iScroll.translateZ=this._iScrollTranslateZ,this.iScroll.scrollBy(0,0)),this._super()},_disableGPU:function(){this.iScroll&&(this._iScrollTranslateZ=this.iScroll.translateZ,this.iScroll.translateZ="",this.iScroll.scrollBy(0,0)),this._super()}},h={transitionDuration:20};a.Core.registerWidget("SlideshowWidget",a.Core.widgets.BaseWidget.extend({className:"SlideshowWidget",transitionTypes:{},init:function(a){var b=this;this._errorCheck(a),this._super(),this._initVars(a),this._initDefaultProps(),this._initType(),this._createLayout(),this._createIndicators(),this._positionSlideShow(),_.defer(function(){a.style.opacity=b.initialOpacity>1?b.initialOpacity/100:b.initialOpacity,b.goToSlide(0,-1,!0)})},_errorCheck:function(a){if(!a)throw new Error("HTML Element not attached for the Slide Show Widget.");if(!a.id)throw new Error("[The id attribute not specified on the el slideshow.]");if(0===a.children.length)throw new Error("[No children found in the div element to create the slide show.]");if("ul"!==a.children[0].nodeName.toLowerCase())throw new Error("[The first child element is not a UL element.]")},_initType:function(){var b="undefined"!=typeof a.TRANSITION_EFFECTS[this.transition],c="undefined"!=typeof this.transitionTypes[this.transition];if(!b||!c)throw new Error("The type passed to the slide show is invalid: "+this.transition);this.mixin(this.transitionTypes[this.transition]),_.bindAll(this)},_initVars:function(a){if(_.extend(this,d),this.el=a,this.id=a.id,this.ul=this.el.children[0],this._slideWidth=Number(this.ul.offsetWidth),this._slideHeight=Number(this.ul.offsetHeight),this.items=this.ul.querySelectorAll("li"),this._dotPath=this._basePath+"assets/",this.indicatorImageOn=this._dotPath+"dot-active.png",this.indicatorImageOff=this._dotPath+"dot-inactive.png",0===this.items.length)throw new Error("[The ul must at least on li tag to create slide show.]")},_positionSlideShow:function(){this.ul.style.left="0px"},_updateIndicators:function(){if(this.showIndicators!==!0||this.touchInteraction!==!0)return!1;var a,b=this.getIndex()+1,c=this.indicatorsDiv.querySelector("img:nth-of-type("+b+")");for(a=this.indicatorsDiv.firstChild;a;a=a.nextSibling)a.src=this.indicatorImageOff;return c&&(c.src=this.indicatorImageOn),!0},_createLayout:function(a){},_createIndicators:function(){if(this.touchInteraction!==!0||this.showIndicators!==!0)return!1;var b=document.createElement("div"),d=this.isIE9?"translate(0px,0px)":"translate3d(0px,0px,0px)";c.addStyle(b,{zIndex:"100",position:"absolute",bottom:"8px",textAlign:"center",width:"100%",display:"block"}),b.style.setProperty(a.Core.prefix.css.transform,d);for(var e=0;e<=this.items.length-1;e+=1){var f=document.createElement("img"),g=0===e?this.indicatorImageOn:this.indicatorImageOff;f.setAttribute("src",g),c.addStyle(f,{width:"15px",position:"static"}),b.appendChild(f)}this.el.appendChild(b),this.indicatorsDiv=b},_reset:function(){var b=this.getCurrentSlide();this._initDefaultProps(),this.setIndex(0),this._timer&&clearInterval(this._timer),b&&(radio(a.Event.ELEMENT_NOT_VISIBLE).broadcast({id:b.id}),a.Core.triggerElementNotVisible(b))},_initTimer:function(){clearInterval(this._timer),this._timer=setInterval(this._onSlideInterval,this.autoplayDuration)},_onSlideInterval:function(){var a=(this.getIndex(),this.getNextIndex());return 0===a&&this.loop!==!0?void clearInterval(this._timer):void(this.el.getClientRects().length&&this.setIndex(a))},_subscribeEvents:function(){this.hasSubscribed||(radio(a.WIDGET_EVENTS.SLIDE_SELECT_EVENT).subscribe([this._onSlideSelect,this]),radio(a.Event.NEXT_SLIDE).subscribe([this.onNextSlide,this]),radio(a.Event.PREVIOUS_SLIDE).subscribe([this.onPreviousSlide,this]),radio(a.Event.GO_TO_SLIDE).subscribe([this.onGoToSlide,this]),radio(a.Event.ON_ZOOM).subscribe([this.onZoom,this]),radio(a.Event.ON_RESIZE).subscribe([this._onResizingUpdateElements,this]),this.touchInteraction===!0&&(a.utils.isWindowsTablet()&&a.utils.isChromeTouch()?(this.ul.addEventListener(a.INTERACTION_EVENTS.INTERACTION_START,this._onInteractionStart),this.ul.addEventListener(a.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_START,this._onInteractionStart)):this.ul.addEventListener(a.INTERACTION_EVENTS.INTERACTION_START,this._onInteractionStart)),this.hasSubscribed=!0)},_unSubscribeEvents:function(){radio(a.WIDGET_EVENTS.SLIDE_SELECT_EVENT).unsubscribe([this._onSlideSelect,this]),radio(a.Event.NEXT_SLIDE).unsubscribe([this.onNextSlide,this]),radio(a.Event.PREVIOUS_SLIDE).unsubscribe([this.onPreviousSlide,this]),radio(a.Event.GO_TO_SLIDE).unsubscribe([this.onGoToSlide,this]),radio(a.Event.ON_ZOOM).unsubscribe([this.onZoom,this]),radio(a.Event.ON_RESIZE).unsubscribe([this._onResizingUpdateElements,this]),this.touchInteraction===!0&&(a.utils.isWindowsTablet()&&a.utils.isChromeTouch()?(this.ul.removeEventListener(a.INTERACTION_EVENTS.INTERACTION_START,this._onInteractionStart),this.ul.removeEventListener(a.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_START,this._onInteractionStart)):this.ul.removeEventListener(a.INTERACTION_EVENTS.INTERACTION_START,this._onInteractionStart)),this.hasSubscribed=!1},_onElementVisible:function(a){(!a||this._isEventReferToMe(a))&&(this._super(),this.autoplay===!0&&this._initTimer())},_onScreenWidget:function(b){var c;return this._index=this.defaultIndex,(c=this.getCurrentSlide())?(c.id||a.log("[_onScreenWidget - SlideshowWidget firstSlide.id not specified.]",a.log.WARN),this._super(),this._subscribeEvents(),this.autoplay!==!0||a.utils.hasAncestorWidgetPopup(this.el)||this._initTimer(),void a.Core.triggerElementVisible(c)):void a.log("[_onScreenWidget - SlideshowWidget firstSlide not found]")},_offScreenWidget:function(){this._super(),this._reset(),this._unSubscribeEvents()},_onSlideSelect:function(a){this.id===a.id&&(this.goToSlide(a.nextIndex,a.previousIndex),this._updateIndicators(),"undefined"!=typeof event&&this._reportSlideshow(a.nextIndex,a.previousIndex))},_onInteractionStart:function(b){radio(a.Event.APP_SCROLL_EVENT).broadcast(!1),window.clearInterval(this._timer),this.autoplay="false",a.utils.isWindowsTablet()&&a.utils.isChromeTouch()&&document.addEventListener(a.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_END,this._onInteractionEnd,!0),document.addEventListener(a.INTERACTION_EVENTS.INTERACTION_END,this._onInteractionEnd,!0)},_onInteractionEnd:function(b){radio(a.Event.APP_SCROLL_EVENT).broadcast(!0),radio(a.Event.APP_NOTIFY_EVENT).broadcast("jstap://"+this.id),a.utils.isWindowsTablet()&&a.utils.isChromeTouch()&&document.removeEventListener(a.INTERACTION_EVENTS_CHROME_WIN_TOUCH.INTERACTION_END,this._onInteractionEnd,!0),document.removeEventListener(a.INTERACTION_EVENTS.INTERACTION_END,this._onInteractionEnd,!0)},_onTransitionStart:function(a){this.isAnimating=!0,window.clearInterval(this._timer)},_onTransitionVisibleEnd:function(b){var c=this.getCurrentSlide(),d=this.getSlideByIndex(this._previousIndex);this.isAnimating=!1,c&&a.Core.triggerElementVisible(c),d&&a.Core.triggerElementNotVisible(d),this.autoplay===!0&&this.isOnScreen&&this._initTimer()},_reportSlideshow:function(b,c){var d=b>c,e={};e.eventAction=d?"NEXT_SLIDE":"PREVIOUS_SLIDE",e.eventCategory="Slideshow",e.eventValue=b,radio(a.Event.APP_NOTIFY_EVENT).broadcast("reporting://"+JSON.stringify(e))},onGoToSlide:function(a){if(!this._isEventReferToMe(a))return!1;var b,c=a.targetSlide;if(!c)throw new Error("Target Slide not specified.");for(clearInterval(this._timer),b=0;b<this.items.length;b+=1){var d=this.items[b];if(d.id===c)break}if(b!==this.getIndex()){var e=b;this.setIndex(e)}return!0},onZoom:function(a){a?this.iScroll.disable():this.iScroll.enable()},onPreviousSlide:function(b){this._isEventReferToMe(b)&&(clearInterval(this._timer),this.slideByDirection(a.WIDGET_EVENTS.PREVIOUS))},onNextSlide:function(b){this._isEventReferToMe(b)&&(clearInterval(this._timer),this.slideByDirection(a.WIDGET_EVENTS.NEXT))},setIndex:function(b){if(this._index!==b&&!this.isAnimating){this._previousIndex=this._index,this._index=b;var c={id:this.id,previousIndex:this._previousIndex,nextIndex:b};radio(a.WIDGET_EVENTS.SLIDE_SELECT_EVENT).broadcast(c)}},goToSlide:function(a,b,c){},getIndex:function(){return this._index},getNextIndex:function(){var a=this.getIndex()+1;return a<this.items.length?a:0},getCurrentSlide:function(){return this.items[this._index]},getSlideByIndex:function(a){return this.items?0>a||a>this.items.length?null:this.items[a]:null},slideByDirection:function(a){var b=(this.getIndex(),this.getIndex()+a);if(b>this.items.length-1&&this.loop===!0)b=0;else if(0>b&&this.loop===!0)b=this.items.length-1;else if(0>b||b>this.items.length-1)return!1;return this.setIndex(b),!0},registerTransition:function(b,c){if("string"!=typeof a.TRANSITION_EFFECTS[b])throw new Error("Invalid Transition Type supplied for SlideShow");this.transitionTypes[b]||(this.transitionTypes[b]=c)}})),a.Core.widgets.SlideshowWidget.registerTransition(a.TRANSITION_EFFECTS.FADE,e),a.Core.widgets.SlideshowWidget.registerTransition(a.TRANSITION_EFFECTS.SLIDE,g),a.Core.widgets.SlideshowWidget.registerTransition(a.TRANSITION_EFFECTS.FLIP,a.Core.BrowserSniff.IE9?e:f),a.Core.widgets.SlideshowWidget.registerTransition(a.TRANSITION_EFFECTS.NONE,_.extend({},e,h))}(window.PR||{},window.Event);var onZoom=function(a){try{PR&&PR.Core&&(PR.Core.setZoom(a),radio(PR.Event.ON_ZOOM).broadcast(a))}catch(b){PR.log("failing onZoom",PR.log.ERROR)}},onScreen=function(){try{PR.Core._onScreen(),onZoom(!1)}catch(a){PR.log("failing onScreen",PR.log.ERROR)}},offScreen=function(){try{PR.Core._offScreen()}catch(a){PR.log("failing offscreen",PR.log.ERROR)}},isOnline=function(a){try{PR&&PR.Core&&PR.Core.setOnline(a)}catch(b){}this._isOnlineState=a},loadPageState=function(a){try{PR&&PR.Core&&PR.Core.loadPageState(a)}catch(b){}},canScroll=function(){try{return PR&&PR.Core?PR.Core.canScroll():!0}catch(a){return!0}};PR.slideshow=function(a){try{PR.Core.createWidget("SLIDESHOW",a)}catch(b){}},PR.image360=function(a){try{PR.Core.createWidget("360image",a)}catch(b){}},PR.carousel=function(a){try{PR.Core.createWidget("HorizontalCarousel",a)}catch(b){}},PR.layer=function(a){try{PR.Core.createWidget("PopupViewer",null,[a])}catch(b){}},PR.features=function(){try{return PR.Core.getFeatures()}catch(a){return{}}},PR.notifyApp=function(a){PR.Core.onAppNotify(a)};